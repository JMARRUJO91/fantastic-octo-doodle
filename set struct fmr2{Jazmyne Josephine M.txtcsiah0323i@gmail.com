set struct fmr2{Jazmyne Josephine Marrujo}
#define tc9154a_att_maj_3qdb1<3 Att % 10/2);
Card name =fmr2>is_fmd2?"sf16-fmd2:sf16-fmr2";


/* global API msg */// msg.js
/* global StyleInjector isFrame isFrameNoUrl isFrameSameOrigin */// style-injector.js
/* global TDM:true */// style-injector.js
'use strict';

(() => {
  if (window.INJECTED === 1) return;
  window.INJECTED = 1;

  let isTab = !chrome.tabs || location.pathname !== '/popup.html';
  const own = /** @type {Injection} */{
    cfg: {off: false, top: ''},
  };
  const calcOrder = ({id}, _) =>
    (_ = own.cfg.order) &&
    (_.prio[id] || 0) * 1e6 ||
    _.main[id] ||
    id + .5e6; // no order = at the end of `main`
  const isXml = document instanceof XMLDocument;
  const CHROME = 'app' in chrome;
  const SYM_ID = 'styles';
  const isUnstylable = !CHROME && isXml;
  const styleInjector = StyleInjector({
    compare: (a, b) => calcOrder(a) - calcOrder(b),
    onUpdate: onInjectorUpdate,
  });
  const clone = typeof deepCopy === 'function'
    ? deepCopy /* global deepCopy */// will be used in extension context
    : val => typeof val === 'object' && val ? JSON.parse(JSON.stringify(val)) : val;
  // dynamic iframes don't have a URL yet so we'll use their parent's URL (hash isn't inherited)
  let matchUrl = isFrameNoUrl
    ? parent.location.href.split('#')[0]
    : location.href;
  let isOrphaned, orphanCleanup;
  let offscreen;
  // firefox doesn't orphanize content scripts so the old elements stay
  if (!CHROME) styleInjector.clearOrphans();

  /** @type chrome.runtime.Port */
  let port;
  let lazyBadge = isFrame;

  /** Polyfill for documentId in Firefox and Chrome pre-106 */
  const instanceId = !(CHROME && CSS.supports('top', '1ic')) && (Math.random() + matchUrl);
  /* about:blank iframes are often used by sites for file upload or background tasks
   * and they may break if unexpected DOM stuff is present at `load` event
   * so we'll add the styles only if the iframe becomes visible */
  const xoEventId = `${Math.random()}`;
  /** @type IntersectionObserver */
  let xo;
  window[Symbol.for('xo')] = (el, cb) => {
    if (!xo) xo = new IntersectionObserver(onIntersect, {rootMargin: '100%'});
    el.addEventListener(xoEventId, cb, {once: true});
    xo.observe(el);
  };

  // FIXME: move this to background page when following bugs are fixed:
  // https://bugzil.la/1587723, https://crbug.com/968651
  const mqDark = !isFrame && matchMedia('(prefers-color-scheme: dark)');
  if (mqDark) {
    mqDark.onchange = ({matches: m}) => {
      if (m !== own.cfg.dark) API.info.set({preferDark: own.cfg.dark = m});
    };
  }

  // Declare all vars before init() or it'll throw due to "temporal dead zone" of const/let
  init();

  // the popup needs a check as it's not a tab but can be opened in a tab manually for whatever reason
  if (!isTab) {
    chrome.tabs.getCurrent(tab => {
      isTab = Boolean(tab);
      if (tab && styleInjector.list.length) updateCount();
    });
  }

  msg.onTab(applyOnMessage);
  addEventListener('pageshow', onBFCache);
  if (TDM < 0) document.onprerenderingchange = onReified;

  if (!chrome.tabs) {
    dispatchEvent(new CustomEvent(chrome.runtime.id, {detail: orphanCleanup = Math.random()}));
    addEventListener(chrome.runtime.id, orphanCheck, true);
  }

  function onInjectorUpdate() {
    if (!isOrphaned) {
      updateCount();
      if (isFrame) updateExposeIframes();
    }
  }

  async function init() {
    if (isUnstylable) return API.styleViaAPI({method: 'styleApply'});
    let data = isFrameNoUrl && CHROME && clone(parent[parent.Symbol.for(SYM_ID)]);
    if (data) await new Promise(onFrameElementInView);
    else data = !isFrameSameOrigin && !isXml && !chrome.tabs && tryCatch(getStylesViaXhr);
    // XML in Chrome will be auto-converted to html later, so we can't style it via XHR now
    await applyStyles(data);
    if (orphanCleanup) {
      dispatchEvent(new Event(orphanCleanup));
      orphanCleanup = false;
    }
  }

  async function applyStyles(data) {
    if (isOrphaned) return;
    if (!data) data = await API.styles.getSectionsByUrl(matchUrl, null, !own.sections);
    if (!data.cfg) data.cfg = own.cfg;
    Object.assign(own, window[Symbol.for(SYM_ID)] = data);
    if (!isFrame && own.cfg.top === '') own.cfg.top = location.origin; // used by child frames via parentStyles
    if (!isFrame && own.cfg.dark !== mqDark.matches) mqDark.onchange(mqDark);
    if (styleInjector.list.length) styleInjector.replace(own);
    else if (!own.cfg.off) styleInjector.apply(own);
    styleInjector.toggle(!own.cfg.off);
  }

  /** Must be executed inside try/catch */
  function getStylesViaXhr() {
    const blobId = (document.cookie.split(chrome.runtime.id + '=')[1] || '').split(';')[0];
    if (!blobId) return; // avoiding an exception so we don't spoil debugging in devtools
    const url = 'blob:' + chrome.runtime.getURL(blobId);
    document.cookie = `${chrome.runtime.id}=1; max-age=0; SameSite=Lax`; // remove our cookie
    const xhr = new XMLHttpRequest();
    xhr.open('GET', url, false); // synchronous
    xhr.send();
    URL.revokeObjectURL(url);
    return JSON.parse(xhr.response);
  }

  function applyOnMessage(req) {
    if (isUnstylable && /^(style|updateCount|urlChanged)/.test(req.method)) {
      API.styleViaAPI(req);
      return;
    }
    const {style} = req;
    switch (req.method) {
      case 'ping':
        return true;

      case 'styleDeleted':
        styleInjector.remove(style.id);
        break;

      case 'styleUpdated':
        if (!own.sections && own.cfg.off) break;
        if (style.enabled) {
          API.styles.getSectionsByUrl(matchUrl, style.id).then(res =>
            res.sections.length
              ? styleInjector.apply(res)
              : styleInjector.remove(style.id));
        } else {
          styleInjector.remove(style.id);
        }
        break;

      case 'styleAdded':
        if ((own.sections || !own.cfg.off) && style.enabled) {
          API.styles.getSectionsByUrl(matchUrl, style.id)
            .then(styleInjector.apply);
        }
        break;

      case 'urlChanged':
        if (req.iid === instanceId && matchUrl !== req.url) {
          matchUrl = req.url;
          if (own.sections) applyStyles(own.cfg.off && {});
        }
        break;

      case 'updateCount':
        updateCount();
        break;

      case 'injectorConfig':
        updateConfig(req);
        break;

      case 'backgroundReady':
        // This may happen when reloading the background page without reloading the extension
        if (own.sections) updateCount();
        return true;
    }
  }

  function updateConfig({cfg}) {
    for (const k in cfg) {
      const v = cfg[k];
      if (v === own.cfg[k]) continue;
      if (k === 'top' && !isFrame) continue;
      own.cfg[k] = v;
      if (k === 'off') updateDisableAll();
      else if (k === 'order') styleInjector.sort();
      else if (k === 'top') updateExposeIframes();
      else styleInjector.config(own.cfg);
    }
  }

  function updateDisableAll() {
    if (isUnstylable) {
      API.styleViaAPI({method: 'injectorConfig', cfg: {off: own.cfg.off}});
    } else if (!own.sections && !own.cfg.off) {
      if (!offscreen) init();
    } else {
      styleInjector.toggle(!own.cfg.off);
    }
  }

  function updateExposeIframes() {
    const attr = 'stylus-iframe';
    const el = document.documentElement;
    if (!el) return; // got no styles so styleInjector didn't wait for <html>
    if (!own.cfg.top || !styleInjector.list.length) {
      if (el.hasAttribute(attr)) el.removeAttribute(attr);
    } else if (el.getAttribute(attr) !== own.cfg.top) { // Checking first to avoid DOM mutations
      el.setAttribute(attr, own.cfg.top);
    }
  }

  function updateCount() {
    if (!isTab || TDM < 0) return;
    if (isFrame) {
      if (!port && styleInjector.list.length) {
        port = chrome.runtime.connect({name: 'iframe'});
      } else if (port && !styleInjector.list.length) {
        port.disconnect();
      }
      if (lazyBadge && performance.now() > 1000) lazyBadge = false;
    }
    if (isUnstylable) API.styleViaAPI({method: 'updateCount'});
    else API.updateIconBadge(styleInjector.list.map(style => style.id), {lazyBadge, iid: instanceId});
  }

  function onFrameElementInView(cb) {
    parent[parent.Symbol.for('xo')](frameElement, cb);
    (offscreen || (offscreen = [])).push(cb);
  }

  /** @param {IntersectionObserverEntry[]} entries */
  function onIntersect(entries) {
    for (const e of entries) {
      if (e.intersectionRatio) {
        xo.unobserve(e.target);
        e.target.dispatchEvent(new Event(xoEventId));
      }
    }
  }

  function onBFCache(e) {
    if (e.isTrusted && e.persisted) {
      updateCount();
    }
  }

  function onReified(e) {
    if (e.isTrusted) {
      TDM = 2;
      document.onprerenderingchange = null;
      API.styles.getSectionsByUrl('', 0, 'cfg').then(updateConfig);
      updateCount();
    }
  }

  function tryCatch(func, ...args) {
    try {
      return func(...args);
    } catch (e) {}
  }

  function orphanCheck(evt) {
    if (chrome.runtime.id) return;
    // In Chrome content script is orphaned on an extension update/reload
    // so we need to detach event listeners
    removeEventListener(evt.type, orphanCheck, true);
    removeEventListener('pageshow', onBFCache);
    if (mqDark) mqDark.onchange = null;
    if (offscreen) for (const fn of offscreen) fn();
    if (TDM < 0) document.onprerenderingchange = null;
    offscreen = null;
    isOrphaned = true;
    styleInjector.shutdown(evt.detail);
    tryCatch(msg.off, applyOnMessage);
  }
})();


92

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

93

class ut extends lt{static _selectText(e,t=0,n){const r=e.nodeValue?.length??0;let o="number"==typeof n?n:r;t=Math.max(t,0),o=Math.min(o,r);const s=self.getSelection(),i=new Range;return i.setStart(e,t),i.setEnd(e,o),s?.removeAllRanges(),s?.addRange(i),i}static _simulateMouseDown(e,t){const n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!1,clientX:t.x,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateMouseUp(e,t){const n=new MouseEvent("mouseup",{bubbles:!0,cancelable:!1,clientX:t.x+t.width,clientY:t.y+t.height/2});return e.dispatchEvent(n)}static _simulateMouseMove(e,t,n=!1){const r={bubbles:!0,cancelable:!1,clientX:t.x+t.width,clientY:t.y+t.height/2};n&&(r.buttons=1);const o=new MouseEvent("mousemove",r);return e.dispatchEvent(o)}static _simulateBackspaceDown(e){const t=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:8,which:8,location:0,key:"Backspace"});return e.dispatchEvent(t)}static _simulateBackspaceUp(e){const t=new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,keyCode:8,which:8,location:0,key:"Backspace"});return e.dispatchEvent(t)}constructor(e,t,n=Number.MAX_SAFE_INTEGER){super(e,t,n),this._ceElementInspector=new it(e,this._tweaks.getParsingDetector(),this._tweaks.getCacheInvalidationRules()),this._domMeasurement=new p.o(this._inputArea.ownerDocument),this._scrollTop=this._inputArea.scrollTop,this._scrollLeft=this._inputArea.scrollLeft,this._updateText(),this._onDblClick=this._onDblClick.bind(this),this._onScroll=this._onScroll.bind(this),this._inputArea.addEventListener("dblclick",this._onDblClick),this._tweaks.addScrollEventListener(this._onScroll),this._inputAreaObserver=this._tweaks.createMutationObserver(this._onInput),this._inputAreaObserver.observe(this._inputArea,ut.INPUT_AREA_OBSERVER_CONFIG)}_onDblClick(e){const n=(0,u.K2)(this._tweaks.getSelectedText()),r=this.getSelection();if(!n||!r)return;const o=r.end||r.start,s=this.getTextRanges(r.start,o-r.start);if(!s.length)return;this._domMeasurement.clearCache();const i=this._domMeasurement.getTextBoundingBoxes(s,this._inputArea),a=this._domMeasurement.getTextBoundingBoxes(s,this._inputArea,!1);if(!i.length)return;if(!a.some((n=>(0,t.nE)(n,e.clientX,e.clientY))))return;const l={inputAreaWrapper:this,selectedText:n,selection:r,clickedRectangles:i};(0,t.Q9)(document,lt.eventNames.dblclick,l)}_onScroll(e){const n=e.target instanceof Element?e.target:this._inputArea;let r=0,o=0;if("BODY"===n.nodeName?(r=document.body&&document.body.scrollTop||document.documentElement&&document.documentElement.scrollTop||0,o=document.body&&document.body.scrollLeft||document.documentElement&&document.documentElement.scrollLeft||0):(r=n.scrollTop,o=n.scrollLeft),this._scrollTop===r&&this._scrollLeft===o)return;this._scrollTop=r,this._scrollLeft=o;const s={inputAreaWrapper:this};(0,t.Q9)(document,lt.eventNames.scroll,s)}_hasSpaceBefore(e){if(e<=0)return!1;const t=this.getTextRanges(e-1,1)[0];return Boolean(t&&t.node.nodeValue&&ut.VISIBLE_WHITE_SPACE_REGEXP.test(t.node.nodeValue.substring(t.start,t.end)))}_hasSpaceAfter(e){const t=this.getTextRanges(e,1)[0];return Boolean(t&&t.node.nodeValue&&ut.VISIBLE_WHITE_SPACE_REGEXP.test(t.node.nodeValue.substring(t.start,t.end)))}_offsetInRawText(e,t,n){n=Math.min(e.length,n);let r=0,o=0;do{const s=e[r],i=t[o];if(s===i)o++;else if(this._ceElementInspector.isWhiteSpace(s)||"\n"===s)" "===i&&o++;else if(!(0,u.Av)(s))break;if(o>n)break;r++}while(r<e.length);return r}_offsetInParsedText(e,t,n){let r=0,o=0;for(;r<n;){const n=e[r],s=t[o];if(n===s)o++;else if(this._ceElementInspector.isWhiteSpace(n)||"\n"===n)" "===s&&o++;else if(!(0,u.Av)(n))break;r++}return o}_updateText(){const e=[];let n=0,r=null,o=!0,s=!1;const i=st.create(this._inputArea);let a=!1;do{const l=i.currentNode;null===r&&(r=this._ceElementInspector.getParagraphLastValuableNode(l)),a=!1;let c=!1,d="";if((0,t.iS)(l))if(d=this._ceElementInspector.getReplacementText(l),!d&&this._ceElementInspector.isListItem(l)&&(d="• ",this._ceElementInspector.hasText(l)||(d+="\n\n")),o=o&&""===d,s=(0,u.kT)(d),l===r&&(r=null,this._ceElementInspector.isTextEndsWithLineBreak(l)&&(o=!0,s=!1,d+="\n\n")),this._ceElementInspector.isSkippingElement(l)){if(a=!0,r=null,!d)continue}else this._ceElementInspector.isBlock(l)?(r=null,o=!0,s=!1):this._ceElementInspector.isBr(l)&&(r=null,o=!0,s=!1,!d&&this._ceElementInspector.isBRElementRelevant(l)&&(d="\n"));else if((0,t.sd)(l)&&(c=!0,d=this._ceElementInspector.getParsedText(l),d)){const e=null===r||r===l;this._ceElementInspector.getParsingOptions(l).preserveWhitespaces||((o||s)&&(d=d.replace(ut.LEADING_WHITESPACES_REGEXP,"")),e&&(d=d.replace(ut.TRAILING_WHITESPACES_REGEXP,""))),o=o&&""===d,s=(0,u.kT)(d),l===r&&(r=null,this._ceElementInspector.isTextEndsWithLineBreak(l)&&(o=!0,s=!1,d+="\n\n"))}const g=c?l.nodeValue:"";if(e.push({node:l,isTextNode:c,rawText:g,parsedText:d,parsedTextOffset:n}),n+=d.length,n>this._textLengthThreshold)break}while(i.next(a));let l="";for(const t of e)l+=t.parsedText;const c=this._text!==l;return this._text=l,this._textChunks=e,c}_getTextPosition(e){const t=this._getTextChunkIndex(e);if(-1===t)return null;const n=this._textChunks[t];return e-=n.parsedTextOffset,{textNode:n.node,offset:this._offsetInRawText(n.rawText,n.parsedText,e)}}_getRangeFromTextSelection(e,t){const n=this.getTextRanges(e,t);if(n.length)try{const e=new Range;return e.setStart(n[0].node,n[0].start),e.setEnd(n[n.length-1].node,n[n.length-1].end),e}catch{}}_getTextOffset(e,n){let r=null,o=0;if((0,t.iS)(e)){const s=st.create(this._inputArea);do{const o=s.currentNode;if(o===e.childNodes[n])break;(0,t.sd)(o)&&o.textContent&&(r=o)}while(s.next());if(!r)return-1;o=r.textContent.length}else(0,t.sd)(e)&&(r=e,o=n);const s=this._textChunks.find((e=>e.node===r));return s?s.parsedTextOffset+this._offsetInParsedText(s.rawText,s.parsedText,o):-1}_getRelativeTextReplacementOffset(e){this._updateText();const t=this._getTextChunkIndex(e.from,!0),n=this._textChunks[t];if(!n)return null;const r=n.node,o=r.textContent||"";let s=this._offsetInRawText(n.rawText,n.parsedText,e.from-n.parsedTextOffset),i=this._offsetInRawText(n.rawText,n.parsedText,e.to-n.parsedTextOffset);return s=Math.min(s,o.length),i=Math.min(i,o.length),{textNode:r,textContent:o,from:s,to:i}}async manuallyInsertText(e,t){const n=new InputEvent("beforeinput",{bubbles:!0,cancelable:!1,inputType:"insertText",data:t.replacementText});this._inputArea.dispatchEvent(n),e.nodeValue=t.newText,this.simulateInput(t.replacementText)}async simulateDelete(){if(ut._simulateBackspaceDown(this._inputArea)){const e=new InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"deleteContentBackward"});let t=!0;"deleteContentBackward"===e.inputType&&(t=this._inputArea.dispatchEvent(e)),t&&document.execCommand("delete",!1)}await(0,t.Sy)(),ut._simulateBackspaceUp(this._inputArea),await(0,t.Sy)()}insertText(e,t){const n={bubbles:!0,cancelable:!0,inputType:"insertText",data:e};if(t&&"StaticRange"in self&&"getTargetRanges"in InputEvent.prototype)try{n.targetRanges=[new StaticRange(t)]}catch(e){}const r=new InputEvent("beforeinput",n);let o=!0;"insertText"===r.inputType&&(o=this._inputArea.dispatchEvent(r)),o&&document.execCommand("insertText",!1,e)}async _applyReplacement(e){let n=this._getRelativeTextReplacementOffset(e);if(!n)return Promise.resolve();let{from:o,to:s,textNode:i}=n;const a=i.parentElement||this._inputArea;let l=i.ownerDocument.createRange();l.setStart(i,o),l.setEnd(i,s);const u=l.getBoundingClientRect(),c=new at(["mouseout","mouseover","mousemove","mousedown","mouseup","pointerout","pointerover","pointermove","pointerdown","pointerup","click","dblclick"]);try{if(ut._simulateMouseDown(a,u),ut._simulateMouseMove(a,u),n=this._getRelativeTextReplacementOffset(e),!n)return;o=n.from,s=n.to,i=n.textNode,l=ut._selectText(i,o,s),ut._simulateMouseUp(a,u),c.mute();const d=this._tweaks.getDelayBeforeInsertingText();if(0!==d&&await(0,t.Sy)(d),((0,t.SE)(this._inputArea)||(0,t.q4)(this._inputArea))&&await(0,t.Sy)(201),(0,t.GG)(this._inputArea)&&await(0,t.Sy)(0),(0,t.QX)(this._inputArea)&&await(0,t.Sy)(0),c.unmute(),(r.A.isFirefox()||r.A.isThunderbird())&&(e.replacementText.includes(ut.NBSP)||(0,t.q4)(this._inputArea)))return void this.manuallyInsertText(i,e);if((0,t.Wg)(this._inputArea)&&ut.SMART_QUOTES.includes(e.replacementText))await this.simulateDelete(),this.insertText(e.replacementText,l);else if(e.replacementText||o===s)if((0,t.SE)(this._inputArea)||(0,t.k7)(this._inputArea))(0,t.k_)(this._inputArea,e.replacementText);else if(0===o&&e.replacementText.includes(" ")&&e.replacementText.length>1&&(0,t.QX)(this._inputArea)){const t=e.replacementText.split(" "),n=t[0],r=" "+t.slice(1).join(" ");this.insertText(n),this.insertText(r)}else this.insertText(e.replacementText,l);else await this.simulateDelete()}finally{c.unmute()}}getTextBoxes(e,t){const n=this.getTextRanges(e,t);return n.length?(this._domMeasurement.clearCache(),this._domMeasurement.getTextBoundingBoxes(n,this._inputArea)):[]}resetText(){this._inputAreaObserver.disconnect();const e=st.create(this._inputArea);do{const n=e.currentNode;(0,t.sd)(n)&&(n.textContent=n.textContent)}while(e.next());this._inputAreaObserver.observe(this._inputArea,ut.INPUT_AREA_OBSERVER_CONFIG)}replaceText(e,n,r){if(e<0)return Promise.resolve();const o=e+r.length;return""===r&&(this._hasSpaceBefore(e)||0===e)&&this._hasSpaceAfter(e+n)&&(e=Math.max(e-1,0),n+=1),(0,t.Sy)(50).then((()=>{const t=[],s=this._getTextChunkIndex(e);if(-1===s)return Promise.resolve();for(let o=s;o<this._textChunks.length;o++){const{isTextNode:s,rawText:i,parsedText:a,parsedTextOffset:l}=this._textChunks[o];if(e+n<=l&&""===r)break;if(s&&e<l+a.length){const o=Math.max(e-l,0),s=l>e?e+n-l:n,u=a.substring(0,o)+r+a.substring(o+s);i!==u&&t.push({from:l+o,to:l+o+Math.min(a.length-o,s),replacementText:r,newText:u}),r=""}}return t.reverse().reduce(((e,t)=>e.then((()=>this._applyReplacement(t)))),Promise.resolve()).then((()=>{this.setSelection({start:o})})).then((()=>{this.simulateChange(),this.simulateKeyUp()}))}))}getSelection(){const e=this._tweaks.getSelection();if(!e||!e.startNode)return null;if(!this._inputArea.contains(e.startNode))return null;const t=this._getTextOffset(e.startNode,e.startOffset);return{start:t,end:e.isCollapsed||!e.endNode?t:this._getTextOffset(e.endNode,e.endOffset)}}setSelection(e){const t=e.start,n=void 0===e.end?t:e.end;this._inputArea.focus();const r=this._getTextPosition(t);if(!r)return;const o=self.getSelection();o.removeAllRanges();const s=new Range;if(s.setStart(r.textNode,r.offset),t!==n){const e=this._getTextPosition(n);if(!e)return;s.setEnd(e.textNode,e.offset)}else s.collapse(!1);o.addRange(s)}getWordAtPoint(e,n){const r=(0,t.E9)({x:e,y:n});if(!(r&&this._inputArea.contains(r.startContainer)))return null;const o=r.getBoundingClientRect();if(!(Math.abs(o.left-e)<30&&(Math.abs(o.top-n)<30||Math.abs(o.bottom-n)<30)))return null;const s=this._getTextOffset(r.startContainer,r.startOffset),i=this.getText();return(0,u.EJ)(i,s,s)||(0,u.i0)(i,s)}scrollToText(e,t,r="smooth",o="nearest",s=!1,i){if(e<0)return;if(s&&this.isTextRangeInViewport(e,t))return void i?.();const a=()=>{i&&setTimeout((()=>i()),50)},l=this._getRangeFromTextSelection(e,t);if(l)try{const e=l.getBoundingClientRect();if("smart"===o){if(e.top>140&&n.g.innerHeight-e.bottom>140)return void a();o="center"}self.scrollRangeIntoView(l,{behavior:r,block:o},a)}catch(e){}}isTextRangeInViewport(e,n){if(!this.getTextRanges(e,n).length)return!1;const r=this._getRangeFromTextSelection(e,n);if(!r)return!1;const o=r.getBoundingClientRect(),s=this._inputArea.getBoundingClientRect();if(!(0,t.Un)(o,s))return!1;const i=r.getClientRects(),a=i[0],l=i[i.length-1],u={x:a.left+a.width/2,y:a.top+a.height/2},c={x:l.left+l.width/2,y:l.top+l.height/2},d=(0,t.E9)(u),g=(0,t.E9)(c);return Boolean(d&&this._inputArea.contains(d.commonAncestorContainer)&&g&&this._inputArea.contains(g.commonAncestorContainer))}destroy(){super.destroy(),this._inputArea.removeEventListener("dblclick",this._onDblClick),this._tweaks.removeScrollEventListener(this._onScroll),this._ceElementInspector.destroy(),this._inputAreaObserver&&this._inputAreaObserver.disconnect()}}

94

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

95

var ct;ut.NBSP=String.fromCharCode(160),ut.VISIBLE_WHITE_SPACE_REGEXP=/\u00A0|\u0020|\u2009|\u202F/,ut.LEADING_WHITESPACES_REGEXP=new RegExp(/^ /),ut.TRAILING_WHITESPACES_REGEXP=new RegExp(/ $/),ut.SMART_QUOTES=["“","”","„","»","«"],ut.INPUT_AREA_OBSERVER_CONFIG={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0,attributeFilter:["id","class","style"]},function(e){e.PERMISSION_REQUIRED="PERMISSION_REQUIRED",e.DISABLED="DISABLED",e.DISCONNECTED="DISCONNECTED",e.TEXT_TOO_SHORT="TEXT_TOO_SHORT",e.TEXT_TOO_LONG="TEXT_TOO_LONG",e.IN_PROGRESS="IN_PROGRESS",e.COMPLETED="COMPLETED",e.UNSUPPORTED_LANGUAGE="UNSUPPORTED_LANGUAGE",e.NEEDS_LANGUAGE_HINT="NEEDS_LANGUAGE_HINT",e.FAILED="FAILED"}(ct||(ct={}));class dt{constructor(e,t,n,r,o=!0){this._className=e,this._label=t,this._parentElement=r,this._toolTip=n,this._document=r.ownerDocument,this._render(o)}_render(e){if(this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-icon","lt-icon--"+this._className),this._element.classList.toggle("lt-icon--clickable",e),this._element.setAttribute("data-lt-prevent-focus",""),this._parentElement.appendChild(this._element),this._icon=this._document.createElement("lt-span"),this._icon.classList.add("lt-icon__icon","lt-icon__"+this._className),this._element.appendChild(this._icon),this._toolTip){const e=this._document.createElement("lt-div");e.classList.add("lt-icon__tooltip","lt-icon__tooltip--"+this._toolTip.position,"lt-icon__tooltip--"+this._className),e.textContent=this._toolTip.label,this._element.appendChild(e)}if(this._label){const e=this._document.createElement("lt-span");e.classList.add("lt-icon__label"),e.textContent=this._label,this._element.appendChild(e)}}setIcon(e){this._icon.className="",this._icon.classList.add("lt-icon__icon","lt-icon__"+e)}getElement(){return this._element}}class gt{constructor(e,t,n,r,o,s,i=null){this._className=e,this._parentElement=n,this._dialog=r,this._appendElement=i,this._optionElements=[],this._options=t,this._document=n.ownerDocument,this._position=o,this._isSelectable=s,this._render()}_render(){this._overlay=this._document.createElement("lt-div"),this._overlay.setAttribute("data-lt-prevent-focus",""),this._overlay.classList.add("lt-menu-overlay","lt-menu-overlay--"+this._className),this._dialog.appendChild(this._overlay),this._element=this._document.createElement("lt-div"),this._element.setAttribute("data-lt-prevent-focus",""),this._element.classList.add("lt-menu","lt-menu--"+this._className,"lt-menu--position-"+this._position),this._parentElement.appendChild(this._element),this._options.forEach((e=>{const t=this._document.createElement("lt-div");t.classList.add("lt-menu__item","lt-menu__item--"+e.className,"lt-icon__"+e.className),e.isClickable&&t.classList.add("lt-menu__item--clickable"),this._isSelectable&&t.classList.add("lt-menu__item--selectable"),this._element.appendChild(t);const n=this._document.createElement("lt-span");if(n.classList.add("lt-menu__item__label","lt-menu__item__label--"+e.className),n.textContent=e.label,t.appendChild(n),e.info){const n=this._document.createElement("lt-span");n.classList.add("lt-menu__item__info","lt-menu__item__info--"+e.className),n.textContent=e.info,t.appendChild(n)}if(e.tag){const n=this._document.createElement("lt-span");n.classList.add("lt-menu__item__tag","lt-menu__item__tag--"+e.className),n.textContent=e.tag,t.appendChild(n)}this._optionElements.push(t)})),this._appendElement&&this._element.appendChild(this._appendElement)}show(){this._parentElement.classList.add("lt-menu-visible"),this._element.classList.add("lt-menu--show"),this._overlay.classList.add("lt-menu--show")}hide(){this._parentElement.classList.remove("lt-menu-visible"),this._element.classList.remove("lt-menu--show"),this._overlay.classList.remove("lt-menu--show")}getElement(){return this._element}getAllOptions(){return this._optionElements}getActiveOptions(){return this._optionElements}getOverlay(){return this._overlay}setInfo(e,t){if(e>=0&&e<this._optionElements.length){const n=this._optionElements[e].querySelector(".lt-menu__item__info");n&&(n.textContent=t)}}toggleActive(e,t,n){n&&this.getAllOptions().forEach((e=>{e.classList.remove("lt-menu__item--active")})),e>=0&&e<this._optionElements.length&&(t?this._optionElements[e].classList.add("lt-menu__item--active"):this._optionElements[e].classList.remove("lt-menu__item--active"))}toogleVisibility(e,t){e>=0&&e<this._optionElements.length&&(t?this._optionElements[e].classList.remove("lt-menu__item--hidden"):this._optionElements[e].classList.add("lt-menu__item--hidden"))}}class mt{constructor(e,t,n,r){this._className=e,this._type=t,this._size=n,this._parentElement=r,this._document=r.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-package-badge","lt-package-badge--"+this._type,"lt-package-badge--"+this._size),this._element.textContent=this._type,this._parentElement.appendChild(this._element)}getElement(){return this._element}}class ht{constructor(e,t,n,r=(()=>{})){this._parentElement=e,this._document=e.ownerDocument,this._expires=t,this._classes=n,this._onCountdownEnd=r,this._element=this._document.createElement("lt-div"),this._element.className="lt-countdown",this._addOptionalClass(this._element,this._classes.countdown),this._render(),this._interval=self.setInterval((()=>this._render()),1e3),this._parentElement.appendChild(this._element)}getElement(){return this._element}destroy(){clearInterval(this._interval)}_addOptionalClass(e,t){e.classList.toggle(String(t),Boolean(t))}_render(){const e=Date.now();let t=this._expires-e;if(t<0)return void this._onCountdownEnd();const n=Math.floor(t/1e3%60),r=Math.floor(t/1e3/60%60),o=Math.floor(t/1e3/60/60),s=`${(0,u.eu)(o)}:${(0,u.eu)(r)}:${(0,u.eu)(n)}`.split(/:|/),i=this._document.createElement("lt-div");s.forEach(((e,t)=>{const n=this._document.createElement("lt-span");if(n.className="lt-countdown__digit",this._addOptionalClass(n,this._classes.digit),n.textContent=e,i.appendChild(n),t%2==1&&t<s.length-1){const e=this._document.createElement("lt-span");e.className="lt-countdown__divider",this._addOptionalClass(e,this._classes.divider),e.textContent=":",i.appendChild(e)}})),this._element.innerHTML=i.innerHTML}}class pt{constructor(e,n,r=null,s=null,i=null,a){this._listeners=[],this._parentElement=e,this._headline=r,this._text=s,this._buttonText=i,this._trackingEvent=n,this._linkParameters=a,this._document=e.ownerDocument,this._storageController=d.w.create(),this._element=this._document.createElement("lt-div"),this._listeners.push((0,t.YZ)(this._element,"click",(e=>{e.stopImmediatePropagation(),e.preventDefault();const t={command:"OPEN_PREMIUM_PAGE",...this._linkParameters};(0,o.o)().runtime.sendMessage(t)}))),this._element.className="lt-premium-errors-teaser",this._parentElement.appendChild(this._element),this._renderPremiumErrorsTeaser()}_observe(){this._element.addEventListener("click",(()=>{m.A.trackEvent("Action",`${this._trackingEvent}:click`)}))}_renderPremiumErrorsTeaser(){m.A.trackEvent("Action",this._trackingEvent),this._observe(),this._storageController.onReady((()=>{this._storageController.startChangelogCoupon();const e=this._storageController.getActiveCoupon();if(e&&(this._linkParameters.campaign=this._linkParameters.campaign.replace(/addon2-(dialog|popup|validator)/,"addon2-changelog"),this._renderCoupon(e)),!this._headline&&!this._text&&!this._buttonText)return;const t=this._document.createElement("lt-div");if(t.className="lt-premium-errors-teaser__content",this._element.appendChild(t),this._headline&&!e){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__headline",e.textContent=this._headline,t.appendChild(e)}if(this._text){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__text",e.innerHTML=this._text,t.appendChild(e)}if(this._buttonText){const e=this._document.createElement("lt-span");e.className="lt-premium-errors-teaser__content__button",e.textContent=this._buttonText,t.appendChild(e)}}))}_renderCoupon(e){const t=this._document.createElement("lt-div");t.className="lt-premium-errors-teaser__coupon";const n=this._document.createElement("lt-span");n.textContent=i.e.getMessage("upgradeTeaserDiscountHeadline"),n.className="lt-premium-errors-teaser__coupon__title__headline";const r=this._document.createElement("lt-span");r.textContent=i.e.getMessage("upgradeTeaserDiscount",[e.percent]),r.className="lt-premium-errors-teaser__coupon__title__subline";const o=this._document.createElement("lt-div");o.className="lt-premium-errors-teaser__coupon__title",o.appendChild(n),o.appendChild(r),t.appendChild(o),this._timerElement=new ht(t,e.expires||0,{},(()=>t.remove())),this._element.prepend(t)}destroy(){this._listeners.forEach((({destroy:e})=>e())),this._timerElement?.destroy()}}class _t{constructor(e,t,n){this._listeners=[],this._parentElement=e,this._componentName=t,this._url=n,this._document=e.ownerDocument,this._storageController=d.w.create(),this._element=this._document.createElement("lt-div"),this._element.className="lt-rating-teaser",this._parentElement.appendChild(this._element),this.render()}_sendRating(e){m.A.trackEvent("Stat",`rating:${_.E.getPrimaryLanguageCode(navigator.language)}`,e),this._storageController.updateStatistics({ratingValue:e}),this._storageController.updateUIState({hasRated:!0}),"like"===e?r.A.isChrome()||r.A.isFirefox()||r.A.isOpera()||r.A.isEdge()||r.A.isSafari()?this._showReviewContainer():this._showThanksContainer():"dislike"===e&&(this._showThanksContainer(),this._openFeedbackForm(i.e.getMessage("ratingUnhappyQuestion")),m.A.trackEvent("Stat","dislike_host",(0,u.IH)()))}_showReviewContainer(){this._element.classList.remove("lt-rating-teaser--thanks-visible"),this._element.classList.add("lt-rating-teaser--review-visible")}_showThanksContainer(){this._element.classList.remove("lt-rating-teaser--review-visible"),this._element.classList.add("lt-rating-teaser--thanks-visible")}_openFeedbackForm(t){e.e.openFeedbackForm(this._url,t)}render(){const e=this._document.createElement("lt-div");e.className="lt-rating-teaser__intro",this._element.appendChild(e);const n=this._document.createElement("lt-div");n.className="lt-rating-teaser__intro__question";const o=this._document.createElement("lt-div");o.className="lt-rating-teaser__intro__headline",o.innerText=i.e.getMessage("ratingHeadline"),n.appendChild(o);const s=this._document.createElement("lt-div");s.innerText=i.e.getMessage("ratingText"),n.appendChild(s),e.appendChild(n);const a=this._document.createElement("lt-div");a.className="lt-rating-teaser__intro__options";const l=this._document.createElement("lt-div");l.className="lt-rating-teaser__intro__option",l.setAttribute("data-lt-emotion","like"),a.appendChild(l);const u=this._document.createElement("lt-div");u.className="lt-rating-teaser__intro__option",u.setAttribute("data-lt-emotion","dislike"),a.appendChild(u),e.appendChild(a);const c=this._document.createElement("a");c.target="_blank",c.rel="noreferrer noopener",c.className="lt-rating-teaser__review",this._element.appendChild(c);const d=this._document.createElement("lt-div");d.className="lt-rating-teaser__review__text",c.appendChild(d),r.A.isFirefox()?(0,t.W2)(d,"reviewFirefoxHeadline"):r.A.isOpera()?(0,t.W2)(d,"reviewOperaHeadline"):r.A.isEdge()?(0,t.W2)(d,"reviewEdgeHeadline"):r.A.isSafari()?(0,t.W2)(d,"reviewSafariHeadline"):(0,t.W2)(d,"reviewChromeHeadline");const g=this._document.createElement("lt-a");g.className="lt-rating-teaser__review__link",g.innerText=i.e.getMessage("reviewLink"),c.appendChild(g);const h=this._document.createElement("lt-div");h.className="lt-rating-teaser__thanks",h.innerText=i.e.getMessage("ratingThankYou"),this._element.appendChild(h),this._listeners.push((0,t.YZ)(l,"click",(e=>{e.stopImmediatePropagation(),this._sendRating("like")}))),this._listeners.push((0,t.YZ)(u,"click",(e=>{e.stopImmediatePropagation(),this._sendRating("dislike")}))),this._listeners.push((0,t.YZ)(c,"click",(e=>{e.stopImmediatePropagation(),m.A.trackEvent("Action","dialog:rating_teaser:click")}))),r.A.isChrome()?(this._element.classList.add("lt-rating-teaser--chrome"),c.href="https://chromewebstore.google.com/detail/grammatik-und-rechtschrei/oldceeleldhonbafppcapldpdifcinji/reviews"):r.A.isFirefox()?(this._element.classList.add("lt-rating-teaser--firefox"),c.href="https://addons.mozilla.org/firefox/addon/languagetool/"):r.A.isOpera()?(this._element.classList.add("lt-rating-teaser--opera"),c.href="https://addons.opera.com/extensions/details/grammar-and-spell-checker-languagetool/"):r.A.isEdge()?(this._element.classList.add("lt-rating-teaser--edge"),c.href="https://microsoftedge.microsoft.com/addons/detail/hfjadhjooeceemgojogkhlppanjkbobc"):r.A.isSafari()&&(this._element.classList.add("lt-rating-teaser--safari"),c.href="https://appstoreconnect.apple.com/apps/1534275760/appstore"),m.A.trackEvent("Action",`${this._componentName}:rating_teaser`)}destroy(){this._listeners.forEach((({destroy:e})=>e()))}}class Et{constructor(e,t,n){this._className=e,this._parentElement=t,this._toolTip=n,this._document=t.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-score","lt-score--"+this._className),this._element.setAttribute("data-lt-prevent-focus",""),this._parentElement.appendChild(this._element),this._progressLabel=this._document.createElement("lt-span"),this._progressLabel.classList.add("lt-score__label"),this._progressLabel.setAttribute("data-lt-prevent-focus",""),this._progressLabel.textContent="0";const e=this._document.createElement("lt-div");e.classList.add("lt-icon__tooltip","lt-icon__tooltip--"+this._toolTip.position,"lt-icon__tooltip--"+this._className),e.textContent=this._toolTip.label,this._element.appendChild(e),this._element.appendChild(this._progressLabel)}setScore(e){Math.PI;e>0?(this._progressLabel.textContent=e.toString(),this._updateProgress(e),this._element.classList.remove("lt-score--hidden")):this._element.classList.add("lt-score--hidden")}_updateProgress(e){let t="",n="";if(e<50){t="linear-gradient(90deg, #DEE3ED 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0))",n="linear-gradient("+(90+3.6*e)+"deg, #1976F0 50%, #DEE3ED 50%, #DEE3ED)"}else{t="linear-gradient("+(3.6*(e-50)-90)+"deg, #1976F0 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0))",n="linear-gradient(270deg, #1976F0 50%, #DEE3ED 50%, #DEE3ED)"}this._element.setAttribute("style","background-image: "+t+", "+n+" !important")}}class ft{constructor(e,t,n){this._listeners=[],this.stopPropagation=e=>e.stopImmediatePropagation(),this._className=e,this._parentElement=t,this._select=n,this._document=t.ownerDocument,this._currentSelection=this._document.createElement("lt-span"),this._render()}destroy(){this._listeners.forEach((({destroy:e})=>e()))}_render(){this._selectorWrapper=this._document.createElement("lt-div"),this._selectorWrapper.classList.add("lt-dialog__selector-wrapper","lt-dialog__selector-wrapper--"+this._className,"lt-icon__chevron_down"),this._parentElement.appendChild(this._selectorWrapper),this._currentSelection.classList.add("lt-dialog__current-selection","lt-dialog__current-selection--"+this._className),this._selectorWrapper.appendChild(this._currentSelection),this._select.classList.add("lt-dialog__selector","lt-dialog__selector--"+this._className),this._selectorWrapper.appendChild(this._select),this._listeners.push((0,t.YZ)(this._selectorWrapper,"click",this.stopPropagation))}setActive(e,t,n){this._currentSelection.textContent=e||"",this._select.value=t,new p.o(this._document).setStyles(this._currentSelection,n)}addOption(e){this._select.prepend(e)}updateOptionLable(e,t){this._select.querySelectorAll("option[value="+e+"]")[0].textContent=t}getSelect(){return this._select}getValue(){return this._select.value}toggleHighlight(e){this._selectorWrapper.classList.toggle("lt-dialog__selector-wrapper--highlight",e)}}class Ct{constructor(e,t,n,r){this._className=e,this._label=t,this._info=n,this._parentElement=r,this._document=r.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.setAttribute("data-lt-prevent-focus",""),this._element.classList.add("lt-toggle-item","lt-toggle--"+this._className,"lt-icon__"+this._className),this._parentElement.appendChild(this._element);const e=this._document.createElement("lt-div");e.classList.add("lt-toggle-item__title","lt-toggle-item__title--"+this._className);const t=this._document.createElement("lt-span");t.classList.add("lt-toggle-item__title__label"),t.textContent=this._label,e.appendChild(t),this._info&&(this._infoElement=this._document.createElement("lt-span"),this._infoElement.classList.add("lt-toggle-item__title__info"),this._infoElement.textContent=this._info,e.appendChild(this._infoElement)),this._element.appendChild(e);const n=this._document.createElement("lt-div");n.classList.add("lt-toggle-item__toggle","lt-toggle-item__toggle--"+this._className),this._element.appendChild(n);const r=this._document.createElement("lt-div");r.classList.add("lt-toggle-item__toggle__dot"),n.appendChild(r)}set(e){e?this._element.classList.add("lt-toggle-item---checked"):this._element.classList.remove("lt-toggle-item---checked")}setInfo(e){this._infoElement.textContent=e}getElement(){return this._element}}

96

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

97

class At{static _cacheMessages(){At.MESSAGES={EXTENSION_UPDATED_HEADLINE:i.e.getMessage("extensionUpdatedHeadline"),EXTENSION_UPDATED_TEXT:i.e.getMessage("extensionUpdatedText",["<lt-span class='lt-dialog__icon'></lt-span>"]),INCOMPLETE_RESULT:i.e.getMessage("incompleteResult"),POWERED_BY:i.e.getMessage("poweredBy"),FEEDBACK:i.e.getMessage("sendFeedback"),DELETE:i.e.getMessage("deleteWord"),ENABLE_HEADLINE:i.e.getMessage("dialogEnableInDialogHeadline"),ENABLE_TEXT:i.e.getMessage("dialogEnableInDialogText"),ENABLE_EVERYWHERE_BUTTON:i.e.getMessage("enableEverywhereButton"),ENABLE_HERE_BUTTON:i.e.getMessage("enableHereButton"),OPTIONS_TITLE:i.e.getMessage("settingsHeadline"),NO_ERRORS:i.e.getMessage("noErrorsFound2"),NO_ERRORS_TEXT:i.e.getMessage("noErrorsFoundText"),TEXT_TOO_LONG_HEADLINE:i.e.getMessage("dialogTextTooLongHeadline"),TEXT_TOO_LONG_TEXT:i.e.getMessage("dialogTextTooLongText"),SCROLL_HINT_HEADLINE:i.e.getMessage("dialogScrollHintHeadline"),SCROLL_HINT_TEXT:i.e.getMessage("dialogScrollHintText"),TEXT_TOO_LONG_BUTTON:i.e.getMessage("dialogTextTooLongButton"),TEXT_TOO_SHORT_TEXT:i.e.getMessage("dialogTextTooShortText"),TEXT_TOO_SHORT_HEADLINE:i.e.getMessage("dialogTextTooShortHeadline"),TEXT_SCORE_MENU_ITEM:i.e.getMessage("dialogMainMenuTextScore"),REGULAR_MISTAKE_MENU_ITEM:i.e.getMessage("dialogMainMenuRegularMistake"),PREMIUM_MISTAKE_MENU_ITEM:i.e.getMessage("dialogMainMenuPremiumMistake"),PICKY_MODE_MENU_ITEM:i.e.getMessage("dialogMainMenuPickyMode"),PICKY_MODE_MENU_ITEM_INFO:i.e.getMessage("dialogMainMenuPickyModeInfo"),COUNTER_CHARACTERS_OPTION:i.e.getMessage("dialogCounterCharactersOption"),COUNTER_WORDS_OPTION:i.e.getMessage("dialogCounterWordsOption"),COUNTER_SENTENCES_OPTION:i.e.getMessage("dialogCounterSentencesOption"),POSITION_DEFAULT_MENU_ITEM:i.e.getMessage("dialogPositionMenuDefault"),POSITION_RIGHT_MENU_ITEM:i.e.getMessage("dialogPositionMenuRight"),POSITION_LEFT_MENU_ITEM:i.e.getMessage("dialogPositionMenuLeft"),Fail_STATE_HEADLINE:i.e.getMessage("dialogFailStateHeadline"),Fail_STATE_TEXT:i.e.getMessage("dialogFailStateText"),HEADLINE_SPELLING_ERROR:i.e.getMessage("spellingError"),HEADLINE_CUSTOM_SUGGESTION_ERROR:i.e.getMessage("customSuggestionError"),HEADLINE_SUGGESTION_ERROR:i.e.getMessage("suggestionError"),HEADLINE_PUNCTUATION_ERROR:i.e.getMessage("punctuationError"),HEADLINE_GRAMMAR_ERROR:i.e.getMessage("grammarError"),SELECT_LANGUAGE_LABEL:i.e.getMessage("dialogSelectLanguageLabel"),UNSUPPORTED_LANGUAGE_LABEL:i.e.getMessage("dialogUnsupportedLanguageLabel"),UNSUPPORTED_LANGUAGE_HEADLINE:i.e.getMessage("dialogUnsupportedLanguageHeadline"),UNSUPPORTED_LANGUAGE_TEXT:i.e.getMessage("dialogUnsupportedLanguageText"),ALL_LANGUAGES:i.e.getMessage("dialogAllLanguages"),RECOMMENDED_LANGUAGES:i.e.getMessage("dialogRecommendedLanguages"),SCROLL_TO_LINK:i.e.getMessage("dialogScrollToLink"),SEND_FEEDBACK_TOOLTIP:i.e.getMessage("dialogTooltipSendFeedback"),HELP_TOOLTIP:i.e.getMessage("dialogTooltipHelp"),HELP_CENTER_TOOLTIP:i.e.getMessage("dialogTooltipHelpCenter"),IGNORE_RULE_TOOLTIP:i.e.getMessage("ignoreHere"),DISABLE_CHECKING_TOOLTIP:i.e.getMessage("dialogTooltipDisableChecking"),DISABLE_CHECKING_MENU_ITEM:i.e.getMessage("dialogDisableMenuDisableChecking"),PAUSE_CHECKING_MENU_ITEM:i.e.getMessage("dialogDisableMenuPauseChecking"),DIALOG_POSITION_TOOLTIP:i.e.getMessage("dialogTooltipPosition"),SETTINGS_TOOLTIP:i.e.getMessage("dialogTooltipSettings"),USER_STATISTICS_TOOLTIP:i.e.getMessage("dialogTooltipUserStatistics"),SAVE_TEXT_TOOLTIP:i.e.getMessage("dialogTooltipSaveText"),NEEDS_LANGUAGE_HINT_HEADLINE:i.e.getMessage("dialogNeedsLanguageHintHeadline"),NEEDS_LANGUAGE_HINT_TEXT:i.e.getMessage("dialogNeedsLanguageHintText"),NEEDS_LANGUAGE_HINT_IGNORE:i.e.getMessage("dialogNeedsLanguageHintIgnore"),LANGUAGES:_.E.LANGUAGES}}static init(){At._isInitialized||(At._cacheMessages(),At._isInitialized=!0)}constructor(n,r,o,s,i){this._menus=[],this._allDisplyedErrorsCount=0,this._toolbarContainer=n,this._appearance=r,this._uiOptions=i,this._document=this._toolbarContainer.ownerDocument,this._languageCode=o,this._onCloseClick=this._onCloseClick.bind(this),this._onUnload=this._onUnload.bind(this),self.addEventListener("pagehide",this._onUnload,!0),this._controls={},this._eventListeners=[],this._render().then((()=>{this.setCurrentLanguage(o||_.E.getUserLanguageCode()),this.updateCounter({mode:"words",counts:{words:0,characters:0,sentences:0}}),this.updateState(s)})),this._eventListeners.push((0,t.YZ)(document,"keydown",this._onKeydown.bind(this))),this._inApplyFixMode=!1,this._inInsignificantChangeMode=!0,this._shouldShowRatingTeaser=!s.displayedPremiumErrors.length&&!this._controls.teaserElement&&!this._uiOptions.disableRatingTeaser&&e.e.isRuntimeConnected()&&0===Math.floor(2*Math.random())}async _render(){if(this._controls.container)return;this._controls.container=(0,t.KY)(this._document,At.CONTAINER_ELEMENT_NAME);const n=e=>{e.stopImmediatePropagation()};this._eventListeners.push((0,t.YZ)(this._controls.container,"mousedown",(e=>{e.target===this._controls.languageSelector.getSelect()&&(document.addEventListener("blur",n,!0),setTimeout((()=>{document.removeEventListener("blur",n,!0)}),10)),e.target===this._controls.countSelector.getSelect()&&(document.addEventListener("blur",n,!0),setTimeout((()=>{document.removeEventListener("blur",n,!0)}),10)),e.target instanceof HTMLElement&&e.target.closest("[data-lt-prevent-focus]")&&e.preventDefault(),n(e)})),(0,t.YZ)(this._controls.container,"mouseup",n),(0,t.YZ)(this._controls.container,"pointerdown",n),(0,t.YZ)(this._controls.container,"pointerup",n),(0,t.YZ)(this._controls.container,"focusin",n),(0,t.YZ)(this._controls.container,"focusout",n),(0,t.YZ)(this._controls.container,"click",(e=>{e.preventDefault(),e.stopPropagation()}))),this._controls.innerContainer=this._document.createElement("lt-div"),this._controls.innerContainer.classList.add("lt-dialog__container","notranslate"),r.A.isSafari()&&this._controls.innerContainer.classList.add("lt-dialog__container--safari"),this._appearance.canDisplayAllSuggestions()||this._controls.innerContainer.classList.add("lt-dialog__container--small"),this._controls.container.appendChild(this._controls.innerContainer),this._controls.header=this._document.createElement("lt-div"),this._controls.header.className="lt-dialog__header",this._controls.innerContainer.appendChild(this._controls.header);const o=this._document.createElement("lt-div");o.className="lt-dialog__header__logo-wrapper",this._controls.logo=this._document.createElement("lt-div"),this._controls.logo.classList.add("lt-dialog__logo","lt-icon__lt"),o.appendChild(this._controls.logo),this._uiOptions.isPremiumAccount||(this._controls.packageBadge=new mt(null,"basic","default",o),this._eventListeners.push((0,t.YZ)(this._controls.packageBadge.getElement(),"click",this._onBadgeClicked.bind(this)))),this._controls.header.appendChild(o),this._controls.headerScoreProgress=this._document.createElement("lt-div"),this._controls.headerScoreProgress.className="lt-dialog__header__progress-score",this._controls.header.appendChild(this._controls.headerScoreProgress),this._controls.headerScoreProgressBar=this._document.createElement("lt-div"),this._controls.headerScoreProgressBar.className="lt-dialog__header__progress-score__bar",this._controls.headerScoreProgress.appendChild(this._controls.headerScoreProgressBar),this._controls.headerControlsWrapper=this._document.createElement("lt-div"),this._controls.headerControlsWrapper.className="lt-dialog__header__controls-wrapper";const s=this._document.createElement("select");if(At.MESSAGES.LANGUAGES.forEach((e=>{const t=this._document.createElement("option");t.value=e.code,t.textContent=e.name,s.appendChild(t)})),e.e.isRuntimeConnected()){const t=await e.e.getPreferredLanguages();if(!s||!t.length)return;const n=s.value,r=this._document.createElement("optgroup");r.label=At.MESSAGES.ALL_LANGUAGES,Array.from(s.children).forEach((e=>{r.append(e)}));const o=this._document.createElement("optgroup");o.label=At.MESSAGES.RECOMMENDED_LANGUAGES,t.forEach((e=>{const t=_.E.LANGUAGES.find((t=>t.code.startsWith(e.toLowerCase())));if(t){const e=this._document.createElement("option");e.value=t.code,e.textContent=t.name,o.appendChild(e)}})),s.append(o),s.append(r),s.value=n}if(this._controls.languageSelector=new ft("language-select",this._controls.headerControlsWrapper,s),this._eventListeners.push((0,t.YZ)(this._controls.languageSelector.getSelect(),"change",this._onLanguageChange.bind(this))),!this._uiOptions.disableSaveDocument){const e={label:At.MESSAGES.SAVE_TEXT_TOOLTIP,position:"top-center"};this._controls.saveIcon=new dt("save",null,e,this._controls.headerControlsWrapper),this._eventListeners.push((0,t.YZ)(this._controls.saveIcon.getElement(),"click",this._onSaveTextClick.bind(this)))}if(this._appearance.isPositionVisible()&&e.e.isRuntimeConnected()){const e=this._document.createElement("lt-div");e.className="lt-icon-group",this._controls.headerControlsWrapper.appendChild(e);const n={label:At.MESSAGES.DIALOG_POSITION_TOOLTIP,position:"bottom-right"};this._controls.positionIcon=new dt(this._uiOptions.dialogPosition,null,n,e);const r=[{className:"default",label:At.MESSAGES.POSITION_DEFAULT_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"right",label:At.MESSAGES.POSITION_RIGHT_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"left",label:At.MESSAGES.POSITION_LEFT_MENU_ITEM,info:null,tag:null,isClickable:!0}];this._controls.positionMenu=new gt("position",r,this._controls.positionIcon.getElement(),this._controls.innerContainer,"bottom",!0),this._menus.push(this._controls.positionMenu);const o=this._controls.positionMenu.getAllOptions();this._eventListeners.push((0,t.YZ)(o[0],"click",this._onPositionDialogClick.bind(this)),(0,t.YZ)(o[1],"click",this._onPositionRightClick.bind(this)),(0,t.YZ)(o[2],"click",this._onPositionLeftClick.bind(this)),(0,t.YZ)(this._controls.positionMenu.getOverlay(),"click",this._onPositionOverlayClick.bind(this)),(0,t.YZ)(this._controls.positionIcon.getElement(),"click",this._onPositionIconClick.bind(this)))}this._controls.closeIcon=new dt("close_filled",null,null,this._controls.headerControlsWrapper),this._eventListeners.push((0,t.YZ)(this._controls.closeIcon.getElement(),"click",this._onCloseClick)),this._controls.headerControlsWrapper.appendChild(this._controls.closeIcon.getElement()),this._eventListeners.push((0,t.YZ)(this._controls.logo,"click",this._gotoLanguageTool.bind(this))),this._controls.content=this._document.createElement("lt-div"),this._controls.content.className="lt-dialog__content",this._controls.innerContainer.appendChild(this._controls.content),this._eventListeners.push((0,t.YZ)(this._controls.content,"scroll",this._onContentScroll.bind(this))),this._controls.contentTop=this._document.createElement("lt-div"),this._controls.contentTop.className="lt-dialog__content__top",this._controls.content.appendChild(this._controls.contentTop),this._controls.contentMain=this._document.createElement("lt-div"),this._controls.contentMain.className="lt-dialog__content__main",this._controls.content.appendChild(this._controls.contentMain),this._controls.contentBottom=this._document.createElement("lt-div"),this._controls.contentBottom.className="lt-dialog__content__bottom",this._controls.content.appendChild(this._controls.contentBottom),this._controls.footer=this._document.createElement("lt-div"),this._controls.footer.className="lt-dialog__footer",this._controls.loadingBar=this._document.createElement("lt-div"),this._controls.loadingBar.className="lt-dialog__footer__loading-bar-container";const i=this._document.createElement("lt-div");i.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-1");const a=this._document.createElement("lt-div");a.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-2");const l=this._document.createElement("lt-div");l.classList.add("lt-dialog__footer__loading-bar-container__loading-bar","lt-dialog__footer__loading-bar-container__loading-bar--loading-bar-3"),this._controls.loadingBar.appendChild(i),this._controls.loadingBar.appendChild(a),this._controls.loadingBar.appendChild(l),this._controls.footer.appendChild(this._controls.loadingBar);const u=[{label:At.MESSAGES.COUNTER_CHARACTERS_OPTION,value:"characters"},{label:At.MESSAGES.COUNTER_WORDS_OPTION,value:"words"},{label:At.MESSAGES.COUNTER_SENTENCES_OPTION,value:"sentences"}],c=this._document.createElement("select");if(u.forEach((e=>{const t=this._document.createElement("option");t.value=e.value,t.textContent=e.label,c.appendChild(t)})),this._controls.countSelector=new ft("countSelect",this._controls.footer,c),this._controls.footerControlsWrapper=this._document.createElement("lt-div"),this._controls.footerControlsWrapper.className="lt-dialog__footer__controls-wrapper",this._controls.footer.appendChild(this._controls.footerControlsWrapper),this._eventListeners.push((0,t.YZ)(this._controls.countSelector.getSelect(),"change",this._onCountChange.bind(this))),this._uiOptions.disableHelpCenter||this._uiOptions.disableFeedbackForm)if(this._uiOptions.disableFeedbackForm){if(!this._uiOptions.disableHelpCenter){const e={label:At.MESSAGES.HELP_CENTER_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new dt("help",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement()),this._eventListeners.push((0,t.YZ)(this._controls.sendFeedback.getElement(),"click",this._gotoHelpCenter.bind(this)))}}else{const e={label:At.MESSAGES.SEND_FEEDBACK_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new dt("feedback",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement()),this._eventListeners.push((0,t.YZ)(this._controls.sendFeedback.getElement(),"click",this._showFeedbackForm.bind(this)))}else{const e={label:At.MESSAGES.HELP_TOOLTIP,position:"top-right"};this._controls.sendFeedback=new dt("help",null,e,this._controls.footerControlsWrapper),this._controls.footerControlsWrapper.appendChild(this._controls.sendFeedback.getElement());const n=[{className:"help",label:At.MESSAGES.HELP_CENTER_TOOLTIP,info:null,tag:null,isClickable:!0,isSelectable:!1},{className:"feedback",label:At.MESSAGES.SEND_FEEDBACK_TOOLTIP,info:null,tag:null,isClickable:!0}];this._controls.helpMenu=new gt("help",n,this._controls.sendFeedback.getElement(),this._controls.innerContainer,"top",!1,null),this._menus.push(this._controls.helpMenu);const r=this._controls.helpMenu.getAllOptions();this._eventListeners.push((0,t.YZ)(r[0],"click",this._gotoHelpCenter.bind(this)),(0,t.YZ)(r[1],"click",this._showFeedbackForm.bind(this)),(0,t.YZ)(this._controls.helpMenu.getOverlay(),"click",this._onHelpOverlayClick.bind(this)),(0,t.YZ)(this._controls.sendFeedback.getElement(),"click",this._onHelpIconClick.bind(this)))}if(this._uiOptions.showUserStatisticsLink){const e={label:At.MESSAGES.USER_STATISTICS_TOOLTIP,position:"top-right"},n=new dt("user-statistics",null,e,this._controls.footerControlsWrapper);this._eventListeners.push((0,t.YZ)(n.getElement(),"click",this._onUserStatisticsClick.bind(this)))}if(!this._uiOptions.disableTurnOff){const e={label:At.MESSAGES.DISABLE_CHECKING_TOOLTIP,position:"top-right"};this._controls.disableIcon=new dt("disable_circle",null,e,this._controls.footerControlsWrapper);const n=[{className:"pause",label:At.MESSAGES.PAUSE_CHECKING_MENU_ITEM,info:null,tag:null,isClickable:!0},{className:"disable_circle",label:At.MESSAGES.DISABLE_CHECKING_MENU_ITEM,info:null,tag:null,isClickable:!0}];this._controls.disableMenu=new gt("disable",n,this._controls.disableIcon.getElement(),this._controls.innerContainer,"top",!1),this._menus.push(this._controls.disableMenu);const r=this._controls.disableMenu.getAllOptions();this._eventListeners.push((0,t.YZ)(r[0],"click",this._onPauseCheckingClick.bind(this)),(0,t.YZ)(r[1],"click",this._onTurnOffClick.bind(this)),(0,t.YZ)(this._controls.disableMenu.getOverlay(),"click",this._onDisableOverlayClick.bind(this)),(0,t.YZ)(this._controls.disableIcon.getElement(),"click",this._onDisableIconClicked.bind(this)))}if(!this._uiOptions.disableOptionsPage){const e={label:At.MESSAGES.SETTINGS_TOOLTIP,position:"top-right"};this._controls.optionsIcon=new dt("options",null,e,this._controls.footerControlsWrapper),this._eventListeners.push((0,t.YZ)(this._controls.optionsIcon.getElement(),"click",this._onOptionsClick.bind(this)))}this._controls.incompleteResult=this._document.createElement("lt-div"),this._controls.incompleteResult.className="lt-dialog__incomplete-result",this._controls.incompleteResult.textContent=At.MESSAGES.INCOMPLETE_RESULT,this._controls.footer.appendChild(this._controls.incompleteResult),this._controls.pointer=this._document.createElement("lt-span"),this._controls.pointer.className="lt-dialog__pointer",this._controls.innerContainer.appendChild(this._controls.pointer),this._toolbarContainer.appendChild(this._controls.container),this._toolbarContainer.classList.add("lt-toolbar--dialog-opened"),e.e.isRuntimeConnected()&&(this._controls.innerContainer.appendChild(this._controls.footer),this._controls.header.appendChild(this._controls.headerControlsWrapper));const d=this._toolbarContainer.querySelector(".lt-toolbar__premium-icon-dot--has-notification");d&&d.classList.remove("lt-toolbar__premium-icon-dot--has-notification")}_position(n=null){const r=this._controls.container.ownerDocument.body.offsetWidth,o=e.e.isRuntimeConnected()&&this._appearance.isPositionVisible()&&r>400?n||this._uiOptions.dialogPosition:"default";if(this._uiOptions.dialogPosition=o,this._controls.innerContainer.classList.remove("lt-dialog__container--fixed-right"),this._controls.innerContainer.classList.remove("lt-dialog__container--fixed-left"),"default"===o){!this._controls.positionMenu||this._controls.positionMenu.toggleActive(0,!0,!0);let e=this._controls.innerContainer.getBoundingClientRect();const n=document.doctype?this._document.documentElement.clientWidth:Math.min(this._document.documentElement.clientWidth,document.body.clientWidth);e.right>=n-At.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),e=this._controls.innerContainer.getBoundingClientRect();const r=document.doctype?this._document.documentElement.clientHeight:Math.min(this._document.documentElement.clientHeight,document.body.clientHeight);e.bottom>=r&&this._alignToTop(),e=this._controls.innerContainer.getBoundingClientRect(),e.top<=At.SPACE_TO_SCREEN_EDGE&&this._alignToBottom(),e.top<0&&!(0,t.VR)(document.body)&&!(0,t.VR)(document.documentElement)&&this._alignToBottom()}else"right"===o?(!this._controls.positionMenu||this._controls.positionMenu.toggleActive(1,!0,!0),this._controls.innerContainer.style.removeProperty("right"),this._controls.innerContainer.style.removeProperty("left"),this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container--fixed-right")):"left"===o&&(!this._controls.positionMenu||this._controls.positionMenu.toggleActive(2,!0,!0),this._controls.innerContainer.style.removeProperty("right"),this._controls.innerContainer.style.removeProperty("left"),this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container--fixed-left"))}_alignToBottom(){const e=new p.o(this._document);this._controls.innerContainer.classList.remove("lt-dialog__container-top"),this._controls.innerContainer.classList.add("lt-dialog__container-bottom");const t=this._controls.innerContainer.getBoundingClientRect();if(t.left<=At.SPACE_TO_SCREEN_EDGE){const n=parseInt(e.getStyle(this._controls.innerContainer,"right"),10)+t.left-At.SPACE_TO_SCREEN_EDGE,r=parseInt(e.getStyle(this._controls.pointer,"right"),10)-t.left+At.SPACE_TO_SCREEN_EDGE;e.setStyles(this._controls.innerContainer,{right:n+"px !important",left:"auto !important"}),e.setStyles(this._controls.pointer,{right:r+"px !important",left:"auto !important"})}if(t.right>this._document.documentElement.clientWidth){e.setStyles(this._controls.innerContainer,{right:"0px !important",left:"auto !important"});const n=parseInt(e.getStyle(this._controls.pointer,"right"),10)+(this._controls.innerContainer.getBoundingClientRect().right-t.right);e.setStyles(this._controls.pointer,{right:n+"px !important",left:"auto !important"})}}_alignToTop(){this._controls.innerContainer.classList.remove("lt-dialog__container-bottom"),this._controls.innerContainer.classList.add("lt-dialog__container-top");const e=this._controls.innerContainer.getBoundingClientRect(),t=new p.o(this._document);if(this._controls.innerContainer.classList.add("lt-dialog__container-hide"),e.right>=this._document.documentElement.clientWidth-At.SPACE_TO_SCREEN_EDGE){const n=parseInt(t.getStyle(this._controls.innerContainer,"left"),10)-(e.right-this._document.documentElement.clientWidth)-At.SPACE_TO_SCREEN_EDGE,r=parseInt(t.getStyle(this._controls.pointer,"left"),10)+(e.right-this._document.documentElement.clientWidth)+At.SPACE_TO_SCREEN_EDGE;t.setStyles(this._controls.innerContainer,{left:n+"px !important",right:"auto !important"}),t.setStyles(this._controls.pointer,{left:r+"px !important",right:"auto !important"})}this._controls.innerContainer.classList.remove("lt-dialog__container-hide")}_removeTeaser(){this._controls.teaserElement&&(this._controls.teaserElement.remove(),this._controls.teaserElement=void 0)}_updateContent(){if(!this._controls.content)return;this.closeAllMenus();const e=this._state.checkStatus;this._controls.content.classList.remove("lt-dialog__has-errors"),this._controls.content.classList.remove("lt-dialog__is-loading"),this._controls.contentMain.innerHTML="",this._controls.contentTop.innerHTML="",this._controls.contentBottom.innerHTML="",this.updateCounter(this._state.countOptions);const t=(this._inApplyFixMode||this._inInsignificantChangeMode)&&e===ct.IN_PROGRESS&&this._allDisplyedErrorsCount>0;this._showLoadingBar(t);const n=e===ct.NEEDS_LANGUAGE_HINT;if(this._controls.languageSelector.toggleHighlight(n),t?(this._renderHeadline(),this._renderCompletedState()):e===ct.IN_PROGRESS?(this._renderHeadline(),this._renderInProgressState()):e===ct.COMPLETED?(this._renderHeadline(),this._renderCompletedState()):e===ct.DISABLED?this._renderDisabledState():e===ct.TEXT_TOO_SHORT?(this._renderHeadline(),this._renderTextTooShortState(),this._renderPremiumErrorsTeaser()):e===ct.TEXT_TOO_LONG?(this._renderHeadline(),this._renderTextTooLongState(),this._renderDiscountTimerTeaser()):e===ct.UNSUPPORTED_LANGUAGE?(this._renderHeadline(),this._renderLanguageUnsupportedState()):e===ct.DISCONNECTED?this._renderDisconnectedState():e===ct.FAILED?this._renderFailedState():n&&this._renderNeedsLanguageHintState(),e===ct.COMPLETED&&this._controls.mainHeadline){this._controls.headerScoreProgressBar.style.width=this._state.textScore+"%",this._controls.textScore.setScore(this._state.textScore);const e=this._state.displayedErrors.length||0,t=this._state.displayedPremiumErrors.length||0;this._allDisplyedErrorsCount=e+t,this._controls.errorsCounter.textContent=this._allDisplyedErrorsCount.toString()}this._position()}_showLoadingBar(e){e!==this._isLoadingBarShown&&(e?this._controls.loadingBar.classList.remove("lt-dialog__footer__loading-bar-container--hidden"):this._controls.loadingBar.classList.add("lt-dialog__footer__loading-bar-container--hidden"),this._isLoadingBarShown=e)}_getCountString(t,n){if(!e.e.isRuntimeConnected())return"";const r={words:[i.e.getMessage("dialogCounterWordsSingular"),i.e.getMessage("dialogCounterWordsPlural",[(0,u.iy)(t.counts.words,e.e.getUILanguageCode())])],sentences:[i.e.getMessage("dialogCounterSentencesSingular"),i.e.getMessage("dialogCounterSentencesPlural",[(0,u.iy)(t.counts.sentences,e.e.getUILanguageCode())])],characters:[i.e.getMessage("dialogCounterCharactersSingular"),i.e.getMessage("dialogCounterCharactersPlural",[(0,u.iy)(t.counts.characters,e.e.getUILanguageCode())])]},o=t.counts[n];return 0===o?r[n][1]:1===o?r[n][0]:r[n][1]}_renderHeadline(){this._controls.mainHeadline=this._document.createElement("lt-div"),this._controls.mainHeadline.classList.add("lt-dialog__content-top__menu"),this._controls.mainHeadline.setAttribute("data-lt-prevent-focus","");const e=this._document.createElement("lt-span");e.className="lt-dialog__main-headline";const n=this._document.createElement("lt-span");n.className="lt-dialog__main-headline__headline",n.textContent=At.MESSAGES.REGULAR_MISTAKE_MENU_ITEM,this._controls.errorsCounter=this._document.createElement("lt-span"),this._controls.errorsCounter.className="lt-dialog__main-headline__counter",this._controls.errorsCounter.textContent=this._allDisplyedErrorsCount.toString(),e.appendChild(n),e.appendChild(this._controls.errorsCounter),this._controls.mainHeadline.appendChild(e);const r={label:At.MESSAGES.TEXT_SCORE_MENU_ITEM,position:"bottom-right"};this._controls.textScore=new Et("lt-dialog__main-headline__score",this._controls.mainHeadline,r),this._controls.textScore.setScore(this._state.textScore),this._controls.contentTop.appendChild(this._controls.mainHeadline),this._controls.pickyToggle=new Ct("picky_mode",At.MESSAGES.PICKY_MODE_MENU_ITEM,"",this._controls.contentTop),this._controls.pickyToggle.set(this._state.isPickyModeEnabled),this._eventListeners.push((0,t.YZ)(this._controls.pickyToggle.getElement(),"click",this._onTogglePickyMode.bind(this)))}_renderInProgressState(){this._controls.content.classList.add("lt-dialog__is-loading");const e=this._document.createElement("lt-div");e.className="lt-dialog-skeleton lt-dialog-skeleton--error-card";const t=this._document.createElement("lt-div");t.className="lt-dialog-skeleton lt-dialog-skeleton--error-card",this._controls.contentMain.appendChild(e),this._controls.contentMain.appendChild(t)}_renderCompletedState(){this._state.displayedErrors&&this._state.displayedErrors.length?this._appearance.canDisplayAllSuggestions()?(this._renderErrors(),this._renderIgnoredErrorsStats()):this._renderScrollHint():this._state.displayedPremiumErrors&&this._state.displayedPremiumErrors.length?(this._removeTeaser(),this._renderPremiumState()):(this._removeTeaser(),this._renderNoErrorsState(),this._renderIgnoredErrorsStats()),this._controls.incompleteResult.classList.toggle("lt-dialog__incomplete-result-show",!!this._state.isIncompleteResult)}_renderErrors(){this._controls.content.classList.add("lt-dialog__has-errors"),this._state.displayedPremiumErrors&&this._state.displayedPremiumErrors.length&&this._renderPremiumErrorsTeaser(),this._state.displayedErrors.forEach((e=>{const n=this._document.createElement("lt-div");n.className="lt-dialog__error-item";const r={label:At.MESSAGES.IGNORE_RULE_TOOLTIP,position:"top-right"},o=new dt("trash",null,r,n);this._eventListeners.push((0,t.YZ)(o.getElement(),"click",(t=>{e.isSpellingError?this._onTemporarilyIgnoreWordClick(e,t):this._onTemporarilyIgnoreRuleClick(e,t),n.remove()})));const s=this._document.createElement("lt-div");s.className="lt-dialog__error-headline",e.isPicky&&n.classList.add("lt-dialog__error-item--picky-mistake"),e.isCustomError?(s.textContent=e.shortDescription||At.MESSAGES.HEADLINE_SUGGESTION_ERROR,n.classList.add("lt-dialog__error-item--custom-suggestion")):e.isSpellingError?(s.textContent=At.MESSAGES.HEADLINE_SPELLING_ERROR,n.classList.add("lt-dialog__error-item--spelling-mistake")):e.isStyleError?(s.textContent=e.shortDescription||At.MESSAGES.HEADLINE_SUGGESTION_ERROR,n.classList.add("lt-dialog__error-item--style-suggestion")):e.isPunctuationError?(s.textContent=e.shortDescription||At.MESSAGES.HEADLINE_PUNCTUATION_ERROR,n.classList.add("lt-dialog__error-item--punctuation-mistake")):(s.textContent=e.shortDescription||At.MESSAGES.HEADLINE_GRAMMAR_ERROR,n.classList.add("lt-dialog__error-item--grammar-mistake")),n.append(s),n.addEventListener("mouseenter",(()=>this._onErrorHighlighted(e.id))),n.addEventListener("mouseleave",(()=>this._onErrorHighlighted(null)));const i=this._document.createElement("lt-div");i.className="lt-dialog__original-phrase",n.appendChild(i);const a=this._document.createElement("lt-div");a.className="lt-dialog__original-phrase__header",i.appendChild(a);const l=this._document.createElement("lt-div");l.className="lt-dialog__original-phrase__header__title",l.textContent=e.originalPhrase,a.appendChild(l);const u=new dt("scroll-to-link",At.MESSAGES.SCROLL_TO_LINK,null,a);this._eventListeners.push((0,t.YZ)(u.getElement(),"click",(t=>{t.stopImmediatePropagation(),this._onErrorSelected(e.id)})));const c=this._document.createElement("lt-div");c.className="lt-dialog__original-phrase__long-context-phrase",c.innerHTML=e.longContextPhrase,i.appendChild(c),this._renderFixes(e,n),this._renderDescription(e,n),this._renderActions(e,n),this._controls.contentMain.appendChild(n)}))}_renderFixes(e,n){const r=this._document.createElement("lt-div");r.className="lt-dialog__fix-container",n.appendChild(r);const o=Math.min(e.fixes.length,l.MAX_FIXES_COUNT);for(let s=0;s<o;s++){const i=e.fixes[s],a=this._document.createElement("lt-div");if(a.title=i.shortDescription||"",a.className="lt-dialog__fix",a.setAttribute("data-lt-prevent-focus",""),i.value.match(l.TRAILING_WHITESPACE_REGEXP)&&!i.value.match(/^\s*[\-–—:;]\s$/))a.textContent=i.value.replace(l.TRAILING_WHITESPACE_REGEXP,"·");else{const n=i.value.replace(l.NARROW_WHITESPACE_REGEXP," ");o>3&&e.isSpellingError?a.textContent=n:(a.classList.add("lt-dialog__fix--highlighted"),a.innerHTML=(0,t.O6)((0,t.KI)(e.originalPhrase,n)))}""===i.value&&e.originalPhrase.match(/[a-z0-9]{2,}/)?(a.classList.add("lt-dialog__fix--remove"),a.classList.remove("lt-dialog__fix--highlighted"),a.textContent=e.originalPhrase):""===i.value&&(a.classList.add("lt-dialog__fix--delete"),a.classList.remove("lt-dialog__fix--highlighted"),a.textContent=At.MESSAGES.DELETE),this._eventListeners.push((0,t.YZ)(a,"click",(t=>{this._onFixClick(e,s,t),n.remove()}))),r.appendChild(a);const u=(0,t.g2)(e,i.value);if(this._uiOptions.canCorrectMultipleErrorsAtOnce&&(0,t.qK)(this._state.errors,e)&&u){const n=this._document.createElement("lt-span");n.classList.add("lt-dialog__fix--correct-all"),n.innerHTML=u.suggestion.message;const o=this._onCorrectAll.bind(this,e,u);this._eventListeners.push((0,t.YZ)(n,"click",o)),r.appendChild(n),r.appendChild(this._document.createElement("br"))}i.value.length>=14&&n.classList.add("lt-dialog__long-fix")}}_renderActions(e,n){if(e.isSpellingError){if(!this._uiOptions.disableAddingWord&&!(0,u._o)(e.originalPhrase)){const r=this._document.createElement("lt-div");r.classList.add("lt-dialog__add-to-dictionary","lt-icon__dictionary"),r.setAttribute("data-lt-prevent-focus",""),r.textContent=i.e.getMessage("addToDictionaryCaption",e.originalPhrase),this._eventListeners.push((0,t.YZ)(r,"click",(t=>{this._onAddToDictionaryClick(e,t),n.remove()}))),n.appendChild(r)}}else if(!this._uiOptions.disableIgnoringRule&&!e.isCustomError){const r=this._document.createElement("lt-div");r.classList.add("lt-dialog__ignore-rule"),r.classList.add("lt-icon__ignore"),r.setAttribute("data-lt-prevent-focus",""),r.classList.add("lt-icon__ignore"),r.textContent=i.e.getMessage("turnOffRule"),this._eventListeners.push((0,t.YZ)(r,"click",(t=>{this._onIgnoreRuleClick(e,t),n.remove()}))),n.appendChild(r)}}_renderDescription(e,n){const r=this._document.createElement("lt-div");if(r.className="lt-dialog__error-text",r.setAttribute("data-lt-prevent-focus",""),r.textContent=e.description,n.append(r),e.rule.urls&&e.rule.urls.length>0){const n=this._document.createElement("lt-span");n.classList.add("lt-dialog__more-details","lt-icon__info"),n.setAttribute("data-lt-prevent-focus",""),n.title=i.e.getMessage("moreDetails"),this._eventListeners.push((0,t.YZ)(n,"click",(t=>{this._onMoreDetailsClick(e.rule.urls[0],t)}))),r.appendChild(n)}}_renderScrollHint(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__scroll-hint__headline",t.textContent=At.MESSAGES.SCROLL_HINT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__scroll-hint__text",n.textContent=At.MESSAGES.SCROLL_HINT_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e),this._shouldShowRatingTeaser?this._renderRatingTeaser():this._renderPremiumErrorsTeaser()}_renderTextTooShortState(){this._removeTeaser();const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__text-too-short__headline",t.innerHTML=At.MESSAGES.TEXT_TOO_SHORT_HEADLINE;const n=this._document.createElement("lt-div");n.className="lt-dialog__text-too-short__text",n.innerHTML=At.MESSAGES.TEXT_TOO_SHORT_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderNoErrorsState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__no-errors__headline",t.textContent=At.MESSAGES.NO_ERRORS;const n=this._document.createElement("lt-div");n.className="lt-dialog__no-errors__text",n.textContent=At.MESSAGES.NO_ERRORS_TEXT,e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e),this._shouldShowRatingTeaser?this._renderRatingTeaser():this._renderPremiumErrorsTeaser()}_renderIgnoredErrorsStats(){if(!this._state.ignoredErrorsStats)return;if(0===this._state.ignoredErrorsStats.byDictionary&&0===this._state.ignoredErrorsStats.byRules)return;const e=this._document.createElement("lt-div");if(this._state.displayedErrors&&this._state.displayedErrors.length?e.className="lt-dialog__ignored-errors-item":e.className="lt-dialog__ignored-errors-message",this._state.ignoredErrorsStats.byDictionary>0&&!this._uiOptions.disableAddingWord){const t=1===this._state.ignoredErrorsStats.byDictionary?"errorsIgnoredByDictionarySingular":"errorsIgnoredByDictionary",n=i.e.getMessage(t,[this._state.ignoredErrorsStats.byDictionary]),r=document.createElement("lt-span");r.textContent=n,r.dataset.type="byDictionary",e.appendChild(r)}if(this._state.ignoredErrorsStats.byRules>0&&!this._uiOptions.disableIgnoringRule){if(this._state.ignoredErrorsStats.byDictionary>0){const t=document.createElement("lt-span");t.textContent=", ",e.appendChild(t)}const t=1===this._state.ignoredErrorsStats.byRules?"errorsIgnoredByRulesSingular":"errorsIgnoredByRules",n=i.e.getMessage(t,[this._state.ignoredErrorsStats.byRules]),r=document.createElement("lt-span");r.textContent=n,r.dataset.type="byRules",e.appendChild(r)}this._controls.contentMain.appendChild(e),this._eventListeners.push((0,t.YZ)(e,"click",this._onIgnoredErrorsClick.bind(this)))}_renderRatingTeaser(){this._ratingTeaser=new _t(this._controls.contentBottom,"dialog",(0,u.y4)().substr(0,150))}_renderPremiumErrorsTeaser(){this._controls.teaserElement||e.e.isRuntimeConnected()&&d.w.create().onReady((e=>{if(e.getUIState().hasPaidSubscription)return;const n=e.getStatistics(),r=(0,t.Id)(n);e.startChangelogCoupon();const o=e.getActiveCoupon();if(this._state.displayedPremiumErrors.length){const e=this._state.displayedPremiumErrors.filter((e=>!e.isStyleError&&!e.isPunctuationError)).length,t=this._state.displayedPremiumErrors.filter((e=>e.isPunctuationError)).length,n=this._state.displayedPremiumErrors.filter((e=>e.isStyleError)).length,r="dialog:premium_teaser",o=1===e+t+n?i.e.getMessage("premiumErrorsTextSingular"):i.e.getMessage("premiumErrorsTextPlural",[this._state.displayedPremiumErrors.length]),s=i.e.getMessage("premiumErrorsButton");this._premiumTeaser=new pt(this._controls.contentTop,r,null,o,s,{campaign:"addon2-dialog-premium-errors",hiddenGrammarMatches:e,hiddenStyleMatches:n,hiddenPunctuationMatches:t,textLanguage:this._languageCode||void 0})}else if(r.hiddenErrorsCount>5){const e="dialog:historic_premium_teaser",t=i.e.getMessage("historicPremiumErrorsHeadline"),n=i.e.getMessage("historicPremiumErrorsText2",[r.hiddenErrorsCount,r.dayCount]),o=i.e.getMessage("historicPremiumErrorsButton");this._premiumTeaser=new pt(this._controls.contentBottom,e,t,n,o,{campaign:"addon2-dialog-historic-premium-errors",historicMatches:r.hiddenErrorsCountStr})}else if(o){const e="dialog:premium_teaser";this._premiumTeaser=new pt(this._controls.contentBottom,e,null,null,null,{campaign:"addon2-dialog"})}e.destroy()}))}_renderDiscountTimerTeaser(){d.w.create().onReady((e=>{e.startChangelogCoupon();if(e.getActiveCoupon()){const e="dialog:premium_teaser";this._premiumTeaser=new pt(this._controls.contentBottom,e,null,null,null,{campaign:"addon2-dialog-premium"})}e.destroy()}))}_renderPremiumState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__headline",n.textContent=1===this._state.displayedPremiumErrors.length?i.e.getMessage("dialogPremiumHeadlineSingular"):i.e.getMessage("dialogPremiumHeadlinePlural",[this._state.displayedPremiumErrors.length]);const r=this._document.createElement("lt-div");r.className="lt-dialog__premium__text",r.textContent=i.e.getMessage("dialogPremiumText");const o=this._document.createElement("lt-div");o.className="lt-dialog__premium__button lt-icon__new_window",o.textContent=i.e.getMessage("dialogPremiumButton");let s="addon2-dialog-premium";this._eventListeners.push((0,t.YZ)(o,"click",(e=>{e.stopImmediatePropagation();const n={dialog:this,campaign:s};(0,t.Q9)(document,At.eventNames.premiumTeaserClicked,n),m.A.trackEvent("Action","dialog:premium:click")}))),e.appendChild(n),e.appendChild(r),e.appendChild(o),this._controls.contentMain.appendChild(e),d.w.create().onReady((e=>{e.startChangelogCoupon();e.getActiveCoupon()&&(s=s.replace("addon2","addon2-countdown"),this._premiumTeaser=new pt(this._controls.contentBottom,"dialog:premium_teaser",null,null,null,{campaign:s})),e.destroy()}))}_renderDisabledState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const n=this._document.createElement("lt-div");n.className="lt-dialog__enable-text__headline",n.textContent=At.MESSAGES.ENABLE_HEADLINE;const r=this._document.createElement("lt-div");r.className="lt-dialog__enable-everywhere",r.innerHTML=At.MESSAGES.ENABLE_EVERYWHERE_BUTTON,this._eventListeners.push((0,t.YZ)(r,"click",this._enableEverywhere.bind(this)));const o=this._document.createElement("lt-div");o.className="lt-dialog__enable-here",o.innerHTML=At.MESSAGES.ENABLE_HERE_BUTTON,this._eventListeners.push((0,t.YZ)(o,"click",this._enableHere.bind(this))),e.appendChild(n),e.appendChild(r),e.appendChild(o),this._controls.contentMain.appendChild(e)}_renderTextTooLongState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const n=this._document.createElement("lt-div");n.className="lt-dialog__premium__headline",n.textContent=At.MESSAGES.TEXT_TOO_LONG_HEADLINE;const r=this._document.createElement("lt-div");r.className="lt-dialog__premium__text",r.textContent=At.MESSAGES.TEXT_TOO_LONG_TEXT;const s=this._document.createElement("lt-div");s.className="lt-dialog__premium__button lt-icon__new_window",s.textContent=At.MESSAGES.TEXT_TOO_LONG_BUTTON;let i="addon2-dialog-text-too-long";d.w.create().onReady((e=>{e.getActiveCoupon()&&(i=i.replace("addon2-dialog","addon2-dialog-countdown")),e.destroy()})),this._eventListeners.push((0,t.YZ)(s,"click",(e=>{e.stopImmediatePropagation();const t={command:"OPEN_PREMIUM_PAGE",campaign:i};(0,o.o)().runtime.sendMessage(t),m.A.trackEvent("Action","dialog:text_too_long:click")}))),e.appendChild(n),e.appendChild(r),e.appendChild(s),this._controls.contentMain.appendChild(e)}_renderLanguageUnsupportedState(){const t=this._document.createElement("lt-div");t.className="lt-dialog__text-wrapper";const n=this._document.createElement("lt-div");n.className="lt-dialog__language-unsupported__headline",n.textContent=At.MESSAGES.UNSUPPORTED_LANGUAGE_HEADLINE;const r=this._document.createElement("lt-div");if(r.className="lt-dialog__language-unsupported__text",r.textContent=At.MESSAGES.UNSUPPORTED_LANGUAGE_TEXT,t.appendChild(n),t.appendChild(r),this._controls.contentMain.appendChild(t),this._controls.languageSelector){const t=this._document.createElement("option");t.disabled=!0,t.selected=!0,t.textContent=At.MESSAGES.UNSUPPORTED_LANGUAGE_LABEL,this._controls.languageSelector.addOption(t);const n=e.e.getURL("/assets/images/flags/not_found.svg");this._controls.languageSelector.setActive(At.MESSAGES.SELECT_LANGUAGE_LABEL,"",{"background-image":`url('${n}') !important`})}}_renderDisconnectedState(){this._controls.footer.remove(),this._controls.headerControlsWrapper.remove();const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.innerHTML=At.MESSAGES.EXTENSION_UPDATED_HEADLINE,t.className="lt-dialog__reload-headline",this._controls.contentMain.appendChild(t);const n=this._document.createElement("lt-div");n.innerHTML=At.MESSAGES.EXTENSION_UPDATED_TEXT,n.className="lt-dialog__reload__text",this._controls.contentMain.appendChild(n),e.appendChild(t),e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderFailedState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const t=this._document.createElement("lt-div");t.className="lt-dialog__exception-headline",t.textContent=At.MESSAGES.Fail_STATE_HEADLINE,e.appendChild(t);const n=this._document.createElement("lt-div");n.className="lt-dialog__exception__text",n.textContent=this._state.checkErrorMessage||At.MESSAGES.Fail_STATE_TEXT,e.appendChild(n),this._controls.contentMain.appendChild(e)}_renderNeedsLanguageHintState(){const e=this._document.createElement("lt-div");e.className="lt-dialog__text-wrapper";const n=this._document.createElement("lt-div");n.className="lt-dialog__needs-language-hint__headline",n.textContent=At.MESSAGES.NEEDS_LANGUAGE_HINT_HEADLINE;const r=this._document.createElement("lt-div");r.className="lt-dialog__needs-language-hint__text",r.textContent=At.MESSAGES.NEEDS_LANGUAGE_HINT_TEXT;const o=this._document.createElement("lt-div");o.className="lt-dialog__needs-language-hint__button",o.textContent=At.MESSAGES.NEEDS_LANGUAGE_HINT_IGNORE,e.appendChild(n),e.appendChild(r),e.appendChild(o),this._controls.contentMain.appendChild(e),this._eventListeners.push((0,t.YZ)(o,"click",(()=>{const e={dialog:this,language:this._controls.languageSelector.getValue()};m.A.trackEvent("Action","dialog:ignore_language_hint"),(0,t.Q9)(document,At.eventNames.languageChanged,e)})))}_onUnload(){this.destroy()}_onKeydown(e){"Escape"===e.key&&(this.destroy(),e.stopImmediatePropagation())}_onLanguageChange(e){e.stopImmediatePropagation();const n={dialog:this,language:this._controls.languageSelector.getValue()};this.setCurrentLanguage(this._controls.languageSelector.getValue()),(0,t.Q9)(document,At.eventNames.languageChanged,n)}_onTogglePickyMode(e){e.stopImmediatePropagation(),this._state.isPickyModeEnabled=!this._state.isPickyModeEnabled,this.setInsignificantChangeMode(!1);const n={dialog:this,isEnabled:this._state.isPickyModeEnabled};(0,t.Q9)(document,At.eventNames.togglePickyMode,n)}_onCountChange(e){e.stopImmediatePropagation(),this._state.countOptions.mode=this._controls.countSelector.getValue(),this.updateCounter(this._state.countOptions);const n={dialog:this,countMode:this._controls.countSelector.getValue()};(0,t.Q9)(document,At.eventNames.countChanged,n)}_onCloseClick(e){e.stopImmediatePropagation(),this._onUnload()}_onHelpIconClick(e){e.stopImmediatePropagation(),this._controls.helpMenu.show()}_onHelpOverlayClick(e){e.stopImmediatePropagation(),this._controls.helpMenu.hide()}_onPositionIconClick(e){e.stopImmediatePropagation(),this._controls.positionMenu.show()}_onPositionOverlayClick(e){e.stopImmediatePropagation(),this._controls.positionMenu.hide()}_onPositionRightClick(e){e.stopImmediatePropagation();const n={dialog:this,newPosition:"right"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("right"),this._position("right"),(0,t.Q9)(document,At.eventNames.positionChangeClicked,n)}_onPositionLeftClick(e){e.stopImmediatePropagation();const n={dialog:this,newPosition:"left"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("left"),this._position("left"),(0,t.Q9)(document,At.eventNames.positionChangeClicked,n)}_onPositionDialogClick(e){e.stopImmediatePropagation();const n={dialog:this,newPosition:"default"};this._controls.positionMenu.hide(),this._controls.positionIcon.setIcon("default"),this._position("default"),(0,t.Q9)(document,At.eventNames.positionChangeClicked,n)}_onSaveTextClick(e){e.stopImmediatePropagation()}_onTurnOffClick(e){e.stopImmediatePropagation();const n={dialog:this};(0,t.Q9)(document,At.eventNames.turnOff,n)}_onPauseCheckingClick(e){e.stopImmediatePropagation();const n={dialog:this};(0,t.Q9)(document,At.eventNames.pauseChecking,n)}_onDisableIconClicked(e){e.stopImmediatePropagation(),this._controls.disableMenu.show()}_onDisableOverlayClick(e){e.stopImmediatePropagation(),this._controls.disableMenu.hide()}_onBadgeClicked(e){e.stopImmediatePropagation();const n={dialog:this};(0,t.Q9)(document,At.eventNames.badgeClicked,n)}_onOptionsClick(e){e.stopImmediatePropagation();const n={dialog:this};(0,t.Q9)(document,At.eventNames.openOptions,n)}_onUserStatisticsClick(t){t.stopImmediatePropagation(),e.e.openWindow("https://languagetool.com/editor/statistics")}_onContentScroll(e){this._controls.content.scrollTop>50?this._controls.headerScoreProgress.classList.add("show"):this._controls.headerScoreProgress.classList.remove("show")}_onIgnoredErrorsClick(e){e.stopImmediatePropagation();let n="personalDictionary";if(e.target){const t=e.target;t.dataset&&"byRules"===t.dataset.type&&(n="ignoredRules")}const r={dialog:this,target:n,ref:"dialog-ignored-errors"};(0,t.Q9)(document,At.eventNames.openOptions,r)}_gotoLanguageTool(t){t.stopImmediatePropagation();let n="https://languagetool.org/?utm_campaign=addon2-dialog";r.A.isSafari()&&(n+="&hidePremium=true"),e.e.openWindow(n)}_gotoHelpCenter(t){t.stopImmediatePropagation(),this._controls.helpMenu.hide(),e.e.openWindow("https://languagetooler.freshdesk.com/support/home")}_showFeedbackForm(e){e.stopImmediatePropagation();const n={dialog:this};this._controls.helpMenu.hide(),(0,t.Q9)(document,At.eventNames.showFeedbackForm,n)}_onErrorHighlighted(e){const n={dialog:this,errorId:e};(0,t.Q9)(document,At.eventNames.errorHighlighted,n)}_onErrorSelected(e){const n={dialog:this,errorId:e};(0,t.Q9)(document,At.eventNames.errorSelected,n)}_onMoreDetailsClick(e,n){n.stopImmediatePropagation();const r={dialog:this,url:e.value};(0,t.Q9)(document,At.eventNames.moreDetailsClicked,r)}_onCorrectAll(e,n,r){r.stopImmediatePropagation();const o={dialog:this,config:n,selectedError:e};(0,t.Q9)(document,At.eventNames.correctAll,o)}_onFixClick(e,n,r){r.stopImmediatePropagation(),this._inApplyFixMode=!0;const o={dialog:this,error:e,fixIndex:n,selectNextError:!1};(0,t.Q9)(document,At.eventNames.fixSelected,o)}_onAddToDictionaryClick(e,n){n.stopImmediatePropagation(),this._inApplyFixMode=!0;const r={dialog:this,error:e,selectNextError:!1};(0,t.Q9)(document,At.eventNames.addToDictionaryClicked,r)}_onIgnoreRuleClick(e,n){n.stopImmediatePropagation(),this._inApplyFixMode=!0;const r={dialog:this,error:e,selectNextError:!1};(0,t.Q9)(document,At.eventNames.ignoreRuleClicked,r)}_onTemporarilyIgnoreWordClick(e,n){n.stopImmediatePropagation(),this._inApplyFixMode=!0;const r={dialog:this,error:e,selectNextError:!1};(0,t.Q9)(document,At.eventNames.temporarilyIgnoreWordClicked,r)}_onTemporarilyIgnoreRuleClick(e,n){n.stopImmediatePropagation(),this._inApplyFixMode=!0;const r={dialog:this,error:e,selectNextError:!1};(0,t.Q9)(document,At.eventNames.temporarilyIgnoreRuleClicked,r)}_enableEverywhere(e){e.stopImmediatePropagation();const n={dialog:this};(0,t.Q9)(document,At.eventNames.enableEverywhere,n)}_enableHere(e){e.stopImmediatePropagation();const n={dialog:this};(0,t.Q9)(document,At.eventNames.enableHere,n)}getCurrentPosition(){return this._uiOptions.dialogPosition}updateState(e){(0,u.m)(this._state,e)||(this._state=Object.assign(this._state||{},e),this._updateContent())}setCurrentLanguage(t){if(!e.e.isRuntimeConnected())return;t=t.toLowerCase();const n=_.E.LANGUAGES.find((e=>e.code===t))||_.E.LANGUAGES.find((e=>t.startsWith(e.code)))||_.E.LANGUAGES.find((e=>"en-us"===e.code)),r=e.e.getURL("/assets/images/flags/"+n.code+".svg");this._controls.languageSelector&&this._controls.languageSelector.setActive(this._shortenLanguageName(n.name),n.code,{"background-image":`url('${r}') !important`})}_shortenLanguageName(e){return e.split(" ",1)[0]}updateCounter(e){this._controls.countSelector&&(this._controls.countSelector.setActive(this._getCountString(e,e.mode),e.mode,{}),this._controls.countSelector.updateOptionLable("characters",this._getCountString(e,"characters")),this._controls.countSelector.updateOptionLable("sentences",this._getCountString(e,"sentences")),this._controls.countSelector.updateOptionLable("words",this._getCountString(e,"words")))}setInsignificantChangeMode(e){this._inInsignificantChangeMode=e}setApplyFixMode(e){this._inApplyFixMode=e}closeAllMenus(){this._menus.forEach((e=>{e.hide()}))}fadeOut(){this._controls.innerContainer.classList.add("lt-dialog--faded")}fadeIn(){this._controls.innerContainer.classList.remove("lt-dialog--faded")}destroy(){(0,t.M5)(this._controls.container,(()=>{this._toolbarContainer.classList.remove("lt-toolbar--dialog-opened")})),this._controls.languageSelector?.destroy(),this._ratingTeaser?.destroy(),this._controls={},self.removeEventListener("pagehide",this._onUnload,!0),this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[];const e={dialog:this};this._premiumTeaser?.destroy(),(0,t.Q9)(document,At.eventNames.destroyed,e)}}At.CONTAINER_ELEMENT_NAME="lt-dialog",At.SPACE_TO_SCREEN_EDGE=5,At.eventNames={turnOff:"lt-dialog.turnOff",pauseChecking:"lt-dialog.pauseChecking",enableHere:"lt-dialog.enableHere",enableEverywhere:"lt-dialog.enableEverywhere",languageChanged:"lt-dialog.languageChanged",countChanged:"lt-dialog.countChanged",errorSelected:"lt-dialog.errorSelected",errorHighlighted:"lt-dialog.errorHighlighted",addToDictionaryClicked:"lt-dialog.addToDictionaryClicked",ignoreRuleClicked:"lt-dialog.ignoreRuleClicked",temporarilyIgnoreWordClicked:"lt-dialog.temporarilyIgnoreWordClicked",temporarilyIgnoreRuleClicked:"lt-dialog.temporarilyIgnoreRuleClicked",moreDetailsClicked:"lt-dialog.moreDetailsClicked",fixSelected:"lt-dialog.fixSelected",openOptions:"lt-dialog.openOptions",showFeedbackForm:"lt-dialog.showFeedbackForm",destroyed:"lt-dialog.destroyed",togglePickyMode:"lt-dialog.togglePickyMode",positionChangeClicked:"lt-dialog.positionChangeClicked",badgeClicked:"lt-dialog.badgeClicked",premiumTeaserClicked:"lt-dialog.premiumTeaserClicked",correctAll:"lt-dialog.correctAll"},At._isInitialized=!1;

98

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

99

class Tt{}Tt.eventNames={input:"lt-mirror.input",click:"lt-mirror.click"},Tt.FLEX_GRID_DISPLAY_VALUES=["grid","inline-grid","flex","inline-flex"];

100

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

101

class St extends Tt{constructor(n,o){super(),this._shadowRoot=null,this._firefoxHackEnabled=!1,this._render=()=>{if(!this._mimickedElement.parentElement)return;this._domMeasurement.clearCache();const n=this._domMeasurement.getContentBox(this._mimickedElement,!1,!1),o=this._domMeasurement.getContentBox(this._mimickedElement,!1);if(!this._container){if(this._container=(0,t.KY)(document,St.CONTAINER_ELEMENT_NAME),this._container.style.display="none",this._wrapper=document.createElement("lt-div"),this._wrapper.setAttribute("spellcheck","false"),this._wrapper.className="lt-mirror__wrapper notranslate",this._canvas=document.createElement("lt-div"),this._canvas.className="lt-mirror__canvas",this._wrapper.appendChild(this._canvas),this._container.appendChild(this._wrapper),this._canUseShadowDom())try{this._shadowRoot=this._mimickedElement.parentElement.attachShadow({mode:"closed"}),this._shadowRoot.appendChild(document.createElement("slot")),e.e.injectShadowStyles(this._shadowRoot)}catch{}if(r.A.isFirefox()||r.A.isThunderbird()){this._elementInlineLineHeight=this._domMeasurement.getInlineStyle(this._mimickedElement,"line-height"),this._elementComputedLineHeight=this._domMeasurement.getStyle(this._mimickedElement,"line-height");this._domMeasurement.getStyle(this._mimickedElement,"transition-property").match(/all|line\-height/)||(this._firefoxHackEnabled=!0)}const n=this._domMeasurement.getStyle(this._mimickedElement.parentElement,"display");Tt.FLEX_GRID_DISPLAY_VALUES.includes(n)&&this._container.classList.add("lt-mirror--grid-item")}this._firefoxHackEnabled&&(this._mimickedElement.style.lineHeight===this._elementComputedLineHeight?this._domMeasurement.setStyles(this._mimickedElement,{"line-height":this._elementInlineLineHeight||""}):this._elementInlineLineHeight=this._domMeasurement.getInlineStyle(this._mimickedElement,"lineHeight"),this._elementComputedLineHeight=this._domMeasurement.getStyle(this._mimickedElement,"line-height"),this._elementComputedLineHeight.includes("px")&&this._domMeasurement.setStyles(this._mimickedElement,{"line-height":this._elementComputedLineHeight}));const s=this._domMeasurement.getStyles(this._mimickedElement,St.MIMICKED_ELEMENT_COPIED_PROPERTIES);s["font-size"]=this._getWrapperFontSizeValue(s["font-size"]),s["line-height"]=this._domMeasurement.getExactStyle(this._mimickedElement,"line-height"),s["white-space"]=this._getWrapperWhiteSpaceValue(s["white-space"]),(0,u.m)(s,this._wrapperStyles)||(this._domMeasurement.resetStyles(this._wrapper,s,!0),this._wrapperStyles=s),this._updateText(),this._addContainer(),this._domMeasurement.setStyles(this._wrapper,{width:n.width+"px",height:n.height+"px"},!0);const i=this._domMeasurement.getContentBox(this._wrapper,!1);if(i.width>0&&i.height>0){const e=o.left-i.left;if(Math.abs(e)>.05){const t=this._domMeasurement.getScaleFactor(this._wrapper),n=this._domMeasurement.getZoom(this._wrapper),r=t.x*n;let o=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-left"));o=(o*r+e)/r,this._domMeasurement.setStyles(this._wrapper,{"margin-left":o+"px"},!0)}const t=o.top-i.top;if(Math.abs(t)>.05){const e=this._domMeasurement.getScaleFactor(this._wrapper),n=this._domMeasurement.getZoom(this._wrapper),r=e.y*n;let o=parseFloat(this._domMeasurement.getStyle(this._wrapper,"margin-top"));o=(o*r+t)/r,this._domMeasurement.setStyles(this._wrapper,{"margin-top":o+"px"},!0)}}const a=this._domMeasurement.getScrollDimensions(this._mimickedElement,!1);let l=a.width-n.padding.left-n.padding.right,c=a.height-n.padding.top-n.padding.bottom;l===Math.round(n.width)&&(l=n.width),this._domMeasurement.setStyles(this._canvas,{width:l+"px",height:c+"px"},!0),this._updateScrolling(!1)},this._updateText=()=>{const e=this._mimickedElement.value;this._currentText!==e&&(this._currentText=e,this._canvas.textContent=e,this._updateScrolling(),this._dispatchInput())},this._onMimickedElementScroll=()=>{requestAnimationFrame((()=>{this._updateScrolling()}))},this._onMimickedElementClick=e=>{void 0!==e.clientX&&void 0!==e.clientY&&this._dispatchClick(e)},this._mimickedElement=n,this._useShadowDom=o,this._domMeasurement=new p.o(this._mimickedElement.ownerDocument),this._isRoamResearchIssue=Boolean(location.hostname.match(/roamresearch/)&&n.closest(".roam-article")),this._isHootsuiteIssue=Boolean(location.hostname.match(/hootsuite/)&&n.closest(".rc-TextArea")),this._isDotSyntaxHighlighterIssue=Boolean(n.previousElementSibling&&"wpTextbox0"===n.previousElementSibling.id),this._render(),this._mimickedElement.addEventListener("scroll",this._onMimickedElementScroll),this._mimickedElement.addEventListener("click",this._onMimickedElementClick),this._mimickedElement.addEventListener("input",this._updateText),self.ResizeObserver&&(this._mimickedElementResizeObserver=new self.ResizeObserver(this._render),this._mimickedElementResizeObserver.observe(this._mimickedElement)),this._renderInterval=(0,t.Gc)(this._render,l.RENDER_INTERVAL)}_dispatchClick(e){const t=new MouseEvent(Tt.eventNames.click,{view:self,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,bubbles:!0,cancelable:!0});this._wrapper.dispatchEvent(t)}_dispatchInput(){const e=new Event(Tt.eventNames.input,{bubbles:!0,cancelable:!0});this._addContainer(),this._wrapper.dispatchEvent(e)}_getTargetElement(){return this._isRoamResearchIssue||this._isHootsuiteIssue||this._isDotSyntaxHighlighterIssue?this._mimickedElement.parentNode:this._mimickedElement}_canUseShadowDom(){if(!this._useShadowDom)return!1;const e=this._mimickedElement.parentElement;return!!e&&(!e.shadowRoot&&(0,t.yg)(e))}_addContainer(){if(this._shadowRoot)this._shadowRoot.firstChild!==this._container&&this._shadowRoot.prepend(this._container);else{const t=this._getTargetElement();t.previousElementSibling!==this._container&&t.parentElement&&(t.parentElement.insertBefore(this._container,t),e.e.linkInputAreaProperties(this._container.ownerDocument))}}_getTextZoom(e=!1){if(e&&this._domMeasurement.clearCache(),!this._container)return 1;if(!r.A.isFirefox()&&!r.A.isThunderbird())return 1;this._measurer||(this._measurer=document.createElement("lt-div"),this._measurer.className="lt-mirror__measurer",this._container.appendChild(this._measurer));return(Number.parseInt(this._domMeasurement.getStyle(this._measurer,"font-size"))||0)/100}_getWrapperFontSizeValue(e){const t=this._getTextZoom();if(1===t)return e;return(Number.parseFloat(e)||0)/t+"px"}_getWrapperWhiteSpaceValue(e){if(r.A.isChromium()){if("normal"===e)return"pre-wrap";if("nowrap"===e)return"pre"}return e}_updateScrolling(e=!0){e&&this._domMeasurement.clearCache();const t=this._domMeasurement.getScrollPosition(this._mimickedElement,!1),n=this._domMeasurement.getScrollPosition(this._mimickedElement,!0,!1),r=this._domMeasurement.getScrollPosition(this._mimickedElement);this._domMeasurement.setStyles(this._canvas,{"margin-top":-t.top+"px","margin-left":-t.left+"px"},!0),this._wrapper.dataset.ltScrollTop=t.top.toString(),this._wrapper.dataset.ltScrollLeft=t.left.toString(),this._wrapper.dataset.ltScrollTopScaled=n.top.toString(),this._wrapper.dataset.ltScrollLeftScaled=n.left.toString(),this._wrapper.dataset.ltScrollTopScaledAndZoomed=r.top.toString(),this._wrapper.dataset.ltScrollLeftScaledAndZoomed=r.left.toString()}getCloneElement(){return this._wrapper}getTextElement(){return this._canvas}enableRangeMeasurements(){this._wrapper.classList.add("lt-mirror-enable-range-measurement")}disableRangeMeasurements(){this._wrapper.classList.remove("lt-mirror-enable-range-measurement")}destroy(){this._mimickedElement.removeEventListener("input",this._updateText),this._mimickedElement.removeEventListener("scroll",this._onMimickedElementScroll),this._mimickedElement.removeEventListener("click",this._onMimickedElementClick),this._renderInterval&&this._renderInterval.destroy(),this._container&&this._container.remove(),this._mimickedElementResizeObserver&&this._mimickedElementResizeObserver.disconnect(),this._domMeasurement.clearCache()}}St.CONTAINER_ELEMENT_NAME="lt-mirror",St.MIMICKED_ELEMENT_COPIED_PROPERTIES=["border","border-radius","border-top-width","border-right-width","border-left-width","border-bottom-width","border-top-style","border-right-style","border-left-style","border-bottom-style","direction","font","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-weight","hyphens","letter-spacing","line-break","margin","margin-top","margin-left","margin-bottom","margin-right","padding","padding-top","padding-left","padding-right","padding-bottom","text-align","text-decoration","text-indent","text-rendering","text-transform","transform","transform-origin","unicode-bidi","white-space","word-spacing","word-wrap","writing-mode","zoom","-webkit-locale","-webkit-rtl-ordering"];

102

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

103

class yt extends lt{constructor(e,t,n,r=Number.MAX_SAFE_INTEGER){super(e,n,r),this._scrollToInterval=null,this._mirror=t,this._mirrorElement=t.getCloneElement(),this._ceElementInspector=new it(this._mirrorElement,this._tweaks.getParsingDetector()),this._domMeasurement=new p.o(this._inputArea.ownerDocument),this._scrollTop=this._inputArea.scrollTop,this._scrollLeft=this._inputArea.scrollLeft,this._updateText(),this._onDblClick=this._onDblClick.bind(this),this._onScroll=this._onScroll.bind(this),this._inputArea.addEventListener("dblclick",this._onDblClick),this._tweaks.addScrollEventListener(this._onScroll),this._mirrorElement.addEventListener(Tt.eventNames.input,this._onInput)}_onDblClick(e){const n=(0,u.K2)(this._tweaks.getSelectedText()),r=this.getSelection();if(!n||!r)return;const o=r.end||r.start,s=this.getTextRanges(r.start,o-r.start);if(!s.length)return;this._domMeasurement.clearCache();const i=this._domMeasurement.getTextBoundingBoxes(s,this._mirrorElement),a=this._domMeasurement.getTextBoundingBoxes(s,this._mirrorElement,!1);if(!i.length)return;if(!a.some((n=>(0,t.nE)(n,e.clientX,e.clientY))))return;const l={inputAreaWrapper:this,selectedText:n,selection:r,clickedRectangles:i};(0,t.Q9)(document,lt.eventNames.dblclick,l)}_onScroll(){const e=this._inputArea.scrollTop,n=this._inputArea.scrollLeft;if(this._scrollTop===e&&this._scrollLeft===n)return;this._scrollTop=e,this._scrollLeft=n;const r={inputAreaWrapper:this};(0,t.Q9)(document,lt.eventNames.scroll,r)}_hasSpaceBefore(e){if(e<=0||0===this._textChunks.length)return!1;const t=this._textChunks[0],n=this._offsetInRawText(t.rawText,t.parsedText,e-1),r=this._offsetInRawText(t.rawText,t.parsedText,e);return yt.VISIBLE_WHITE_SPACE_REGEXP.test(t.rawText.substring(n,r))}_hasSpaceAfter(e){if(0===this._textChunks.length)return!1;const t=this._textChunks[0],n=this._offsetInRawText(t.rawText,t.parsedText,e),r=this._offsetInRawText(t.rawText,t.parsedText,e+1);return yt.VISIBLE_WHITE_SPACE_REGEXP.test(t.rawText.substring(n,r))}_offsetInRawText(e,t,n){n=Math.min(e.length,n);const r=(0,u.w$)(e);if(-1===r||n<r)return n;let o=r,s=r;do{if((0,u.Av)(e[o])||s++,s>n)break;o++}while(o<e.length);return o}_offsetInParsedText(e,t,n){let r=0;for(let t=0;t<Math.min(e.length,n);t++)(0,u.Av)(e[t])&&r++;return n-r}_updateText(){const e=[];let t="";const n=this._mirror.getTextElement().firstChild;if(n){const r=n.textContent||"";t=this._ceElementInspector.getParsedText(n),e.push({node:n,isTextNode:!0,rawText:r,parsedText:t,parsedTextOffset:0})}const r=this._text!==t;return this._text=t,this._textChunks=e,r}_getTextOffset(e,n){let r=null,o=0;if((0,t.iS)(e)){const s=st.create(this._mirrorElement);do{const o=s.currentNode;if(o===e.childNodes[n])break;(0,t.sd)(o)&&o.textContent&&(r=o)}while(s.next());if(!r)return-1;o=r.textContent.length}else(0,t.sd)(e)&&(r=e,o=n);const s=this._textChunks.find((e=>e.node===r));return s?s.parsedTextOffset+this._offsetInParsedText(s.rawText,s.parsedText,o):-1}getTextBoxes(e,t){const n=this.getTextRanges(e,t);return n.length?(this._domMeasurement.clearCache(),this._domMeasurement.getTextBoundingBoxes(n,this._mirrorElement)):[]}resetText(){const e=this._inputArea.value;this._inputArea.value="",this._inputArea.value=e}replaceText(e,t,n){if(e<0||0===this._textChunks.length)return Promise.resolve();const o=e+n.length;""===n&&(this._hasSpaceBefore(e)||0===e)&&this._hasSpaceAfter(e+t)&&(e=Math.max(e-1,0),t+=1),this.setSelection({start:e,end:e+t});let s=document.execCommand("insertText",!1,n);""===n&&(r.A.isFirefox()||r.A.isThunderbird())&&(s=!1);const i=(r.A.isFirefox()||r.A.isThunderbird())&&n.includes(yt.NBSP);if(s){if(i){const t=this._inputArea.value,r=this._textChunks[0],o=this._offsetInRawText(t,r.parsedText,e),s=this._offsetInRawText(t,r.parsedText,e+n.length),i=t.substring(0,o)+n+t.substring(s);this._inputArea.value=i}}else{const r=this._textChunks[0],o=this._offsetInRawText(r.rawText,r.parsedText,e),s=this._offsetInRawText(r.rawText,r.parsedText,e+t),i=r.rawText.substring(0,o)+n+r.rawText.substring(s);this._inputArea.value=i}return this.setSelection({start:o}),s||this.simulateInput(n),Promise.resolve()}getSelection(){if(this._inputArea!==(0,t.Si)())return null;const e=this.getText();return{start:this._offsetInParsedText(this._inputArea.value,e,this._inputArea.selectionStart),end:this._offsetInParsedText(this._inputArea.value,e,this._inputArea.selectionEnd)}}setSelection(e){const t=e.start,n=void 0===e.end?t:e.end;if(this._inputArea.focus(),0===this._textChunks.length)return;const r=this._textChunks[0];this._inputArea.selectionStart=this._offsetInRawText(r.rawText,r.parsedText,t),this._inputArea.selectionEnd=this._offsetInRawText(r.rawText,r.parsedText,n)}getWordAtPoint(e,n){this._mirror.enableRangeMeasurements();const r=(0,t.E9)({x:e,y:n});this._mirror.disableRangeMeasurements();if(!(r&&this._mirrorElement.contains(r.startContainer)&&r.startContainer.nodeType===this._inputArea.ownerDocument.TEXT_NODE))return null;const o=this._getTextOffset(r.startContainer,r.startOffset),s=this.getText();return(0,u.EJ)(s,o,o)||(0,u.i0)(s,o)}scrollToText(e,n,r="smooth",o="nearest",s=!1,i){if(s&&this.isTextRangeInViewport(e,n))return void i?.();const a="smooth"===r?300:0;function l(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}if(e<0)return;"smart"===o&&(o="center");this._scrollToInterval&&(this._scrollToInterval.destroy(),this._scrollToInterval=null);const u=this._inputArea.scrollTop,c=this._inputArea.scrollLeft;this._domMeasurement.clearCache();const d=this.getTextRanges(e,n),g=this._domMeasurement.getRelativeTextBoundingBox(d,this._mirrorElement),m=this._inputArea.getBoundingClientRect();let h=this._inputArea.scrollTop+g.top;"center"===o&&(h-=this._inputArea.clientHeight/2,h-=g.height/2),m.top<0&&(h+=m.top);let p=this._inputArea.scrollLeft+g.left;m.left<0&&(p+=m.left);const _=h-u,E=p-c;let f=0;this._scrollToInterval=(0,t.Gc)((()=>{f+=yt.SCROLL_TO_FRAME_INTERVAL;const e=l(f,u,_,a),t=l(f,c,E,a);this._inputArea.scrollTop=e,this._inputArea.scrollLeft=t,f>=a&&(this._scrollToInterval&&(this._scrollToInterval.destroy(),this._scrollToInterval=null),i&&setTimeout((()=>i()),50))}),yt.SCROLL_TO_FRAME_INTERVAL)}isTextRangeInViewport(e,t){this._domMeasurement.clearCache();const n=this.getTextRanges(e,t),{top:r,bottom:o,left:s}=this._domMeasurement.getRelativeTextBoundingBox(n,this._mirrorElement),{height:i}=this._inputArea.getBoundingClientRect();return!(r<0||o>i)&&!(s<0)}destroy(){super.destroy(),this._inputArea.removeEventListener("dblclick",this._onDblClick),this._tweaks.removeScrollEventListener(this._onScroll),this._mirrorElement.removeEventListener(Tt.eventNames.input,this._onInput),this._ceElementInspector.destroy(),this._scrollToInterval&&this._scrollToInterval.destroy()}}yt.SCROLL_TO_FRAME_INTERVAL=20,yt.NBSP=String.fromCharCode(160),yt.VISIBLE_WHITE_SPACE_REGEXP=/\u00A0|\u0020|\u2009|\u202F/;const bt="lt-icon-view.set-text-direction",vt=({root:e,onClick:t,onMouseOver:n,onMouseOut:r,...o})=>{const[s,i]=(0,h.useState)();return(0,h.useEffect)((()=>{const t=e=>{i(e.detail.isRTL)};return e?.addEventListener(bt,t),()=>{e?.removeEventListener(bt,t)}}),[e,i]),(0,E.jsx)(Y,{...o,isRTL:s,onClick:t,onMouseOver:n,onMouseOut:r})};async function xt(e,n){const r=(0,t.kv)(e)?n:{...n,root:e};return await I.createView(e,vt,r)}vt.displayName="IconView";const Rt=v("comp-menu"),It=e=>{const{isActive:n,position:r,menuItems:o}=e;return(0,E.jsx)(Rt,{className:(0,t.iE)(n&&"lt-menu--show","top"===r&&"lt-menu--position-top","bottom"===r&&"lt-menu--position-bottom"),"data-lt-prevent-focus":!0,children:o.map((e=>(0,E.jsx)(x,{className:(0,t.iE)("lt-menu__item","pause"===e.name&&"lt-menu__item--pause","pause"===e.name&&"lt-icon__pause","disable"===e.name&&"lt-menu__item--disable","disable"===e.name&&"lt-icon__disable","disable_circle"===e.name&&"lt-menu__item--disable_circle","disable_circle"===e.name&&"lt-icon__disable_circle",e.isClickable&&"lt-menu__item--clickable"),onClick:t=>((e,t)=>{t.isClickable&&t.onClick(e)})(t,e),onMouseDown:e=>e.preventDefault(),children:(0,E.jsx)(R,{className:(0,t.iE)("lt-menu__item__label","pause"===e.name&&"lt-menu__item__label--pause","disable"===e.name&&"lt-menu__item__label--disable","disable_circle"===e.name&&"lt-menu__item__label--disable_circle"),children:e.label})},e.label)))})},Lt=e=>(0,E.jsx)(It,{...e});Lt.displayName="MenuView";class Nt{constructor(e,t,n,r,o,s){this._className=e,this._type=t,this._headline=n,this._description=r,this._position=o,this._parentElement=s,this._document=s.ownerDocument,this._render()}_render(){this._element=this._document.createElement("lt-div"),this._element.classList.add("lt-hint","lt-position--"+this._position,"lt-hint--"+this._type),this._className&&this._element.classList.add("lt-hint--"+this._className);const e=document.createElement("lt-div");e.className="lt-hint__headline",e.textContent=this._headline,this._element.appendChild(e);const t=document.createElement("lt-div");t.className="lt-hint__text",t.textContent=this._description,this._element.appendChild(t),this._close=document.createElement("lt-span"),this._close.className="lt-hint__close",this._element.appendChild(this._close),this._parentElement.appendChild(this._element)}getElement(){return this._element}getClose(){return this._close}}

104

/*! (C) Copyright 2021 LanguageTooler GmbH. All rights reserved. */

105

class kt{constructor(e,t){this._onMutations=this._onMutations.bind(this),this._callback=e,this._isIgnored=t,this._wrappedObserver=new MutationObserver(this._onMutations)}_onMutations(e){const t=e.filter((e=>!this._isIgnored(e)));t.length>0&&this._callback(t,this)}observe(e,t={}){this._wrappedObserver.observe(e,t)}disconnect(){this._wrappedObserver.disconnect()}takeRecords(){return this._wrappedObserver.takeRecords()}}

106

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

107

class wt{static _getIframeWin(){const e=document.querySelector(this.PASTE_IFRAME_SELECTOR);return e&&e.contentWindow||null}static _getMode(){return document.querySelector("#docs-access-level-indicator div.docs-access-level-indicator-icon-container div.docs-icon-acl-comment-only-on-brand-color-background")?"comment":document.querySelector("#docs-access-level-indicator")?"view":"edit"}static _checkMode(){const e=this._getMode();this._currentMode?e!==this._currentMode&&(this._currentMode=e,this._onModeChangedCallbacks.forEach((t=>t(e)))):this._currentMode=e}static _isInView(e){const t=e.closest("svg");return!!t&&"none"!==this._domMeasurement.getStyle(t,"display")}static _checkForNewSlides(){if("view"===this._currentMode)return;document.querySelectorAll(this.UNHANDLED_SLIDE_SELECTOR).forEach((e=>{this._isInView(e)&&this._onNewSlideCallbacks.forEach((t=>t(e)))}))}static _checkOutOfViewSlides(){this._onSlideOutOfViewCallbacks.forEach(((e,t)=>{this._isInView(t)||e(t)}))}static _addMenuBarButton(){if(this._menuBarButton)return;const t=document.querySelector("#insertCommentButton");t&&t.parentNode&&(this._menuBarButton=document.createElement("div"),this._menuBarButton.className="lt-gdocs-menubar-button goog-toolbar-button goog-toolbar-toggle-button goog-inline-block",this._menuBarButton.setAttribute("role","button"),this._menuBarButton.setAttribute("aria-disabled","false"),this._menuBarButton.setAttribute("aria-hidden","false"),this._menuBarButton.id="enableLTButton",this._menuBarButton.style.userSelect="none",this._menuBarButton.addEventListener("click",(()=>{if(!this._storageController)return;const t=this.getPresentationId(location.href);t&&(this._menuBarButton.classList.contains("goog-toolbar-button-checked")?(this._storageController.disableEditorGroup((0,u.cD)(),t),e.e.ltAssistantStatusChanged({enabled:!1})):(this._storageController.enableDomainAndEditorGroup((0,u.cD)(),t),e.e.ltAssistantStatusChanged({enabled:!0})))}),!0),this._menuBarSeparator=document.createElement("div"),this._menuBarSeparator.className="docs-toolbar-small-separator goog-toolbar-separator goog-inline-block",this._menuBarSeparator.setAttribute("role","separator"),this._menuBarSeparator.setAttribute("aria-disabled","true"),this._menuBarSeparator.setAttribute("aria-hidden","false"),this._menuBarSeparator.id="enableLTSeparator",this._menuBarSeparator.style.userSelect="none",t.parentNode.insertBefore(this._menuBarButton,t.nextSibling),t.parentNode.insertBefore(this._menuBarSeparator,t.nextSibling),this._toggleMenuBarButton())}static _removeMenuBarButton(){this._menuBarButton&&(this._menuBarButton.remove(),this._menuBarButton=null),this._menuBarSeparator&&(this._menuBarSeparator.remove(),this._menuBarSeparator=null)}static _setMenuBarButtonActive(){this._menuBarButton&&(this._menuBarButton.classList.add("goog-toolbar-button-checked"),this._menuBarButton.setAttribute("aria-label",i.e.getMessage("googleSlideDisableButton")),this._menuBarButton.setAttribute("data-tooltip",i.e.getMessage("googleSlideDisableButton")))}static _setMenuBarButtonUnactive(e=!1){this._menuBarButton&&(this._menuBarButton.classList.remove("goog-toolbar-button-checked"),this._menuBarButton.setAttribute("aria-label",i.e.getMessage("googleSlideEnableButton")),this._menuBarButton.setAttribute("data-tooltip",i.e.getMessage("googleSlideEnableButton")),e&&this._showMenuBarHint())}static _toggleMenuBarButton(e=!1){if(!this._storageController)return;const t=this.getPresentationId(location.href);if(!t)return;const n=(0,u.cD)(),r=this._storageController.getCheckSettings(n,t);r.isEditorGroupDisabled||r.isDomainDisabled?this._setMenuBarButtonUnactive(e):this._setMenuBarButtonActive()}static _showMenuBarHint(){if(this._menuBarHint||!this._menuBarButton||!this._storageController)return;const{hasSeenGoogleDocsMenuBarHint:e}=this._storageController.getUIState();if(e)return;const t=this._menuBarButton.offsetHeight?this._menuBarButton:document.querySelector("#moreButton");if(!t)return;const n=t.getBoundingClientRect();this._menuBarHint=document.createElement("div"),this._menuBarHint.classList.add("lt-gdocs-hint"),this._menuBarHint.style.top=n.bottom+"px",this._menuBarHint.style.right=self.innerWidth-n.right+"px",this._menuBarHint.textContent=i.e.getMessage("googleSlidesEnableHint");const r=document.createElement("span");r.classList.add("lt-gdocs-hint__close"),r.addEventListener("click",(e=>{e.stopImmediatePropagation(),this._removeMenuBarHint(!0)}),!0),this._menuBarHint.appendChild(r),document.body.appendChild(this._menuBarHint),this._onInput((()=>this._removeMenuBarHint(!0)),!0)}static _removeMenuBarHint(e=!1){this._menuBarHint&&(e?(0,t.M5)(this._menuBarHint):this._menuBarHint.remove(),this._menuBarHint=null,e&&this._storageController&&this._storageController.updateUIState({hasSeenGoogleDocsMenuBarHint:!0}))}static _showTeaser(){const e=Array.from(document.querySelectorAll(`.${this.TOOLBAR_CLASS_NAME}`));if(!e.length)return;const t=e.find((e=>{const t=e.getBoundingClientRect();return t.top>=0&&t.top<self.innerHeight&&t.width>0}));if(!t)return;const n=new Nt("","google-slides",i.e.getMessage("googleSlidesNewTeaserHeadline"),i.e.getMessage("googleSlidesNewTeaserText"),"bottom-left",t),r=()=>{n.getElement().remove(),n&&n.getElement().classList.remove("lt-toolbar--hint-opened"),this._storageController&&this._storageController.updateUIState({hasSeenNewGoogleSlidesTeaser:!0})};n.getClose().addEventListener("click",(e=>{e.stopImmediatePropagation(),e.preventDefault(),r()}),!0),t.classList.add("lt-toolbar--hint-opened"),t.addEventListener("mouseup",(e=>{e.target instanceof HTMLElement&&n.getElement().contains(e.target)||r()}),{capture:!0,once:!0}),this._onInput((()=>r()),!0)}static _onInput(e,t=!1){const n=this._getIframeWin();n&&n.document&&n.document.addEventListener("keydown",(t=>{["Control","Shift","Meta","Alt"].includes(t.key)||e()}),{capture:!0,once:t})}static _isCursor(e){if(!(e instanceof HTMLElement||e instanceof SVGElement))return!1;const t=parseFloat(e.getAttribute("width")||"");return"RECT"===e.tagName.toUpperCase()&&0===e.childElementCount&&"crispEdges"===e.getAttribute("shape-rendering")&&t<=5}static _getRangeByRect(e,n=!1,r=0){const o=e.left-r,s=e.right+r,i=n?-1:1;for(let r=.25;r<1;r+=.25){let a=n?s:o;const l=e.top+e.height*r;do{const e=(0,t.E9)({x:a,y:l});if(e&&(0,t.sd)(e.startContainer)&&(0,t.sd)(e.endContainer))return e;a+=i}while(o<=a&&a<=s)}return null}static _getTextClientRects(e,t,n){if(r.A.isSafari()){const r=e.getBoundingClientRect(),o=parseFloat(e.getAttribute("x")||"0"),s=e.getStartPositionOfChar(t.start),i=e.getEndPositionOfChar(t.end-1),a=r.left+(s.x-o)*n.x,l=r.left+(i.x-o)*n.x;return[{left:a,top:r.top,right:l,bottom:r.bottom,height:r.height,width:l-a}]}{const e=document.createRange();return e.setStart(t.node,t.start),e.setEnd(t.node,t.end),Array.from(e.getClientRects())}}static _getRelativeTextBoundingBoxes(e,t,n){Array.isArray(t)||(t=[t]);let r=[];const o=e.getPaddingBox(n,!1,!1),s=o.left,i=o.top,a=e.getScaleFactor(n);for(const e of t)try{const t=this._getTextClientRects(e.node.parentElement,e,a);for(const e of t){if(e.width<p.o.MIN_TEXT_BOX_WIDTH)continue;const t=r[r.length-1],n=e.top-i,o=e.right-s,a=e.bottom-i,l=e.left-s,u=e.width,c=e.height;t&&t.right===l&&t.top===n&&t.bottom===a&&t.height===c?(t.right=o,t.width=t.width+u):r.push({top:n,right:o,bottom:a,left:l,width:u,height:c})}}catch(e){console.error("LT range error",e)}for(const e of r)e.top=Math.round(e.top/a.y),e.right=Math.round(e.right/a.x),e.bottom=Math.round(e.bottom/a.y),e.left=Math.round(e.left/a.x),e.width=e.right-e.left,e.height=e.bottom-e.top;return r}static _getTrailingBoxes(e,t){function n(e,t,o){const s=e.start===e.end,i=e.node.textContent.length||0,a=0!==e.start||e.end!==i;return s?function(e,t,r){const o=e.node.textContent?.length||0;if(0===o)return[];const s=0===e.start,i=0,a=s?1:e.end,l=n({node:e.node,start:i,end:a,text:e.node.textContent||""},t,r);if(0===l.length)return[];const u=l[s?0:l.length-1];return[{top:u.top,right:s?u.left:u.right,bottom:u.bottom,left:s?u.left:u.right,width:0,height:u.height}]}(e,t,o):a?function(e,t,n){if(!r.A.isFirefox()&&!r.A.isSafari())return n.getTextBoundingBoxes(e,t,!1);const o=e.node.textContent||"";o.length;let s=e.node.parentElement;if(!(s&&s instanceof SVGTextElement))return[];if(!s.parentElement)return[];const i={node:e.node,start:0,end:o.length,text:o},a=n.getTextBoundingBoxes(i,t,!1);if(0===a.length)return[];let l=document.createElementNS("http://www.w3.org/2000/svg","text");for(let e=0;e<s.attributes.length;e++){const t=s.attributes[e];l.setAttribute(t.name,t.value)}s.parentElement.appendChild(l);let u=0;if(0!==e.start){l.textContent=o.substring(0,e.start);const r={node:l.firstChild,start:0,end:e.start,text:o},s=n.getTextBoundingBoxes(r,t,!1);s.length>0&&(u=s[0].width)}let c=0;if(e.end!==o.length){l.textContent=o.substring(e.end);const r={node:l.firstChild,start:0,end:o.length-e.end,text:o},s=n.getTextBoundingBoxes(r,t,!1);s.length>0&&(c=s[0].width)}l.remove();const d=a[0];return[{top:d.top,right:d.right-c,bottom:d.bottom,left:d.left+u,width:d.width-u-c,height:d.height}]}(e,t,o):o.getTextBoundingBoxes(e,t,!1)}this._domMeasurement.clearCache();let o=null,s=null,i=0;do{const r=n(e[i],t,this._domMeasurement);0!==r.length&&(o=r[0])}while(!o&&++i<e.length);if(!o)return[null,null];i=e.length-1;do{const r=n(e[i],t,this._domMeasurement);0!==r.length&&(s=r[r.length-1])}while(!s&&--i>=0);return[o,s]}static init(){this._storageController=d.w.create(),this._domMeasurement=new p.o(document),this._interval=self.setInterval((()=>{this._checkMode(),this._checkForNewSlides(),this._checkOutOfViewSlides()}),750),this._storageController.addEventListener(d.u.eventNames.settingsChanged,(e=>{(e.disabledEditorGroups||e.disabledDomains)&&this._toggleMenuBarButton(!!e.disabledEditorGroups)})),this._storageController.onReady((()=>{this._addMenuBarButton()}))}static destroy(){null!==this._interval&&(clearInterval(this._interval),this._interval=null),this._removeMenuBarButton(),this._removeMenuBarHint(),this._onModeChangedCallbacks.clear(),this._onNewSlideCallbacks=[],this._onSlideOutOfViewCallbacks.clear()}static onNewSlide(e){this._onNewSlideCallbacks.push((t=>e(t,!1)))}static isElementCompatible(e){return e.matches(this.SLIDE_SELECTOR)}static getSlideId(e){const t=e.match(this.SLIDE_ID_REGEXP);return t?this.getPresentationId(e)+":"+t[1]:null}static getPresentationId(e){const t=e.match(this.PRESENTATION_ID_REGEXP);return t?t[1]:null}static getSelection(){const e=Array.from(document.body.querySelectorAll(this.SELECTION_ELEMENTS_SELECTOR));if(e.length){const t=e[0].getBoundingClientRect(),n=1===e.length?t:e[e.length-1].getBoundingClientRect(),r=Array.from(document.querySelectorAll(this.TEXT_ELEMENTS_SELECTOR));this._domMeasurement.setStyles(r,{"pointer-events":"all"},!0);const o=Array.from(document.querySelectorAll(this.IGNORED_ELEMENTS_SELECTOR));this._domMeasurement.setStyles(o,{"pointer-events":"none"},!0);const s=this._getRangeByRect(t),i=this._getRangeByRect(n,!0);return this._domMeasurement.removeStyle(r,"pointer-events"),this._domMeasurement.removeStyle(o,"pointer-events"),s&&i?{startNode:s.startContainer,startOffset:s.startOffset,endNode:i.endContainer,endOffset:i.endOffset,isCollapsed:!1}:null}const t=document.body.querySelector(this.CURSOR_ELEMENT_SELECTOR);if(t){const e=t.getBoundingClientRect(),n=Array.from(document.querySelectorAll(this.TEXT_ELEMENTS_SELECTOR));this._domMeasurement.setStyles(n,{"pointer-events":"all"},!0);const r=Array.from(document.querySelectorAll(this.IGNORED_ELEMENTS_SELECTOR));this._domMeasurement.setStyles(r,{"pointer-events":"none"},!0);const o=this._getRangeByRect(e,!1,1);if(this._domMeasurement.removeStyle(n,"pointer-events"),this._domMeasurement.removeStyle(r,"pointer-events"),o)return{startNode:o.startContainer,startOffset:o.startOffset,endNode:o.endContainer,endOffset:o.endOffset,isCollapsed:!1}}return null}static getSelectedText(){const e=this.getSelection();if(!e)return"";const n=(0,t.kN)(e.startNode,e.endNode);if(!n)return"";const r=[],o=st.create(n,e.startNode);do{if((0,t.sd)(o.currentNode)){let t=o.currentNode.nodeValue||"";if(o.currentNode===e.endNode&&(t=t.substring(0,e.endOffset)),o.currentNode===e.startNode&&(t=t.substring(e.startOffset)),t){const e=this.replaceText(t,o.currentNode);r.push(e)}}}while(o.currentNode!==e.endNode&&o.next());return r.join("")}static isSlide(e){return e.matches(this.SLIDE_SELECTOR)}static initSlide(e){e.setAttribute("data-lt-tweaks","slides");let t=null;t=self.setTimeout((()=>{if(!this._storageController||!this._storageController.isReady())return;const{hasSeenNewGoogleSlidesTeaser:e}=this._storageController.getUIState();e||this._showTeaser()}),800)}static destroySlide(e){e.removeAttribute("data-lt-tweaks"),this._onModeChangedCallbacks.delete(e),this._onSlideOutOfViewCallbacks.delete(e)}static onSlideDestroy(e,n){this._onModeChangedCallbacks.set(e,(t=>{"view"===t&&n(e)})),this._onSlideOutOfViewCallbacks.set(e,n),(0,t.W6)(e,n)}static createMutationObserver(e){return new kt(e,(e=>"attributes"===e.type&&"class"===e.attributeName&&wt._isCursor(e.target)))}static isIgnored(e){return!e.parentElement||"TEXT"===e.tagName.toUpperCase()&&!e.parentElement.matches("g.sketchy-text-content-text")}static isBlock(e,t){return"TEXT"!==e.tagName.toUpperCase()&&(!!e.matches(this.BLOCK_SELECTOR)||it.DISPLAY_BLOCK_VALUES.includes(t.display||""))}static getReplacementText(){return""}static replaceText(e,n){const r=n.parentElement;if(!r||"TEXT"!==r.tagName.toUpperCase())return e;const o=(0,t.Aj)(r,this.BLOCK_SELECTOR);if(!o)return e;if(!wt.WHITESPACE_REGEXP.test(e)&&wt.URL_FRAGMENT_REGEXP.test(e))return"\ufeff".repeat(e.length);const s=Array.from(o.querySelectorAll(this.BLOCK_TEXT_SELECTOR)),i=s.indexOf(r);if(-1===i||i===s.length-1)return e;const a=r.getBoundingClientRect(),l=s[i+1].getBoundingClientRect(),u=a.top+a.height/2;return l.top>=u||l.bottom<=u||Math.abs(l.left-a.right)>.25?e+" ":e}static getCacheInvalidationRules(e){return Object.assign({},e,{isSkippingElement:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:["id","class","style"],characterData:!0,childList:!0},sibling:{attributes:["id"]}},replacementText:{},isBlock:{self:{attributes:["id","class","style","direction"]},ancestor:{attributes:["id","class","style"]}},parsingOptions:{},parsedText:{self:{characterData:!0},ancestor:{attributes:["id","class","style"],childList:!0}},blockParent:{self:{attributes:["id","class","style"]},ancestor:{attributes:["id","class","style"]}},paragraphLastValuableNode:{self:{attributes:[],characterData:!0,childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},sibling:{attributes:["id"]},blockSibling:{attributes:[],characterData:!0,childList:!0}},isBRElementRelevant:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style","direction"]},blockDescendant:{attributes:[],characterData:!0,childList:!0},sibling:{attributes:["id"]}},isParagraphNonEmpty:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style","direction"]},descendant:{attributes:[],characterData:!0,childList:!0},sibling:{attributes:["id"]}}})}static getKeyboardEventTarget(){const e=document.querySelector(".docs-texteventtarget-iframe");return e?.contentWindow?e.contentWindow?.document.querySelector("[contenteditable=true]"):null}static getTargetElement(e){return e.closest("svg")||e}static getVisibleBox(e,t){const n=t.getScaleFactor(e);let{top:r,left:o,width:s,height:i}=e.getBoundingClientRect();return s/=n.x,i/=n.y,{top:r,right:o+s,bottom:r+i,left:o,width:s,height:i}}static getScrollableElementSize(e,t){const n=t.getScaleFactor(e);let{width:r,height:o}=e.getBoundingClientRect();return r/=n.x,o/=n.y,{width:r,height:o}}static getTextBoxes(e,t,n,r){const o=this._getRelativeTextBoundingBoxes(e,t,n),s=[];let i=null;for(const e of o){null!==i&&i.bottom===e.bottom&&i.top===e.top?i.right=e.right:(i=e,s.push(i))}return s}static getToolbarPosition(e,t){const n=t.getBorderBox(e);if(this._workspaceContainer=this._workspaceContainer||document.getElementById("workspace-container"),!this._workspaceContainer)return null;const r=t.getBorderBox(this._workspaceContainer),o=r.top+10,s=Math.round(Math.max(n.top+30,o));if(s+50>n.bottom)return null;const i=r.left+32,a=Math.round(Math.max(n.left,i));return a+32>n.right?null:{top:s+"px",left:a+"px",fixed:!0}}static getReplacedParts(e){const t=[];for(const n of this.DEFAULT_TEXTS){const r=new RegExp(`^${n}(\n\n|$)`,"gm"),o=(0,u.us)(e,r);for(const e of o)t.push({offset:e.index,length:e[0].length})}return t}static filterErrors(e,t){return t.filter((e=>"FALSCHES_ANFUEHRUNGSZEICHEN"!==e.rule.id&&!e.rule.id.endsWith("UNPAIRED_BRACKETS")&&(!("DASH_RULE"===e.rule.id&&(e.rule.subId||0)<3)&&(e.fixes[0]&&e.fixes[0].value.replace(this.NON_STANDART_WHITESPACE_REGEXP," ")!==e.originalPhrase))))}static async applyFix(e){const{offset:t,length:n,replacementText:r,editor:o}=e,s=o.inputAreaWrapper.getText().substr(t,n),i=s.startsWith(" "),a=s.endsWith(" ");let l=o.inputAreaWrapper.getTextRanges(t,n,i,a);if(0===l.length||!l[0].node.parentElement)return;const u=l[0].node.parentElement.closest(this.EDITOR_SELECTOR);if(!u)return;let c=u.querySelector("g > path[pointer-events='visiblePainted']:last-child");if(!c)return;const d=document.querySelector(this.PASTE_IFRAME_SELECTOR);if(!d)return;const g=d.contentWindow;if(!g)return;const m=g.document.querySelector("[contenteditable=true]");if(!m)return;this._domMeasurement.clearCache();const[h,p]=this._getTrailingBoxes(l,o.inputArea);if(!h||!p)return;const _={bubbles:!0,clientX:Math.floor(h.left),clientY:Math.round(h.top+h.height/2)},E={bubbles:!0,clientX:Math.floor(p.right),clientY:Math.round(p.top+p.height/2)};c.dispatchEvent(new MouseEvent("mousedown",_)),c=document.querySelector("g > path[pointer-events='visiblePainted']:last-child")||u,c.dispatchEvent(new MouseEvent("mousemove",E)),c.dispatchEvent(new MouseEvent("mouseup",E));const f=g,C=r.replace(/^\s/," ").replace(/\s$/," ");let A;try{A=new f.ClipboardEvent("paste",{clipboardData:new f.DataTransfer,bubbles:!0}),A.clipboardData.setData("text/plain",C)}catch(e){A=new f.ClipboardEvent("paste",{bubbles:!0})}m.dispatchEvent(A),m.textContent=C}}

108

/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */

109

var Pt;wt.SLIDES_URL_REGEXP=/docs\.google\.com\/presentation/,wt.SLIDE_SELECTOR="div#pages > svg > g",wt.UNHANDLED_SLIDE_SELECTOR="div#pages > svg > g:not([data-lt-tweaks])",wt.BLOCK_SELECTOR="g[id^='editor']:not([id*='paragraph']) g[id*='paragraph']",wt.BLOCK_TEXT_SELECTOR="text",wt.TEXT_ELEMENTS_SELECTOR="div#pages svg text",wt.SELECTION_ELEMENTS_SELECTOR="g.sketchy-text-background + g > g > rect",wt.IGNORED_ELEMENTS_SELECTOR=["div#pages > svg path[pointer-events=visiblePainted]","div#pages > svg g[pointer-events=none] + rect[shape-rendering=crispEdges]","div#pages > svg g[pointer-events=none] + rect[shape-rendering=crispEdges] + rect"].join(", "),wt.CURSOR_ELEMENT_SELECTOR="g[id^='editor'] rect[x][y][width][height][style*='opacity: 1']",wt.EDITOR_SELECTOR="g[id^='editor']:not([id*='paragraph']) g[direction]",wt.PASTE_IFRAME_SELECTOR="iframe.docs-texteventtarget-iframe",wt.TOOLBAR_CLASS_NAME="lt-slides-toolbar",wt.PRESENTATION_ID_REGEXP=/presentation\/d\/([^\/]+)/i,wt.SLIDE_ID_REGEXP=/presentation\/d\/.+slide=([\.a-z0-9\_]+)/i,wt.WHITESPACE_REGEXP=/\s/,wt.URL_FRAGMENT_REGEXP=/[a-z0-9]=\!?[a-z0-9]|[a-z0-9\.]{2,}\![a-z0-9\.]{2,}|[\-_][a-z0-9]{5,}[\-_][a-z0-9]{5,}[\-_][a-z0-9]{5,}|^\/.+?\/[^\s]+|^\-[a-z\-\/]+\/$|^[a-z0-9]+_[a-z0-9]+\/[a-z0-9_]+$/i,wt.NON_STANDART_WHITESPACE_REGEXP=/[\u00A0\u2009\u202F]/g,wt.DEFAULT_TEXTS=["Click to add title","Click to add text","Click to add subtitle","Klicken und Titel hinzufügen","Klicken und Text hinzufügen","Klicken und Untertitel hinzufügen","Haz clic para añadir un título","Haz clic para añadir un texto","Haz clic para añadir un subtítulo","Clique para adicionar um título","Clique para adicionar texto","Clique para adicionar um subtítulo","Clique para adicionar um título","Clique para adicionar texto","Clique para adicionar uma legenda","Fai clic per aggiungere un titolo","Fai clic per aggiungere testo","Fai clic per aggiungere un sottotitolo","Klik om een titel toe te voegen","Klik om tekst toe te voegen","Klik om een ondertitel toe te voegen","Cliquez ici pour ajouter un titre","Cliquez ici pour ajouter du texte","Cliquez ici pour ajouter un sous-titre","Введите заголовок","Введите текст","Введите подзаголовок","Kliknij, aby dodać tytuł","Kliknij, aby dodać tekst","Kliknij, aby dodać podtytuł","Натисніть, щоб додати заголовок","Натисніть, щоб додати текст","Натисніть, щоб додати підзаголовок"],wt._storageController=null,wt._interval=null,wt._currentMode=null,wt._onModeChangedCallbacks=new Map,wt._onNewSlideCallbacks=[],wt._onSlideOutOfViewCallbacks=new Map,wt._menuBarButton=null,wt._menuBarSeparator=null,wt._menuBarHint=null,function(e){e.Supported="supported",e.NotSupported="not supported",e.NotDetected="not detected"}(Pt||(Pt={}));class Ot{static _cacheMessages(){Ot.MESSAGES={STATUS_ICON_RELOAD_MESSAGE:i.e.getMessage("statusIconReload"),STATUS_ICON_PERMISSION_REQUIRED:i.e.getMessage("statusIconPermissionRequired"),STATUS_ICON_TEXT_TOO_LONG:i.e.getMessage("textTooLong"),STATUS_ICON_DISABLED:i.e.getMessage("statusIconEnableLT"),STATUS_ICON_FAIL:i.e.getMessage("statusIconError"),STATUS_ICON_MORE_ERRORS:i.e.getMessage("statusIconMoreErrors"),STATUS_ICON_LANGUAGE_UNSUPPORTED:i.e.getMessage("dialogUnsupportedLanguageHeadline"),PREMIUM_ICON_TOOLTIP:i.e.getMessage("dialogMainMenuPremiumMistake"),REPHRASING_TOOLTIP:i.e.getMessage("toolbarTooltipRephrasing"),REPHRASING_LANGUAGE_UNSUPPORTED_TOOLTIP:i.e.getMessage("toolbarTooltipRephrasingUnsupportedLanguage"),DISABLE_CHECKING_TOOLTIP:i.e.getMessage("toolbarTooltipDisableChecking"),DISABLE_CHECKING_MENU_ITEM:i.e.getMessage("toolbarDisableMenuDisableChecking"),PAUSE_CHECKING_MENU_ITEM:i.e.getMessage("toolbarDisableMenuPauseChecking")}}static init(){Ot._isInitialized||(Ot._cacheMessages(),i.e.addEventListener(i.m.eventNames.localeChanged,Ot._cacheMessages.bind(Ot)),Ot._isInitialized=!0)}constructor(e,n,r=null,o=!0,s={checkStatus:ct.IN_PROGRESS,errorsCount:0,premiumErrorsCount:0,isIncompleteResult:!1,checkErrorMessage:"",showNotification:!1,text:"",sentenceRanges:void 0}){this._wasToolbarSmall=!1,this._currentStyles=null,this._renderOutsideIframe=!1,this._onUnload=()=>{this.destroy()},this._inputArea=e,this._targetElement=e,this._document=e.ownerDocument,this._appearance=n,this._mirror=r,this._enableRephrasing=o;const i=(0,t.A1)(self);i&&this._inputArea===this._inputArea.ownerDocument.body&&(0,t.n$)(self.parent)&&(this._targetElement=i,this._document=this._targetElement.ownerDocument,this._renderOutsideIframe=!0,self.addEventListener("pagehide",this._onUnload,!0)),this._domMeasurement=new p.o(this._document),this._root=this._appearance.getRoot(this._document),this._rootElement=this._root instanceof ShadowRoot?this._root.host:this._root,this._hasBoundingContainer=this._appearance.hasBoundingContainer(this._rootElement,this._domMeasurement),this._controls={container:null,wrapper:null,extras:null,disableIcon:void 0,rephrasingIcon:void 0,rephrasingIconUnsupportedLanguage:void 0,statusIcon:null,premiumIcon:null,premiumIconDot:null,divider:null,disableMenu:void 0,premiumIconTooltip:null},this._visible=!1,this._isDisableMenuOpen=!1,this._sizeDecreased=!1,this._hasNotifiedAboutPremiumIcon=!1,this._isRTL=this._domMeasurement.isRTL(this._targetElement),this._eventListeners=[],this.updateState(s,!0);const a=this._appearance.isPerformanceCritical();this._renderInterval=(0,t.Gc)((()=>this._updateDisplaying(!0)),a?2*l.RENDER_INTERVAL:l.RENDER_INTERVAL),a||(this._decreaseSizeInterval=(0,t.Gc)((()=>this._decreaseSizeIfNeeded()),l.TOOLBAR_DECREASE_SIZE_INTERVAL)),this._scrollObserver=(0,t.Qn)(this._targetElement,(()=>this._updateDisplaying(!1)))}_render(){if(this._destroyed)return;const e=["lt-toolbar__disable-icon"],n=["lt-toolbar__rephrasing-icon"],o=["lt-toolbar__rephrasing-icon","lt-toolbar__rephrasing-icon--disabled"],s=["lt-toolbar__status-icon"],i=["lt-toolbar__premium-icon"],a=["lt-toolbar__premium-icon-dot"];let l="";if(!this._controls.container){this._controls.container=(0,t.KY)(this._document,Ot.CONTAINER_ELEMENT_NAME),this._controls.container.style.display="none",this._controls.container.classList.toggle("lt-toolbar--fixed",this._hasBoundingContainer),this._controls.container.setAttribute("data-lt-adjust-appearance","true"),this._appearance.initContainer(this._controls.container),this._controls.wrapper=this._document.createElement("lt-div"),this._controls.wrapper.classList.add("lt-toolbar__wrapper"),this._controls.extras=this._document.createElement("lt-div"),this._controls.extras.classList.add("lt-toolbar__extras"),(0,t.gJ)(this._inputArea)?this._controls.container.setAttribute("data-lt-force-appearance","dark"):this._controls.container.setAttribute("data-lt-force-appearance","light");const s=this._appearance.getClassName();s&&this._controls.wrapper.classList.add(s);const i={label:Ot.MESSAGES.DISABLE_CHECKING_TOOLTIP,position:this._isVertical()?"right-center":"top-right"},a={label:Ot.MESSAGES.REPHRASING_TOOLTIP,position:this._isVertical()?"right-center":"top-right"},l={label:Ot.MESSAGES.REPHRASING_LANGUAGE_UNSUPPORTED_TOOLTIP,position:this._isVertical()?"right-center":"top-right"},u=this._document.createElement("lt-div");u.classList.add("lt-icon__tooltip",this._isVertical()?"lt-icon__tooltip--right-center":this._isRTL?"lt-icon__tooltip--top-left":"lt-icon__tooltip--top-right"),u.textContent=Ot.MESSAGES.PREMIUM_ICON_TOOLTIP,this._controls.premiumIconTooltip=u,xt(this._document.createElement("lt-span"),{name:"disable",preventFocus:!0,tooltip:i,onClick:()=>r.A.isThunderbird()?this._onPauseCheckingClick():this.toggleDisableMenu(),onMouseOut:()=>this._updateExtrasClassnameOnMouseOut(),onMouseOver:()=>this._updateExtrasClassnameOnMouseOver()}).then((t=>{t.element.className=e.join(" "),this._controls.disableIcon=t,t.prependTo(this._controls.extras),this._preventFocusStealing(t.element)})),this._enableRephrasing&&(xt(this._document.createElement("lt-span"),{name:"rephrasing",preventFocus:!0,tooltip:a,onClick:()=>this._showRephrasingCard(),onMouseOut:()=>this._updateExtrasClassnameOnMouseOut(),onMouseOver:()=>this._updateExtrasClassnameOnMouseOver()}).then((e=>{e.element.className=n.join(" "),this._controls.rephrasingIcon=e,e.appendTo(this._controls.extras),this._preventFocusStealing(e.element)})),xt(this._document.createElement("lt-span"),{name:"rephrasing",preventFocus:!0,tooltip:l,onClick:()=>this._showRephrasingCard(),onMouseOut:()=>this._updateExtrasClassnameOnMouseOut(),onMouseOver:()=>this._updateExtrasClassnameOnMouseOver()}).then((e=>{e.element.className=o.join(" "),this._controls.rephrasingIconUnsupportedLanguage=e,e.appendTo(this._controls.extras),this._preventFocusStealing(e.element)}))),this._controls.premiumIcon=this._document.createElement("lt-div"),this._controls.premiumIcon.addEventListener("mouseenter",(()=>this._updateExtrasClassnameOnMouseOver())),this._controls.premiumIcon.addEventListener("mouseleave",(()=>this._updateExtrasClassnameOnMouseOut())),this._controls.statusIcon=this._document.createElement("lt-div"),this._controls.premiumIconDot=this._document.createElement("lt-div"),this._controls.divider=this._document.createElement("lt-div"),this._preventFocusStealing(this._controls.statusIcon),this._preventFocusStealing(this._controls.premiumIcon),this._preventFocusStealing(this._controls.premiumIconDot),this._eventListeners.push((0,t.YZ)(this._controls.wrapper,"click",this._onClick.bind(this))),this._controls.extras.appendChild(this._controls.divider),this._controls.extras.appendChild(this._controls.premiumIcon),this._controls.wrapper.appendChild(this._controls.extras),this._controls.wrapper.appendChild(this._controls.statusIcon),this._controls.wrapper.appendChild(this._controls.premiumIconDot),this._controls.container.appendChild(this._controls.wrapper),this._visible=!0}switch(this._controls.wrapper?.classList.toggle("lt-toolbar--small",this._wasToolbarSmall),this._controls.wrapper?.classList.toggle("lt-toolbar__wrapper--rtl",this._isRTL),((0,u.Y9)(this._state.selection)&&!(0,t.En)(this._state.text,this._state.sentenceRanges,this._state.selection)||this._getLanguageSupport()===Pt.NotDetected)&&n.push("lt-toolbar__rephrasing-icon--disabled"),this._getLanguageSupport()===Pt.NotSupported?n.push("lt-toolbar__rephrasing-icon--hidden"):o.push("lt-toolbar__rephrasing-icon--hidden"),this._controls.extras?.classList.toggle("lt-toolbar__extras--hide",[ct.DISABLED,ct.DISCONNECTED,ct.PERMISSION_REQUIRED].includes(this._state.checkStatus)),clearTimeout(this._premiumIconTimeout),this._state.checkStatus){case ct.IN_PROGRESS:s.push("lt-toolbar__status-icon--loading");case ct.COMPLETED:case ct.TEXT_TOO_SHORT:0===this._state.errorsCount?s.push("lt-toolbar__status-icon--has-no-errors"):(s.push("lt-toolbar__status-icon--has-errors"),this._state.isIncompleteResult?(s.push("lt-toolbar__status-icon--has-more-errors"),l=Ot.MESSAGES.STATUS_ICON_MORE_ERRORS):this._state.errorsCount>99?s.push("lt-toolbar__status-icon--has-99plus-errors"):s.push(`lt-toolbar__status-icon--has-${this._state.errorsCount}-errors`)),this._state.premiumErrorsCount>0&&(s.includes("lt-toolbar__status-icon--has-errors")&&(i.push("lt-toolbar__premium-icon--visible"),this._wasToolbarSmall||a.push("lt-toolbar__premium-icon-dot--visible")),s.push("lt-toolbar__status-icon--has-premium-errors"),this._premiumIconTimeout=self.setTimeout((()=>this._notifyAboutPremiumIcon()),3e3),this._state.premiumErrorsCount<99?(s.push(`lt-toolbar__status-icon--has-${this._state.premiumErrorsCount}-premium-errors`),i.push(`lt-toolbar__premium-icon--has-${this._state.premiumErrorsCount}-errors`)):(s.push("lt-toolbar__status-icon--has-99plus-premium-errors"),i.push("lt-toolbar__premium-icon--has-99plus-errors"))),this._state.showNotification&&0===this._state.premiumErrorsCount&&a.push("lt-toolbar__premium-icon-dot--has-notification"),this._state.checkStatus===ct.TEXT_TOO_SHORT&&n.push("lt-toolbar__rephrasing-icon--disabled");break;case ct.PERMISSION_REQUIRED:s.push("lt-toolbar__status-icon--permission-required"),l=Ot.MESSAGES.STATUS_ICON_PERMISSION_REQUIRED;break;case ct.DISABLED:s.push("lt-toolbar__status-icon--disabled","lt-icon__disable"),l=Ot.MESSAGES.STATUS_ICON_DISABLED;break;case ct.TEXT_TOO_LONG:s.push("lt-toolbar__status-icon--text-too-long"),l=Ot.MESSAGES.STATUS_ICON_TEXT_TOO_LONG;break;case ct.UNSUPPORTED_LANGUAGE:s.push("lt-toolbar__status-icon--language-unsupported"),l=Ot.MESSAGES.STATUS_ICON_LANGUAGE_UNSUPPORTED;break;case ct.FAILED:s.push("lt-toolbar__status-icon--failed"),l=this._state.checkErrorMessage||Ot.MESSAGES.STATUS_ICON_FAIL;break;case ct.DISCONNECTED:s.push("lt-toolbar__status-icon--disconnected"),l=Ot.MESSAGES.STATUS_ICON_RELOAD_MESSAGE;break;case ct.NEEDS_LANGUAGE_HINT:s.push("lt-toolbar__status-icon--needs-language-hint")}this._controls.statusIcon.className=s.join(" "),this._controls.statusIcon.title=l,this._controls.premiumIcon.className=i.join(" "),this._controls.premiumIconDot.className=a.join(" "),this._controls.divider.className=["lt-toolbar__divider"].join(" "),this._controls.disableIcon&&(this._controls.disableIcon.element.className=e.join(" ")),this._controls.rephrasingIcon&&(this._controls.rephrasingIcon.element.className=n.join(" ")),this._controls.rephrasingIconUnsupportedLanguage&&(this._controls.rephrasingIconUnsupportedLanguage.element.className=o.join(" ")),!this._root||this._root.contains(this._controls.container)&&"before"!==(0,t.Gq)(this._controls.container,this._inputArea)||this._root.children[this._root.children.length-1]===this._controls.container||this._root.appendChild(this._controls.container)}_preventFocusStealing(e){this._eventListeners.push((0,t.YZ)(e,"mousedown",(e=>{e.stopImmediatePropagation(),e.preventDefault()})),(0,t.YZ)(e,"mouseup",(e=>{e.stopImmediatePropagation()})),(0,t.YZ)(e,"pointerdown",(e=>{e.stopImmediatePropagation()})),(0,t.YZ)(e,"pointerup",(e=>{e.stopImmediatePropagation()})))}_updateDisplaying(e=!1){if(this._destroyed)return;if(!this._controls.wrapper)return;if(this._renderOutsideIframe&&!(0,t.OE)(this._targetElement))return void this._hide();this._domMeasurement.clearCache();if(!this._appearance.isVisible(this._targetElement,this._domMeasurement))return void this._hide();this._isRTL=this._domMeasurement.isRTL(this._targetElement);const n=this._appearance.getPosition(this._targetElement,this._controls.container,this._rootElement,this._domMeasurement,this._isRTL,Ot.TOOLBAR_SIZE),r={isRTL:this._isRTL};if([this._controls.disableIcon,this._controls.rephrasingIcon,this._controls.rephrasingIconUnsupportedLanguage].map((e=>e?.element.dispatchEvent(new CustomEvent(bt,{detail:r})))),!n)return void this._hide();const o={left:n.left||""};n.fixed?(o.position="fixed !important",n.top?(o.top=`${n.top} !important`,o.bottom="auto !important"):(o.top="auto !important",o.bottom="12px !important")):(o.position="absolute !important",o.top=`${n.top} !important`,o.bottom="auto !important"),e&&(o["z-index"]=(this._appearance.getZIndex(this._targetElement,this._rootElement,this._domMeasurement)||"auto").toString()),(0,u.m)(this._currentStyles,o)?this._show():(this._currentStyles=o,this._domMeasurement.setStyles(this._controls.wrapper,o),this._render())}_hide(){this._controls.wrapper&&this._visible&&(this._visible=!1,this._controls.wrapper.classList.add("lt-toolbar__wrapper--hide"))}_show(){this._controls.wrapper&&(this._visible||(this._visible=!0,this._controls.wrapper.classList.remove("lt-toolbar__wrapper--hide")))}async toggleDisableMenu(e){if(this._isDisableMenuOpen=void 0===e?!this._isDisableMenuOpen:e,this._controls.wrapper?.classList.toggle("lt-toolbar__wrapper--expanded",this._isDisableMenuOpen),this._isDisableMenuOpen){const e=await async function(e,t){return await I.createView(e,Lt,t)}(this._document,{isActive:this._isDisableMenuOpen,position:"top",menuItems:[{label:Ot.MESSAGES.PAUSE_CHECKING_MENU_ITEM,name:"pause",isClickable:!0,onClick:this._onPauseCheckingClick.bind(this)},{label:Ot.MESSAGES.DISABLE_CHECKING_MENU_ITEM,name:"disable_circle",isClickable:!0,onClick:this._onTurnOffClick.bind(this)}]});this._unmountDisableMenu(),e.appendTo(this._controls.wrapper),this._controls.disableMenu=e}else this._unmountDisableMenu()}_unmountDisableMenu(){this._controls.disableMenu&&(this._controls.disableMenu.unmount(),this._controls.disableMenu.element.remove())}_updateExtrasClassnameOnMouseOut(){clearTimeout(this._extrasMouseoverTimeout),this._controls.extras?.classList.remove("lt-toolbar__extras--mouseover"),this._controls.premiumIcon?.removeChild(this._controls.premiumIconTooltip)}_updateExtrasClassnameOnMouseOver(){this._extrasMouseoverTimeout=self.setTimeout((()=>this._controls.extras?.classList.toggle("lt-toolbar__extras--mouseover",!this._isDisableMenuOpen)),250),this._controls.premiumIcon?.appendChild(this._controls.premiumIconTooltip)}_showRephrasingCard(){if((!(0,u.Y9)(this._state.selection)||(0,t.En)(this._state.text,this._state.sentenceRanges,this._state.selection))&&this._getLanguageSupport()===Pt.Supported){const e={toolbar:this};(0,t.Q9)(document,Ot.eventNames.showRephrasingCard,e)}}_decreaseSizeIfNeeded(){if(!this._controls.wrapper)return;if(!this._visible)return;if(this._destroyed)return;let e=this._domMeasurement.getBorderBox(this._controls.wrapper,!1);if(this._renderOutsideIframe){const n=this._domMeasurement.getContentBox(this._targetElement,!1);e=(0,t.C4)(e,-n.left,-n.top)}if(e.top<0||e.bottom>self.innerHeight)return;const n={left:e.left-6,top:e.top,right:e.right,bottom:e.bottom-2},r={x:Math.round(e.left)-1,y:Math.round(e.top)},o={x:Math.round(e.left)-1,y:Math.round(e.top+e.height/2)},s={x:Math.round(e.left)-1,y:Math.round(e.bottom)};this._mirror&&this._mirror.enableRangeMeasurements();const i=(0,t.E9)(r);let a=(0,t.E9)(o),l=(0,t.E9)(s);this._mirror&&this._mirror.disableRangeMeasurements(),this._wasToolbarSmall=!0;const u=this._mirror?this._mirror.getCloneElement():this._inputArea;if(i&&(0,t.Y7)(u,i.startContainer)&&!this._isInToolbar(i.startContainer)){const e=i.getBoundingClientRect();if(this._isValidRangeRect(e)&&(0,t.Un)(e,n))return void this._decreaseSize()}if((0,t.I1)(a,i)&&(a=null),a&&(0,t.Y7)(u,a.startContainer)&&!this._isInToolbar(a.startContainer)){const e=a.getBoundingClientRect();if(this._isValidRangeRect(e)&&(0,t.Un)(e,n))return void this._decreaseSize()}if(((0,t.I1)(l,i)||(0,t.I1)(l,a))&&(l=null),l&&(0,t.Y7)(u,l.startContainer)&&!this._isInToolbar(l.startContainer)){const e=l.getBoundingClientRect();if(this._isValidRangeRect(e)&&(0,t.Un)(e,n))return void this._decreaseSize()}let c=null;if(a&&a.startOffset>0&&(c=new Range,c.setStart(a.startContainer,a.startOffset-1),c.setEnd(a.startContainer,a.startOffset-1)),((0,t.I1)(c,i)||(0,t.I1)(c,a)||(0,t.I1)(c,l))&&(c=null),c&&(0,t.Y7)(u,c.startContainer)&&!this._isInToolbar(c.startContainer)){const e=c.getBoundingClientRect();if((0,t.Un)(e,n))return void this._decreaseSize()}this._wasToolbarSmall=!1,this._increaseSize()}_isValidRangeRect(e){return e.width<40}_isInToolbar(e){return!!this._controls.container&&this._controls.container.contains(e)}_decreaseSize(){this._controls.wrapper&&(this._sizeDecreased||(this._sizeDecreased=!0,this._controls.wrapper.classList.add("lt-toolbar--small")))}_increaseSize(){this._controls.wrapper&&this._sizeDecreased&&(this._sizeDecreased=!1,this._controls.wrapper.classList.remove("lt-toolbar--small"))}_notifyAboutPremiumIcon(){if(this._hasNotifiedAboutPremiumIcon)return;this._hasNotifiedAboutPremiumIcon=!0;const e={toolbar:this};(0,t.Q9)(document,Ot.eventNames.notifyAboutPremiumIcon,e)}_onClick(e){const n=(0,t.ao)(e);if(![this._controls.wrapper,this._controls.statusIcon,this._controls.premiumIcon,this._controls.premiumIconDot].includes(n))return;e.stopImmediatePropagation();const r={toolbar:this};this._state.checkStatus===ct.PERMISSION_REQUIRED?(0,t.Q9)(document,Ot.eventNames.permissionRequiredIconClicked,r):(this._wasToolbarSmall=this._sizeDecreased,(0,t.Q9)(document,Ot.eventNames.toggleDialog,r))}_onTurnOffClick(e){e.stopImmediatePropagation();const n={toolbar:this};(0,t.Q9)(document,Ot.eventNames.turnOff,n),this.toggleDisableMenu()}_onPauseCheckingClick(e){e?.stopImmediatePropagation();const n={toolbar:this};(0,t.Q9)(document,Ot.eventNames.pauseChecking,n),this.toggleDisableMenu()}_isVertical(){return(0,t.uG)(this._inputArea)||wt.isSlide(this._inputArea)}_getLanguageSupport(){if(this._state.languageCode){return l.SUPPORTED_REPHRASE_LANGUAGES.some((e=>_.E.getPrimaryLanguageCode(e)===_.E.getPrimaryLanguageCode(this._state.languageCode)))?Pt.Supported:Pt.NotSupported}return Pt.NotDetected}updateState(e,t=!1){if((0,u.m)(this._stateForComparison,e))return;this._stateForComparison=e;const n=void 0===e.checkStatus?this._state.checkStatus:e.checkStatus;let r=0,o=0;n===ct.COMPLETED&&(r=void 0===e.errorsCount?this._state.errorsCount:e.errorsCount,o=void 0===e.errorsCount?this._state.premiumErrorsCount:e.premiumErrorsCount);let s=void 0===e.isIncompleteResult?this._state.isIncompleteResult:e.isIncompleteResult,i="";n===ct.FAILED&&(i=void 0===e.checkErrorMessage?this._state.checkErrorMessage:e.checkErrorMessage),n===ct.IN_PROGRESS&&this._state&&(r=this._state.errorsCount,o=this._state.premiumErrorsCount),this._state={checkStatus:n,errorsCount:r,premiumErrorsCount:o,isIncompleteResult:s,checkErrorMessage:i,showNotification:e.showNotification,text:e.text,sentenceRanges:e.sentenceRanges,selection:e.selection,languageCode:e.languageCode},this._animationFrame=requestAnimationFrame((()=>{this._render(),this._updateDisplaying(t)}))}getContainer(){return this._controls.wrapper}destroy(){this._destroyed=!0,this._eventListeners.forEach((e=>{e.destroy()})),this._eventListeners=[];for(const e in this._controls)this._controls[e]&&(this._controls[e].element?(this._controls[e].unmount?.(),this._controls[e].element.remove()):this._controls[e].remove(),this._controls[e]=null);this._domMeasurement.clearCache(),this._renderInterval&&this._renderInterval.destroy(),this._decreaseSizeInterval&&this._decreaseSizeInterval.destroy(),self.removeEventListener("pagehide",this._onUnload,!0),cancelAnimationFrame(this._animationFrame),clearTimeout(this._premiumIconTimeout),this._scrollObserver&&this._scrollObserver.destroy()}}Ot.CONTAINER_ELEMENT_NAME="lt-toolbar",Ot.MENU_ELEMENT_NAME="lt-comp-menu",Ot.TOOLBAR_SIZE={width:20,height:20},Ot.eventNames={permissionRequiredIconClicked:"lt-toolbar.permissionRequiredIconClicked",toggleDialog:"lt-toolbar.toggleDialog",showRephrasingCard:"lt-toolbar.showRephrasingCard",notifyAboutPremiumIcon:"lt-toolbar.notifyAboutPremiumIcon",turnOff:"lt-toolbar.turnOff",pauseChecking:"lt-toolbar.pauseChecking"},Ot._isInitialized=!1;const Mt=[{pattern:/^[ \t]*>.*$/gm,preserveNewlineChars:!1},{pattern:/\s?<code\b[^>]*>[^]*?<\/code>/gi,preserveNewlineChars:!0},{pattern:/(^|\s|\s\()(_|~~)?(\*\*)([^\s\*](?:.*?\S)?)(\*\*)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]},{pattern:/(^|\s|\s\()(\*|~~)?(__)([^\s_](?:.*?\S)?)(__)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]},{pattern:/(^|\s|\s\()(__|~~)?(\*)([^\s\*](?:.*?\S)?)(\*)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]},{pattern:/(^|\s|\s\()(\*\*|~~)?(_)([^\s_](?:.*?\S)?)(_)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]},{pattern:/(^|\s|\s\()(\*\*\*)([^\s\*](?:.*?\S)?)(\*\*\*)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]},{pattern:/(^|\s|\s\()(___)([^\s_](?:.*?\S)?)(___)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]},{pattern:/(^|\s|\s\()(\*|\*\*|_|__)?(~~)([^\s~](?:.*?\S)?)(~~)(\2)([\s.!?,:;\)]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!1,!0,!1,!0,!1,!1]},{pattern:/(^|[^`])(```)(?!`)([^]*?[^`])(```)(?=[^`]|$)/gm,preserveNewlineChars:!0,excludedParts:[/^\s$/,!0,!0,!0]},{pattern:/(!\[(?:(?:Uploading\s)?(?:Screen\sShot\s|Bildschirmfoto\s)?)?)([^\[\]]+)(\]\(\s*[^()"'\s]*\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0]},{pattern:/(!\[)([^\[\]]+)(\]\(\s*[^()"'\s]+)(\s+)(["'])([^]*?)(\5\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0,!1,!0,!1,!0]},{pattern:/(\[)([^\[\]]+)(\]\(\s*[^()"'\s]+\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0]},{pattern:/(\[)([^\[\]]+)(\]\(\s*[^()"'\s]+)(\s+)(["'])([^]*?)(\5\s*\))/g,preserveNewlineChars:!0,excludedParts:[!0,!1,!0,!1,!0,!1,!0]},{pattern:/\s?\[code\][^]*?\[\/code\]/gi,preserveNewlineChars:!0},{pattern:/\s?{code(:[a-z0-9#]+)?}[^]*?{code}/gi,preserveNewlineChars:!0},{pattern:/(^|\s)(~)([^\s~](?:.*?\S)?)(~)([\s.!?,:;]|$)/g,preserveNewlineChars:!1,excludedParts:[!1,!0,!1,!0,!1]},{pattern:/(^[-*])(\s\[(\s|x)\])(\s)/gim,preserveNewlineChars:!1,excludedParts:[!1,!0,!1]},{pattern:/(^\d+\.)(\s\[(\s|x)\])(\s)/gim,preserveNewlineChars:!1,excludedParts:[!1,!0,!1]},{pattern:/^(h[1-6]|bq|bc|p|pre|###|notextile)\./gim,preserveNewlineChars:!1},{pattern:/(\[\[)([a-z:][^|\]\n]*)(\]\])/gi,preserveNewlineChars:!1,excludedParts:[!0,!1,!0]},{pattern:/(\[\[[a-z:][^|\]\n]*\|)([^\]\n]+)(]])/gi,preserveNewlineChars:!1,excludedParts:[!0,!1,!0]},{pattern:/(^|\s+)([:;|=][-~^]?[()\[\]\\/|@$*#&XxDOoPp])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0},{pattern:/(^|\s+)([8B%][-~^][D()\[\]])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0},{pattern:/(^|\s+)([:;%|=][-~^]?3)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0},{pattern:/(^|\s+)([()[\]\\/|@$*#&XxDOo][-~^]?[:;%|])(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0},{pattern:/(^|\s+)([xX]D)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0},{pattern:/(^|\s+)(<[\\/]?3)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0},{pattern:/(^|\s+)\(([-+!?ynxi]|(\*[rgby]?)|on|off|flag|flagoff)\)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,preserveNewlineChars:!0},{pattern:/<([a-z]+:)?br(\s[^>]*)?\/?>/gi,replacingText:"\n"},{pattern:/&(amp|quot|lt|gt);/gi,replacingText:"⁣"},{pattern:/<!-- .*? -->/gi,replacingText:"⁣"},{pattern:/<([a-z]+:)?(html|xml|base|head|link|meta|style|title|body|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|main|nav|section|blockquote|dd|div|dl|dt|figcaption|figure|hr|li|ol|p|pre|ul|a|abbr|b|bdi|bdo|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|iframe|object|param|picture|portal|source|svg|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|summary|slot|template|acronym|applet|basefont|bgsound|big|blink|center|content|dir|font|frame|frameset|hgroup|image|keygen|marquee|menuitem|nobr|noembed|noframes|plaintext|rb|rtc|shadow|spacer|strike|tt|xmp)(\s[^>]*)?>/gi,replacingText:"⁣"},{pattern:/<\/([a-z]+:)?(html|xml|base|head|link|meta|style|title|body|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|main|nav|section|blockquote|dd|div|dl|dt|figcaption|figure|hr|li|ol|p|pre|ul|a|abbr|b|bdi|bdo|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|iframe|object|param|picture|portal|source|svg|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|summary|slot|template|acronym|applet|basefont|bgsound|big|blink|center|content|dir|font|frame|frameset|hgroup|image|keygen|marquee|menuitem|nobr|noembed|noframes|plaintext|rb|rtc|shadow|spacer|strike|tt|xmp)>/gi,replacingText:"⁣"},{pattern:/<([a-z]+:)?(a|altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|script|set|solidcolor|stop|style|svg|switch|symbol|text|textPath|title|tref|tspan|unknown|use|view|vkern)(\s[^>]*)?>/gi,replacingText:"⁣"},{pattern:/<\/([a-z]+:)?(a|altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|script|set|solidcolor|stop|style|svg|switch|symbol|text|textPath|title|tref|tspan|unknown|use|view|vkern)>/gi,replacingText:"⁣"},{pattern:/<([a-z]+:)?[a-z][^\/]*\/>/gi,replacingText:"⁣"},{pattern:/(<)((?:[a-z]+:)?[a-z][^\s>]*)(\s[^>]*)?(>)(?=([^]*?)(<\/\2>))/gi,getReplacedParts:e=>{if("code"===e[2].toLowerCase())return[];const t=e.index,n=e[1].length+e[2].length+(e[3]?e[3].length:0)+e[4].length,r=t+n+e[5].length;return[{offset:t,length:1,replacingText:"⁣"},{offset:t+1,length:n-1},{offset:r,length:1,replacingText:"⁣"},{offset:r+1,length:e[6].length-1}]}},{pattern:/\[(img|url|email|post|quote|list|youtube|vimeo|googlemaps|googlewidget|code|modalurl|topic|highlight|left|center|right|font|size|color|s|u|i|b|style|table|tr|td)\b[^\]\n]*\]/gi,replacingText:"⁣"},{pattern:/\[\/(img|url|email|post|quote|list|youtube|vimeo|googlemaps|googlewidget|code|modalurl|topic|highlight|left|center|right|font|size|color|s|u|i|b|style|table|tr|td)\]/gi,replacingText:"⁣"},{pattern:/{{[\/\^\!#]?[a-z0-9_\-]+}}/gi,replacingText:"⁣"},{pattern:/{{{[\/\^\!#]?[a-z0-9_\-]+}}}/gi,replacingText:"⁣"},{pattern:/\[[a-z0-9_\-]+\s[a-z0-9_\-]+=.+?\]/gi,replacingText:"⁣"},{pattern:/(^|\s|\s\()`([^`\n]+)`([\s.!?,:;\)]|$)/g,getReplacedParts:e=>{const t=e.index+e[1].length+1;return[{offset:t,length:1,replacingText:"⁣"},{offset:t+1,length:e[2].length-1}]}},{pattern:/{(color|code|noformat|quote)(:[a-z0-9#]+)?}/gi,replacingText:"⁣"},{pattern:/(^|\s+)(\:\w+\:)(\s+(?=[,.!?)]|$)|(?=[\s,.!?)]|$))/gm,replacingText:"⁣"}];

110

/*! (C) Copyright 2022 LanguageTooler GmbH. All rights reserved. */

111

class Dt extends ut{async replaceText(e,n,r){if(e<0)return Promise.resolve();""===r&&(this._hasSpaceBefore(e)||0===e)&&this._hasSpaceAfter(e+n)&&(e=Math.max(e-1,0),n+=1);const o=this._inputArea.ownerDocument.createRange();let s=null,i=null;for(let t=this._getTextChunkIndex(e);t<this._textChunks.length;t++){const{node:r,isTextNode:a,rawText:l,parsedText:u,parsedTextOffset:c}=this._textChunks[t];if(!a)continue;if(e>=c&&e<c+u.length){const t=this._offsetInRawText(l,u,e-c);o.setStart(r,t),s=r}if(e+n>=c&&e+n<=c+u.length){const t=this._offsetInRawText(l,u,e+n-c);o.setEnd(r,t),i=r;break}}if(!s||!i)return Promise.resolve();const a=o.getBoundingClientRect(),l=new at(["mouseout","mouseover","mousemove","mousedown","mouseup","pointerout","pointerover","pointermove","pointerdown","pointerup","click","dblclick"]);try{ut._simulateMouseDown(s.parentElement||this._inputArea,a),l.mute(),await(0,t.Sy)(25),l.unmute(),ut._simulateMouseMove(i.parentElement||this._inputArea,a),ut._simulateMouseUp(i.parentElement||this._inputArea,a);const u=self.getSelection();u.removeAllRanges(),u.addRange(o),l.mute(),await(0,t.Sy)(125),l.unmute(),!r&&n>0?await this.simulateDelete():(0,t.k_)(this._inputArea,r),l.mute(),await(0,t.Sy)(100),l.unmute(),this.setSelection({start:e+r.length})}finally{l.unmute()}}}

112

/*! (C) Copyright 2022 LanguageTooler GmbH. All rights reserved. */

113

class Ut extends ut{_getSelectionElements(){const e=this._inputArea.closest(Ut.EDITOR_CONTAINER_SELECTOR);if(!e)return[];const t=Array.from(e.querySelectorAll(Ut.SELECTION_ELEMENTS_SELECTOR)).map((e=>({element:e,rect:e.getBoundingClientRect()})));return t.sort(((e,t)=>e.rect.top===t.rect.top?e.rect.left-t.rect.left:e.rect.top-t.rect.top)),t.map((e=>e.element))}_getCursorElements(){const e=this._inputArea.closest(Ut.EDITOR_CONTAINER_SELECTOR);return e?Array.from(e.querySelectorAll(Ut.CURSOR_ELEMENTS_SELECTOR)):[]}_getTextNodeAtPoint(e,n,r,o=!1){e+=o?-1:1;let s=null,i=.25;do{if(s=document.elementFromPoint(e,n+r*i),"SPAN"===s?.nodeName){let r=new Range;const o=st.create(s);for(;o.next();){const s=o.currentNode;if((0,t.sd)(s)){r.setStart(s,0),r.setEnd(s,s.textContent?.length||0);const o=r.getBoundingClientRect();if((0,t.nE)(o,e,n))return s}}}i+=.25}while(i<1);return null}_getSelectionOffset(e,t=!1){const n=e.getBoundingClientRect(),r=this._getTextNodeAtPoint(t?n.right:n.left,n.top,n.height,t);if(!r?.textContent)return null;let o=Number.MAX_VALUE,s=0;const i=new Range;t?i.setStart(r,0):i.setEnd(r,r.textContent.length);for(let e=0;e<=r.textContent.length;e++){let a=0;if(t?(i.setEnd(r,e),a=Math.abs(i.getBoundingClientRect().right-n.right)):(i.setStart(r,e),a=Math.abs(i.getBoundingClientRect().left-n.left)),!(a<o))break;o=a,s=e}return{node:r,offset:s}}async replaceText(e,n,r){if(e<0)return Promise.resolve();const o=this._inputArea.closest(Ut.EDITOR_CONTAINER_SELECTOR);if(!o)return Promise.resolve();const s=o.querySelector(Ut.PASTE_TEXTAREA_SELECTOR);if(!s)return Promise.resolve();""===r&&(this._hasSpaceBefore(e)||0===e)&&this._hasSpaceAfter(e+n)&&(e=Math.max(e-1,0),n+=1);const i=this._inputArea.ownerDocument.createRange();let a=null,l=null;for(let t=this._getTextChunkIndex(e);t<this._textChunks.length;t++){const{node:r,isTextNode:o,rawText:s,parsedText:u,parsedTextOffset:c}=this._textChunks[t];if(!o)continue;if(e>=c&&e<c+u.length){const t=this._offsetInRawText(s,u,e-c);i.setStart(r,t),a=r}if(e+n>=c&&e+n<=c+u.length){const t=this._offsetInRawText(s,u,e+n-c);i.setEnd(r,t),l=r;break}}if(!a||!l)return Promise.resolve();let u=i.getBoundingClientRect();ut._simulateMouseDown(a.parentElement||this._inputArea,u),u=i.getBoundingClientRect(),ut._simulateMouseMove(l.parentElement||this._inputArea,u,!0),ut._simulateMouseUp(l.parentElement||this._inputArea,u),!r&&n>0?await this.simulateDelete():((0,t.k_)(s,r),s.value=""),this.setSelection({start:e+r.length})}getSelection(){let e=null,t=null;const n=this._getSelectionElements(),r=this._getCursorElements();if(n.length?(e=this._getSelectionOffset(n[0]),t=this._getSelectionOffset(n[n.length-1],!0)):1===r.length&&(e=this._getSelectionOffset(r[0]),t=e),!e||!t)return null;const o=this._getTextOffset(e.node,e.offset);return{start:o,end:e===t?o:this._getTextOffset(t.node,t.offset)}}}Ut.EDITOR_CONTAINER_SELECTOR="div.CodeMirror",Ut.PASTE_TEXTAREA_SELECTOR="div.CodeMirror textarea",Ut.SELECTION_ELEMENTS_SELECTOR="div.CodeMirror-lines div.CodeMirror-selected",Ut.CURSOR_ELEMENTS_SELECTOR="div.CodeMirror-cursors div.CodeMirror-cursor";

114

/*! (C) Copyright 2022 LanguageTooler GmbH. All rights reserved. */

115

class Bt{static _isTextAreaEditor(e){const n=e.closest(Bt.EDITOR_CONTAINER_SELECTOR);return!!n&&(0,t.Y7)(n,Bt.EDITOR_TEXTAREA_SELECTOR)}static _isCEElementEditor(e){if("true"!==e.getAttribute("contenteditable"))return!1;const n=e.closest(Bt.EDITOR_CONTAINER_SELECTOR);return!!n&&!(0,t.Y7)(n,Bt.EDITOR_TEXTAREA_SELECTOR)}static isEditorPart(e){return e.matches(this.EDITOR_TEXTAREA_SELECTOR)}static getEditor(e){const t=e.closest(this.EDITOR_CONTAINER_SELECTOR);if(!t)return[];const n=t.querySelector(this.EDITOR_SELECTOR);return n?[n]:[]}static isEditor(e){return this._isTextAreaEditor(e)||this._isCEElementEditor(e)}static isTextMode(n){const r="LanguageTool_isTextMode",o=n.ownerDocument;e.e.executeScript(o,`\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst TEXT_MODES = [\n\t\t\t\t\t\t\t"null",\n\t\t\t\t\t\t\t"htmlmixed",\n\t\t\t\t\t\t\t"htmlembedded",\n\t\t\t\t\t\t\t"markdown",\n\t\t\t\t\t\t\t"mbox",\n\t\t\t\t\t\t\t"textile",\n\t\t\t\t\t\t\t"tiddlywiki",\n\t\t\t\t\t\t\t"tiki",\n\t\t\t\t\t\t\t"xml",\n\t\t\t\t\t\t\t"mediawiki",\n\t\t\t\t\t\t\t"mw-tag-nowiki",\n\t\t\t\t\t\t\t"mw-tag-pre",\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tconst modes = Object.keys(CodeMirror.modes);\n\t\t\t\t\t\tconst isTextMode = modes.every(mode => TEXT_MODES.includes(mode));\n\t\t\t\t\t\tdocument.body.dataset.${r} = isTextMode;\n\t\t\t\t\t} catch(e) { }\n\t\t\t\t`);const s=o.body.dataset[r]||"";o.body.dataset[r]="";if(location.hostname.endsWith("epd.de"))return Math.random()<.1&&(e.e.executeScript(o,'\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tdocument.body.dataset.ltCodeMirrorModes = Object.keys(CodeMirror.modes).join(",") + "|" + Object.keys(CodeMirror.modes).length;\n\t\t\t\t\t\t} catch(e) { }\n\t\t\t\t\t'),m.A.trackEvent("Debug","unsupported_code_mirror_modes_epd",s+":"+typeof document.body.dataset.ltCodeMirrorModes+":"+document.body.dataset.ltCodeMirrorModes)),!0;if("true"===s)return!0;if("false"===s)return!1;const i=n.closest(Bt.EDITOR_CONTAINER_SELECTOR);if(!i)return!1;if(Array.from(i.classList).some((e=>e.startsWith("cm-s")&&"cm-s-default"!==e)))return!1;return!(0,t.Y7)(i,this.LINE_NUMBERS_SELECTOR)}static hasFocus(e){return this.isEditor(e)}constructor(e){this._inputArea=e}_getScrollContainer(){return this._inputArea.closest(Bt.EDITOR_SCROLL_CONTAINER_SELECTOR)}_isEditorRTL(){return this._inputArea.matches(Bt.RTL_EDITOR_SELECTOR)}getInputAreaWrapperKeyboardEventTarget(){return Bt._isTextAreaEditor(this._inputArea)?this._inputArea.closest(Bt.EDITOR_CONTAINER_SELECTOR)||this._inputArea:(Bt._isCEElementEditor(this._inputArea),this._inputArea)}addScrollEventListener(e){this._getScrollContainer().addEventListener("scroll",e)}removeScrollEventListener(e){this._getScrollContainer().removeEventListener("scroll",e)}getInputAreaWrapper(e,t){return Bt._isTextAreaEditor(this._inputArea)?new Ut(this._inputArea,e,t):Bt._isCEElementEditor(this._inputArea)?new Dt(this._inputArea,e,t):new ut(this._inputArea,e,t)}getToolbarPosition(e,n,r,o,s){const i=(0,t.Aj)(this._inputArea,Bt.EDITOR_CONTAINER_SELECTOR),a=this._isEditorRTL(),l=e.getPosition(i,n,r,o,a,s);return l?(l.top&&(l.top=function(e,t){const n=parseInt(e);if(isNaN(n))return e;const r=t.querySelector(Bt.HORIZONTAL_SCROLLBAR_SELECTOR);if(!r)return e;const{height:s}=o.getBorderBox(r,!1,!1);return n-s+"px"}(l.top,i)),l.left&&(l.left=function(e,t,n){const r=parseInt(e);if(isNaN(r))return e;if(n){const n=t.querySelector(Bt.SIZER_SELECTOR);if(!n)return e;const s=parseInt(o.getStyle(n,"margin-left"));return isNaN(s),r+s+"px"}{const n=t.querySelector(Bt.VERTICAL_SCROLLBAR_SELECTOR);if(!n)return e;const{width:s}=o.getBorderBox(n,!1,!1);return r-s+"px"}}(l.left,i,a)),l):l}}Bt.EDITOR_CONTAINER_SELECTOR="div.CodeMirror",Bt.EDITOR_SCROLL_CONTAINER_SELECTOR="div.CodeMirror div.CodeMirror-scroll",Bt.EDITOR_TEXTAREA_SELECTOR="div.CodeMirror textarea",Bt.EDITOR_SELECTOR="div.CodeMirror div.CodeMirror-scroll div.CodeMirror-code",Bt.LINE_NUMBERS_SELECTOR="div.CodeMirror-gutter-wrapper",Bt.RTL_EDITOR_SELECTOR=".CodeMirror-rtl",Bt.HORIZONTAL_SCROLLBAR_SELECTOR="div.CodeMirror div.CodeMirror-hscrollbar, div.CodeMirror div.CodeMirror-simplescroll-horizontal, div.CodeMirror div.CodeMirror-overlayscroll-horizontal",Bt.VERTICAL_SCROLLBAR_SELECTOR="div.CodeMirror div.CodeMirror-vscrollbar, div.CodeMirror div.CodeMirror-simplescroll-vertical, div.CodeMirror div.CodeMirror-overlayscroll-vertical",Bt.SIZER_SELECTOR="div.CodeMirror div.CodeMirror-sizer";

116

/*! (C) Copyright 2022 LanguageTooler GmbH. All rights reserved. */

117

class Ft extends ut{_updateText(){const e=[];let n=0,r=null,o=!0,s=!1;const i=st.create(this._inputArea);let a=!1;do{const l=i.currentNode;null===r&&(r=this._ceElementInspector.getParagraphLastValuableNode(l)),a=!1;let c=!1,d="";if((0,t.iS)(l))if(d=this._ceElementInspector.getReplacementText(l),l===r&&(r=null,this._ceElementInspector.isTextEndsWithLineBreak(l)&&(o=!0,s=!1,d+="\n\n")),this._ceElementInspector.isSkippingElement(l)){if(a=!0,r=null,!d)continue}else this._ceElementInspector.isBlock(l)?(r=null,o=!0,s=!1):this._ceElementInspector.isBr(l)&&(r=null,o=!0,s=!1,!d&&this._ceElementInspector.isBRElementRelevant(l)&&(d="\n\n"));else if((0,t.sd)(l)&&(c=!0,d=this._ceElementInspector.getParsedText(l),d)){const e=null===r||r===l;this._ceElementInspector.getParsingOptions(l).preserveWhitespaces||((o||s)&&(d=d.replace(ut.LEADING_WHITESPACES_REGEXP,"")),e&&(d=d.replace(ut.TRAILING_WHITESPACES_REGEXP,""))),o=o&&""===d,s=(0,u.kT)(d),r===l&&(r=null,this._ceElementInspector.isTextEndsWithLineBreak(l)&&(o=!0,s=!1,d+="\n\n"))}if(e.push({node:l,isTextNode:c,rawText:c?l.nodeValue:"",parsedText:d,parsedTextOffset:n}),n+=d.length,n>this._textLengthThreshold)break}while(i.next(a));let l="";for(const t of e)l+=t.parsedText;const c=this._text!==l;return this._text=l,this._textChunks=e,c}async _applyReplacement(e){const t=this._getRelativeTextReplacementOffset(e);if(!t)return Promise.resolve();const{from:n,to:o,textNode:s}=t;ut._selectText(s,n,o),(r.A.isFirefox()||r.A.isThunderbird())&&e.replacementText.includes(ut.NBSP)?this.manuallyInsertText(s,e):e.replacementText||n===o?this.insertText(e.replacementText):await this.simulateDelete()}}

118

/*! (C) Copyright 2022 LanguageTooler GmbH. All rights reserved. */

119

var Gt,Ht;class Wt{static isEditor(e){if(!e.matches(this.EDITOR_SELECTOR))return!1;return!("true"===e.getAttribute("aria-readonly"))}static isTextMode(e){const n=["markdown"],r=e.dataset.language;if(r)return n.includes(r);if(e.querySelectorAll(Wt.LINE_SELECTOR).length>=10){const t=Array.from(e.querySelectorAll(this.HIGHLIGHTING_ELEMENTS_SELECTOR));for(const e of t){if(Array.from(e.classList).some((e=>e.length<3)))return!1}return!0}const o=e.closest(Wt.EDITOR_CONTAINER_SELECTOR);if(!o)return!1;return!(0,t.Y7)(o,this.LINE_NUMBERS_SELECTOR)}static createMutationObserver(e){return new kt(e,this._isMutationIgnored)}constructor(e){this._inputArea=e}isElementIgnored(e){if(e.matches(Wt.LINE_SELECTOR)){if((!e.previousElementSibling||e.previousElementSibling.matches(Wt.GAP_ELEMENT_SELECTOR))&&e.nextElementSibling?.matches(Wt.GAP_ELEMENT_SELECTOR)||(!e.nextElementSibling||e.nextElementSibling.matches(Wt.GAP_ELEMENT_SELECTOR))&&e.previousElementSibling?.matches(Wt.GAP_ELEMENT_SELECTOR)){return this._inputArea.querySelectorAll(Wt.LINE_SELECTOR).length>1}}return!1}getCacheInvalidationRules(e){return Object.assign({},e,{isSkippingElement:{self:{attributes:["class"]},parent:{childList:!0},sibling:{attributes:["contenteditable"]}},replacementText:{},parsedText:{self:{characterData:!0}},paragraphLastValuableNode:{self:{attributes:["id","style"],characterData:!0},ancestor:{attributes:["id","style"]},blockSibling:{attributes:["id","style"],characterData:!0},any:{attributes:["class"],childList:!0}},isBRElementRelevant:{self:{attributes:["id","style"]},ancestor:{attributes:["id","style"]},blockSibling:{attributes:["id","style"],characterData:!0},any:{attributes:["class"],childList:!0}},isParagraphNonEmpty:{self:{attributes:["id","style"]},ancestor:{attributes:["id","style"]},descendant:{attributes:[],characterData:!0},any:{attributes:["class"],childList:!0}}})}addScrollEventListener(e){this.getScrollContainer().addEventListener("scroll",e)}removeScrollEventListener(e){this.getScrollContainer().removeEventListener("scroll",e)}getInputAreaWrapper(e,t){return new Ft(this._inputArea,e,t)}getScrollContainer(){return this._inputArea.closest(Wt.EDITOR_SCROLL_CONTAINER_SELECTOR)}}Gt=Wt,Wt.EDITOR_CONTAINER_SELECTOR="div.cm-editor",Wt.EDITOR_SCROLL_CONTAINER_SELECTOR="div.cm-scroller",Wt.EDITOR_SELECTOR="div.cm-editor div.cm-scroller div.cm-content[contenteditable=true]",Wt.LINE_NUMBERS_SELECTOR="div.cm-lineNumbers",Wt.LINE_SELECTOR="div.cm-line",Wt.HIGHLIGHTING_ELEMENTS_SELECTOR="div.cm-line *[class]",Wt.GAP_ELEMENT_SELECTOR="div[contenteditable=false][style*='height'], div.cm-gap[style*='height']",Wt._isMutationIgnored=e=>{const n=e.target;if(!(0,t.iS)(n))return!1;return!!(Gt.isEditor(n)&&"attributes"===e.type&&"style"===e.attributeName||n.matches(Gt.LINE_SELECTOR)&&"attributes"===e.type&&"class"===e.attributeName)};

120

/*! (C) Copyright 2023 LanguageTooler GmbH. All rights reserved. */



1

/**

2

 * URL Incrementer

3

 * Copyright © 2020 Roy Six

4

 * License: https://github.com/roysix/url-incrementer/blob/master/LICENSE

5

 * This software is a copyrighted work and is governed by a proprietary-style license. You may wish to read it

6

 */

7

 

8

var Shortcuts = (() => {

9

​

10

  const KEY_MODIFIERS = new Map([["Alt",0x1],["Control",0x2],["Shift",0x4],["Meta",0x8]]);

11

​

12

  let button = undefined,

13

      buttons3 = false,

14

      clicks = 0,

15

      timeouts = {},

16

      items = {};

17

​

18

  function setItems(items_) {

/* global API msg */// msg.js
/* global StyleInjector isFrame isFrameNoUrl isFrameSameOrigin */// style-injector.js
/* global TDM:true */// style-injector.js
'use strict';

(() => {
  if (window.INJECTED === 1) return;
  window.INJECTED = 1;

  let isTab = !chrome.tabs || location.pathname !== '/popup.html';
  const own = /** @type {Injection} */{
    cfg: {off: false, top: ''},
  };
  const calcOrder = ({id}, _) =>
    (_ = own.cfg.order) &&
    (_.prio[id] || 0) * 1e6 ||
    _.main[id] ||
    id + .5e6; // no order = at the end of `main`
  const isXml = document instanceof XMLDocument;
  const CHROME = 'app' in chrome;
  const SYM_ID = 'styles';
  const isUnstylable = !CHROME && isXml;
  const styleInjector = StyleInjector({
    compare: (a, b) => calcOrder(a) - calcOrder(b),
    onUpdate: onInjectorUpdate,
  });
  const clone = typeof deepCopy === 'function'
    ? deepCopy /* global deepCopy */// will be used in extension context
    : val => typeof val === 'object' && val ? JSON.parse(JSON.stringify(val)) : val;
  // dynamic iframes don't have a URL yet so we'll use their parent's URL (hash isn't inherited)
  let matchUrl = isFrameNoUrl
    ? parent.location.href.split('#')[0]
    : location.href;
  let isOrphaned, orphanCleanup;
  let offscreen;
  // firefox doesn't orphanize content scripts so the old elements stay
  if (!CHROME) styleInjector.clearOrphans();

  /** @type chrome.runtime.Port */
  let port;
  let lazyBadge = isFrame;

  /** Polyfill for documentId in Firefox and Chrome pre-106 */
  const instanceId = !(CHROME && CSS.supports('top', '1ic')) && (Math.random() + matchUrl);
  /* about:blank iframes are often used by sites for file upload or background tasks
   * and they may break if unexpected DOM stuff is present at `load` event
   * so we'll add the styles only if the iframe becomes visible */
  const xoEventId = `${Math.random()}`;
  /** @type IntersectionObserver */
  let xo;
  window[Symbol.for('xo')] = (el, cb) => {
    if (!xo) xo = new IntersectionObserver(onIntersect, {rootMargin: '100%'});
    el.addEventListener(xoEventId, cb, {once: true});
    xo.observe(el);
  };

  // FIXME: move this to background page when following bugs are fixed:
  // https://bugzil.la/1587723, https://crbug.com/968651
  const mqDark = !isFrame && matchMedia('(prefers-color-scheme: dark)');
  if (mqDark) {
    mqDark.onchange = ({matches: m}) => {
      if (m !== own.cfg.dark) API.info.set({preferDark: own.cfg.dark = m});
    };
  }

  // Declare all vars before init() or it'll throw due to "temporal dead zone" of const/let
  init();

  // the popup needs a check as it's not a tab but can be opened in a tab manually for whatever reason
  if (!isTab) {
    chrome.tabs.getCurrent(tab => {
      isTab = Boolean(tab);
      if (tab && styleInjector.list.length) updateCount();
    });
  }

  msg.onTab(applyOnMessage);
  addEventListener('pageshow', onBFCache);
  if (TDM < 0) document.onprerenderingchange = onReified;

  if (!chrome.tabs) {
    dispatchEvent(new CustomEvent(chrome.runtime.id, {detail: orphanCleanup = Math.random()}));
    addEventListener(chrome.runtime.id, orphanCheck, true);
  }

  function onInjectorUpdate() {
    if (!isOrphaned) {
      updateCount();
      if (isFrame) updateExposeIframes();
    }
  }

  async function init() {
    if (isUnstylable) return API.styleViaAPI({method: 'styleApply'});
    let data = isFrameNoUrl && CHROME && clone(parent[parent.Symbol.for(SYM_ID)]);
    if (data) await new Promise(onFrameElementInView);
    else data = !isFrameSameOrigin && !isXml && !chrome.tabs && tryCatch(getStylesViaXhr);
    // XML in Chrome will be auto-converted to html later, so we can't style it via XHR now
    await applyStyles(data);
    if (orphanCleanup) {
      dispatchEvent(new Event(orphanCleanup));
      orphanCleanup = false;
    }
  }

  async function applyStyles(data) {
    if (isOrphaned) return;
    if (!data) data = await API.styles.getSectionsByUrl(matchUrl, null, !own.sections);
    if (!data.cfg) data.cfg = own.cfg;
    Object.assign(own, window[Symbol.for(SYM_ID)] = data);
    if (!isFrame && own.cfg.top === '') own.cfg.top = location.origin; // used by child frames via parentStyles
    if (!isFrame && own.cfg.dark !== mqDark.matches) mqDark.onchange(mqDark);
    if (styleInjector.list.length) styleInjector.replace(own);
    else if (!own.cfg.off) styleInjector.apply(own);
    styleInjector.toggle(!own.cfg.off);
  }

  /** Must be executed inside try/catch */
  function getStylesViaXhr() {
    const blobId = (document.cookie.split(chrome.runtime.id + '=')[1] || '').split(';')[0];
    if (!blobId) return; // avoiding an exception so we don't spoil debugging in devtools
    const url = 'blob:' + chrome.runtime.getURL(blobId);
    document.cookie = `${chrome.runtime.id}=1; max-age=0; SameSite=Lax`; // remove our cookie
    const xhr = new XMLHttpRequest();
    xhr.open('GET', url, false); // synchronous
    xhr.send();
    URL.revokeObjectURL(url);
    return JSON.parse(xhr.response);
  }

  function applyOnMessage(req) {
    if (isUnstylable && /^(style|updateCount|urlChanged)/.test(req.method)) {
      API.styleViaAPI(req);
      return;
    }
    const {style} = req;
    switch (req.method) {
      case 'ping':
        return true;

      case 'styleDeleted':
        styleInjector.remove(style.id);
        break;

      case 'styleUpdated':
        if (!own.sections && own.cfg.off) break;
        if (style.enabled) {
          API.styles.getSectionsByUrl(matchUrl, style.id).then(res =>
            res.sections.length
              ? styleInjector.apply(res)
              : styleInjector.remove(style.id));
        } else {
          styleInjector.remove(style.id);
        }
        break;

      case 'styleAdded':
        if ((own.sections || !own.cfg.off) && style.enabled) {
          API.styles.getSectionsByUrl(matchUrl, style.id)
            .then(styleInjector.apply);
        }
        break;

      case 'urlChanged':
        if (req.iid === instanceId && matchUrl !== req.url) {
          matchUrl = req.url;
          if (own.sections) applyStyles(own.cfg.off && {});
        }
        break;

      case 'updateCount':
        updateCount();
        break;

      case 'injectorConfig':
        updateConfig(req);
        break;

      case 'backgroundReady':
        // This may happen when reloading the background page without reloading the extension
        if (own.sections) updateCount();
        return true;
    }
  }

  function updateConfig({cfg}) {
    for (const k in cfg) {
      const v = cfg[k];
      if (v === own.cfg[k]) continue;
      if (k === 'top' && !isFrame) continue;
      own.cfg[k] = v;
      if (k === 'off') updateDisableAll();
      else if (k === 'order') styleInjector.sort();
      else if (k === 'top') updateExposeIframes();
      else styleInjector.config(own.cfg);
    }
  }

  function updateDisableAll() {
    if (isUnstylable) {
      API.styleViaAPI({method: 'injectorConfig', cfg: {off: own.cfg.off}});
    } else if (!own.sections && !own.cfg.off) {
      if (!offscreen) init();
    } else {
      styleInjector.toggle(!own.cfg.off);
    }
  }

  function updateExposeIframes() {
    const attr = 'stylus-iframe';
    const el = document.documentElement;
    if (!el) return; // got no styles so styleInjector didn't wait for <html>
    if (!own.cfg.top || !styleInjector.list.length) {
      if (el.hasAttribute(attr)) el.removeAttribute(attr);
    } else if (el.getAttribute(attr) !== own.cfg.top) { // Checking first to avoid DOM mutations
      el.setAttribute(attr, own.cfg.top);
    }
  }

  function updateCount() {
    if (!isTab || TDM < 0) return;
    if (isFrame) {
      if (!port && styleInjector.list.length) {
        port = chrome.runtime.connect({name: 'iframe'});
      } else if (port && !styleInjector.list.length) {
        port.disconnect();
      }
      if (lazyBadge && performance.now() > 1000) lazyBadge = false;
    }
    if (isUnstylable) API.styleViaAPI({method: 'updateCount'});
    else API.updateIconBadge(styleInjector.list.map(style => style.id), {lazyBadge, iid: instanceId});
  }

  function onFrameElementInView(cb) {
    parent[parent.Symbol.for('xo')](frameElement, cb);
    (offscreen || (offscreen = [])).push(cb);
  }

  /** @param {IntersectionObserverEntry[]} entries */
  function onIntersect(entries) {
    for (const e of entries) {
      if (e.intersectionRatio) {
        xo.unobserve(e.target);
        e.target.dispatchEvent(new Event(xoEventId));
      }
    }
  }

  function onBFCache(e) {
    if (e.isTrusted && e.persisted) {
      updateCount();
    }
  }

  function onReified(e) {
    if (e.isTrusted) {
      TDM = 2;
      document.onprerenderingchange = null;
      API.styles.getSectionsByUrl('', 0, 'cfg').then(updateConfig);
      updateCount();
    }
  }

  function tryCatch(func, ...args) {
    try {
      return func(...args);
    } catch (e) {}
  }

  function orphanCheck(evt) {
    if (chrome.runtime.id) return;
    // In Chrome content script is orphaned on an extension update/reload
    // so we need to detach event listeners
    removeEventListener(evt.type, orphanCheck, true);
    removeEventListener('pageshow', onBFCache);
    if (mqDark) mqDark.onchange = null;
    if (offscreen) for (const fn of offscreen) fn();
    if (TDM < 0) document.onprerenderingchange = null;
    offscreen = null;
    isOrphaned = true;
    styleInjector.shutdown(evt.detail);
    tryCatch(msg.off, applyOnMessage);
  }
})();
10:59 AM 4/22/2024